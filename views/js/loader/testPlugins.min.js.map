{"version":3,"sources":["../../../taoTests/views/js/runner/plugin.js","css!taoQtiTestCss/plugins/key-navigation","../../../taoQtiTest/views/js/runner/plugins/content/accessibility/keyNavigation.js","../../../taoQtiTest/views/js/runner/plugins/content/dialog/dialog.js","../../../taoQtiTest/views/js/runner/plugins/content/dialog/exitMessages.js","../../../taoQtiTest/views/js/runner/plugins/content/dialog/itemAlertMessage.js","../../../taoQtiTest/views/js/runner/plugins/templates/button!tpl","../../../taoQtiTest/views/js/runner/plugins/content/dialog/itemInlineMessage.js","../../../taoQtiTest/views/js/runner/plugins/content/feedback/feedback.js","../../../taoQtiTest/views/js/runner/plugins/content/loading/loading.js","../../../taoQtiTest/views/js/runner/plugins/content/modalFeedback/modalFeedback.js","../../../taoQtiTest/views/js/runner/plugins/content/overlay/overlay.js","../../../taoQtiTest/views/js/runner/plugins/content/responsiveness/collapser.js","../../../taoQtiTest/views/js/runner/plugins/content/rubricBlock/rubricBlock!tpl","../../../taoQtiItem/views/js/mathjax/MathJax.js","../../../taoQtiTest/views/js/runner/plugins/content/rubricBlock/rubricBlock.js","../../../taoQtiTest/views/js/runner/plugins/controls/connectivity/connectivity.js","../../../taoQtiTest/views/js/runner/plugins/controls/duration/duration.js","../../../taoQtiTest/views/js/runner/plugins/controls/progressbar/progressbar!tpl","../../../taoQtiTest/views/js/runner/plugins/controls/progressbar/progressbar.js","../../../taoQtiTest/views/js/runner/plugins/controls/testState/testState.js","../../../taoQtiTest/views/js/runner/plugins/controls/timer/timer!tpl","../../../taoQtiTest/views/js/runner/plugins/controls/timer/timerComponent.js","../../../taoQtiTest/views/js/runner/helpers/map.js","../../../taoQtiTest/views/js/runner/helpers/currentItem.js","../../../taoQtiTest/views/js/runner/helpers/stats.js","../../../taoQtiTest/views/js/runner/helpers/messages.js","../../../taoQtiTest/views/js/runner/plugins/controls/timer/timers!tpl","../../../taoQtiTest/views/js/runner/plugins/controls/timer/timer.js","../../../taoQtiTest/views/js/runner/plugins/controls/title/title!tpl","../../../taoQtiTest/views/js/runner/plugins/controls/title/title.js","../../../taoQtiTest/views/js/runner/plugins/controls/trace/itemTraceVariables.js","../../../taoQtiTest/views/js/runner/plugins/navigation/next/nextWarningHelper.js","../../../taoQtiTest/views/js/runner/plugins/navigation/next.js","../../../taoQtiTest/views/js/runner/plugins/navigation/nextSection.js","../../../taoQtiTest/views/js/runner/plugins/navigation/previous.js","../../../taoQtiTest/views/js/runner/plugins/navigation/review/navigator!tpl","../../../taoQtiTest/views/js/runner/plugins/navigation/review/navigatorTree!tpl","../../../taoQtiTest/views/js/runner/plugins/navigation/review/navigator.js","../../../taoQtiTest/views/js/runner/plugins/navigation/review/review.js","../../../taoQtiTest/views/js/runner/plugins/navigation/skip.js","../../../taoQtiTest/views/js/runner/plugins/security/disableRightClick.js","../../../taoQtiTest/views/js/runner/plugins/tools/answerElimination/eliminator.js","../../../taoQtiTest/views/js/runner/plugins/tools/answerMasking/tpl/mask!tpl","../../../taoQtiTest/views/js/runner/plugins/tools/answerMasking/answerMasking.js","../../../taoQtiTest/views/js/runner/plugins/tools/answerMasking/plugin.js","../../../taoQtiTest/views/js/runner/plugins/tools/areaMasking/mask!tpl","../../../taoQtiTest/views/js/runner/plugins/tools/areaMasking/mask.js","../../../taoQtiTest/views/js/runner/plugins/tools/areaMasking/areaMasking.js","../../../taoQtiTest/views/js/runner/plugins/tools/calculator.js","../../../taoQtiTest/views/js/runner/plugins/tools/comment/comment!tpl","../../../taoQtiTest/views/js/runner/plugins/tools/comment/comment.js","../../../taoQtiTest/views/js/runner/plugins/tools/documentViewer/panel!tpl","../../../taoQtiTest/views/js/runner/plugins/tools/documentViewer/documentViewer.js","../../../taoQtiTest/views/js/runner/plugins/tools/highlighter/highlighter.js","../../../taoQtiTest/views/js/runner/plugins/tools/highlighter/plugin.js","../../../taoQtiTest/views/js/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher.js","../../../taoQtiTest/views/js/runner/plugins/tools/lineReader/compoundMask.js","../../../taoQtiTest/views/js/runner/plugins/tools/lineReader/plugin.js","../../../taoQtiTest/views/js/runner/plugins/tools/magnifier/magnifierPanel!tpl","../../../taoQtiTest/views/js/runner/plugins/tools/magnifier/magnifierPanel.js","../../../taoQtiTest/views/js/runner/plugins/tools/magnifier/magnifier.js","../../../taoQtiTest/views/js/runner/plugins/tools/zoom.js","../../../../../../../onLayerEnd0.js"],"names":["define","_","pluginFactory","partialRight","hostName","$","keyNavigator","navigableDomElement","navigableGroupElement","shortcut","namespaceHelper","initToolbarNavigation","$navigationBar","$focusables","find","navigables","createFromDoms","length","id","replace","group","elements","defaultPosition","on","this","next","previous","cursor","navigable","getElement","click","mousedown","initHeaderNavigation","$headerElements","closest","loop","initNavigatorNavigation","testRunner","filtersNavigator","itemsNavigator","$filters","$trees","navigableFilters","navigableTrees","filterCursor","$panel","getAreaBroker","getPanelArea","$navigator","navigators","itemListingVisited","hasClass","keepState","defer","focus","first","last","origin","position","push","pos","data","forIn","i","$parent","parent","is","addClass","removeClass","initContentNavigation","itemNavigators","$content","getContentArea","filter","parents","each","$itemElement","union","initInteractionNavigation","propagateTab","$interaction","$inputs","interactionNavigables","interactionNavigators","$nav","off","initRubricNavigation","$itemElements","rubricNavigators","$rubricArea","initTestRunnerNavigation","document","activeElement","blur","createFromNavigators","name","init","self","getTestRunner","add","groupNavigator","isFocused","disable","after","enable","destroy","remove","getName","__","dialogAlert","dialogConfirm","shortcutRegistry","globalShortcut","pluginName","actionPrefix","closeAccept","dialog","trigger","hide","closeReject","closeLast","accept","handle","opened","addHandle","namespace","stack","message","reject","doAccept","e","reason","isFunction","doReject","context","dialogShortcut","removeHandle","closeDialogs","forEach","alerts","confirms","testData","getTestData","testConfig","config","pluginShortcuts","shortcuts","propagate","prevent","set","allowShortcuts","command","key","namespaceAll","before","msg","clear","Promise","install","isObject","resolve","getTestContext","itemUri","disableItem","hider","$element","getContent","dom","modal","render","itemRunner","$modalsContainer","$container","_item","container","append","hb","template","Handlebars","depth0","helpers","partials","program1","stack1","helper","buffer","className","call","hash","functionType","escapeExpression","program3","icon","unless","text","inverse","noop","fn","program","program4","program6","compilerInfo","merge","control","title","buttonTpl","buttonData","end","createOkButton","dataType","isLast","$btn","preventDefault","$button","$navigationContainer","getNavigationArea","$inlineContainer","removeProp","prop","feedback","currentFeedback","closeCurrent","close","err","type","error","danger","warning","info","loadingBar","start","stop","module","inlineMessage","alertMessage","autoscroll","destroyFeedback","removed","renderedFeedbacks","storedFeedback","found","nextStep","defineMode","inline","inlineMode","messagePlugin","isDestroyed","inlineModalFeedback","createMessages","renderingQueue","bInlineMode","isBoolean","renderingToken","done","tFeedbacks","slice","stopImmediatePropagation","stopPropagation","shield","unshield","itemRef","$contentArea","pluginsConfig","plugins","overlayConfig","overlay","full","show","noLabelCls","noLabelHoverCls","defaults","collapseTools","collapseNavigation","collapseInOrder","hover","collaspeOrder","getAvailableWidth","$actionsBar","width","getToolbarWidth","$toolbox","$navigation","collapseNeeded","collapseAll","yes","toggleClass","collapseCls","shouldCollapseInOrder","isArray","collapseOrder","toCollapse","collapseOrderCopy","clone","shift","collapser","areaBroker","getArea","getToolboxArea","containerTpl","blankifyLinks","attr","mathify","require","MathJax","Hub","Queue","itemData","rubrics","html","then","empty","disconnect","getState","reconnect","window","setState","source","code","getProxy","pollingFactory","timerFactory","store","refresh","initContext","initItemAttemptId","itemIdentifier","attempt","getConfig","serviceCallId","durationStore","getItemDuration","attemptId","test","getItem","Error","stopwatch","autoStart","initDuration","isNumber","attemptDuration","setItem","polling","action","elapsed","tick","itemAttemptId","duration","interval","params","itemDuration","addCallActionParams","getDuration","removeStore","catch","resume","pause","progressTpl","progressUpdater","testContext","testMap","progressConfig","updater","percentage","total","Math","max","numberItems","ratio","floor","numberCompleted","label","getTestPart","parts","testPartId","getTestSection","testPart","sections","sectionId","progressScopeCounter","itemPosition","reduce","acc","section","size","items","testSection","positionInPart","positionInSection","counter","scope","currentPosition","showTotal","indicator","$progressLabel","$progressControl","progressIndicator","update","progressData","getTestMap","progressbar","getControlArea","use","req","res","isEmpty","messages","channel","isLeaving","running","moment","timeEncoder","timerTpl","hasAnimationFrame","precision","timerTypes","item","timerComponentFactory","isPlainObject","TypeError","contains","remaining","warnings","$display","encode","requestAnimationFrame","warn","findLast","showed","isFinite","point","humanize","val","value","getEmptyStats","questions","answered","flagged","viewed","getJumps","map","jumps","getParts","getJump","getPart","partName","getSection","sectionName","part","itemName","jump","identifier","getItemAt","getTestStats","stats","getPartStats","getSectionStats","getScopeStats","getScopeMap","scopeMap","cloneDeep","computeItemStats","computeStats","getItemPart","getItemSection","callback","updateItemStats","informational","collection","responseCardinalities","single","multiple","ordered","record","currentItemHelper","getDeclarations","runner","responses","getResponseDeclaration","declaration","attributes","toResponse","baseType","cardinality","mappedCardinality","response","isString","v","base","isQtiValueNull","isQuestionAnswered","defaultValue","isEqual","isAnswered","getResponses","count","mapHelper","getInstantStats","isItemCurrentlyAnswered","itemAnswered","statsHelper","getExitMessage","unansweredCount","flaggedCount","itemsCountMessage","messageEnabled","enableUnansweredItemsWarning","toString","trim","timerBoxTpl","timerRefresh","exitMessage","isTimedSection","timeConstraints","some","constraint","qtiClassName","shouldClearStorage","doEnable","doDisable","itemStates","timerWarning","displayedTimers","timers","extraTime","consumedExtraTime","lastConsumedExtraTime","getRemainingExtraTime","setRemainingTime","timerConfig","regular","getTimerConfig","timeConstraint","timer","closestPreviousWarning","isTimeout","itemSessionState","interacting","seconds","parseInt","leaveTimedSection","nbItems","closed","removeTimer","storage","removeItem","omit","addTimer","updateTimers","checkStorage","timerUpdatePromises","consumed","savedTime","all","timeStore","timeoutScope","timeoutRef","elapsedExtraTime","timeout","regularVal","displayedVal","runTimeout","abs","options","movePromise","endTestWarning","noExitTimedSectionWarning","keepUpToTimeout","program2","titles","titleTpl","createElement","isDeepestSectionVisible","sectionTitle","replaceWith","storeFactory","timestamp","Date","now","onError","variables","tracesStore","ITEM_START_TIME_CLIENT","ITEM_END_TIME_CLIENT","ITEM_TIMEZONE","utcOffset","format","callItemAction","traceData","JSON","stringify","toBoolean","nextWarningHelper","shouldWarnBeforeNext","nextItemWarning","itemCanBeTriedAtWill","isLinear","remainingAttempts","isNextItemInLinearPart","nextPart","isLastOfPart","shouldWarnBeforeEnd","shouldWarnOnTestEnd","shouldWarnOnPartChange","warnBeforeNext","shouldWarnForUnansweredItems","hasUnanswered","hasFlagged","unansweredOnly","nextPartWarning","warnBeforeEnd","updateElement","doNext","testOptions","nextItemPosition","unansweredWarning","warningScope","warningHelper","partial","triggerNextAction","avoidInput","toggle","nextSection","nextSectionWarning","bind","doPrevious","previousItemWarning","canDoPrevious","canMoveBackward","helperMissing","program5","program7","program9","program11","program13","hidden","showLegend","active","program8","apply","program10","cls","index","component","navigatorTpl","navigatorTreeTpl","navigatorFactory","flagItem","$item","_cssCls","navigator","setItemFlag","navigatorApi","_defaults","setTemplate","controls","autoScroll","$component","$filterBar","_selectors","filterBar","$tree","tree","$infoAnswered","infoAnswered","$infoViewed","infoViewed","$infoAll","tabInfoAll","$infoUnanswered","infoUnanswered","tabInfoUnanswered","$infoFlagged","infoFlagged","tabInfoFlagged","$linearState","linearState","updateConfig","collapseHandle","collapsed","openSelected","infoPanelLabels","togglePanel","infoPanel","partLabels","openOnly","sectionLabels","itemLabels","event","$target","disabled","target","canFlag","icons","unseen","select","linearStart","mode","currentFilter","canCollapse","preventsUnseen","collapsible","_iconCls","itemIcons","activeItem","counters","actives","collapsiblePanels","notFlagged","notAnswered","notInformational","_filterMap","unanswered","join","filtered","updateStats","flag","getProgressionTotal","progression","jquery","writeCount","criteria","$items","filterCb","$section","$itemsFound","not","$filtered","scopeClass","scopedMap","getScopedMap","totalQuestions","itm","$place","display","min","open","selected","hierarchy","parentsUntil","previousPosition","$previous","root","panel","collapseSelector","getFlagItemButtonData","itemFlagged","getToggleButtonData","updateButton","button","turnOff","turnOn","markReview","setFlag","unsetFlag","showReview","hideReview","isPluginAllowed","navigatorConfig","enabled","reviewScreen","callTestAction","flagItemButton","flagCurrentItem","forcedState","isHidden","isUndefined","explicitlyHidden","toggleButton","previousItemPosition","review","getToolbox","createEntry","defaultOpen","$panelContainer","skip","doSkip","allowSkipping","rightClickEvents","eventName","addEventListener","defaultConfig","removeEliminationsOnClose","restoreEliminationsOnOpen","isPluginEnabled","eliminator","togglePluginButton","togglePlugin","$choiceInteractions","isEliminable","enableEliminator","disableEliminator","$choices","input","querySelector","dataset","wasEliminated","classList","setAttribute","checked","removeAttribute","statifier","componentFactory","maskTpl","ns","createMask","maskApi","mask","answerMasking","allMasks","reveal","getContainer","removeAttr","$qtiChoices","$choice","getMasksState","state","setMasksState","masked","answerMaskingFactory","restoreStateOnToggle","restoreStateOnMove","itemContainsChoiceInteraction","disableMasking","enableMasking","itemId","pluginConfig","movableComponent","areaMaskingTpl","maskingComponentFactory","maskComponent","preview","delay","previewDelay","stackingScope","foo","addMask","masks","without","x","y","isEnabled","areaMasking","invoke","calculatorFactory","_default","height","top","left","calculator","buildCalculator","calcTpl","renderTo","$calculatorContainer","draggableContainer","alternativeTemplate","toggleCalculator","allowIn","stackerFactory","commentTpl","allowComment","toggleComment","$form","$input","stacker","bringToFront","appendTo","$cancel","$submit","autoBringToFront","comment","content","viewerFactory","pdfViewer","panelTpl","showPanel","plugin","debounce","resizeViewer","hidePanel","hideIfVisible","isVisible","initPanelEvents","stopEvents","hideViewer","$overlay","viewer","setSize","registerProvider","displayViewer","$title","load","fitToWidth","allowSearch","originalEvent","detail","highlighterFactory","getAllRanges","allRanges","selection","rangeCount","getRangeAt","getSelection","isHighlighting","itemsHighlights","highlightHelper","containerSelector","isCollapsed","highlightRanges","removeAllRanges","toggleHighlighting","bool","saveHighlight","getHighlightIndex","restoreHighlight","highlightFromIndex","clearHighlights","highlighter","buttonMain","buttonRemove","themeHandler","changeTheme","themeId","$qtiItem","selectedTheme","themesConfig","get","availableThemes","defaultTheme","default","available","theme","menuButton","createMenu","themeEntry","setMenuId","turnOffAll","toggleMenu","eventifier","makePlaceable","makeDraggable","makeResizable","makeStackable","constrains","defaultDimensions","outerWidth","outerHeight","innerWidth","innerHeight","outerX","outerY","innerX","innerY","defaultOptions","dragMinWidth","dragMinHeight","resizeHandleSize","innerDragHeight","stackingOptions","dimensions","maskConfig","maskAPI","place","placeOverlay","styleResizableEdges","forOwn","edges","isResizable","edgeId","bringAllToFront","innerDrag","closer","invokeOnOverlays","invokeOnMasks","beforeResize","onResize","applyTransformsToOverlays","applyTransformsToInnerDrag","applyTransformsToCloser","createOverlay","overlayAPI","transformOverlay","_sizeBackup","getSize","_posBackup","getPosition","moveTo","restoreOverlay","appendVisualGuides","borderWidth","borderOffset","visualGuides","$maskBg","$innerWindow","css","border-top-width","topHeight","border-right-width","rightWidth","border-bottom-width","bottomHeight","border-left-width","leftWidth","removeVisualGuides","xOffsetRelative","yOffsetRelative","invokeOnAll","applyTransforms","createInnerDragHandle","dragRestriction","rect","fixedXY","allParts","nw","offset","minWidth","minHeight","minBottomHeight","$dragIcon","class","applyTransformsToMasks","createCloser","$closeIcon","args","invokeOn","correctTransforms","setTopHeight","newHeight","newY","fromTop","setRightWidth","newWidth","newX","fromLeft","setBottomHeight","setLeftWidth","createCompoundMask","createPart","right","bottom","maxHeight","maxWidth","partConfig","assign","createVisualGuides","compoundMask","setTransforms","dim","getDimensions","compoundMaskFactory","$qtiContent","lineHeight","ceil","parseFloat","maskOptions","paddingLeft","paddingTop","textPadding","containerWidthHasChanged","newDimensions","lineReader","toggleMask","transformMask","openMask","closeMask","$maskContainer","level","magnifierPanelTpl","magnifierPanelFactory","scrollInClone","scrollData","$clonedTarget","$clone","scrollTop","scrollLeft","setScrollingListener","scrollingListenerCallback","removeScrollingListener","removeEventListener","applyScrolling","scrolling","adjustZoomLevel","zoomLevelMin","zoomLevelMax","applyZoomLevel","$inner","transform","zoomLevel","showZoomLevel","$newZoomLevel","$zoomLevel","updateMaxSize","$window","magnifierPanel","maxRatio","applySize","targetWidth","targetHeight","updateZoom","dx","dy","zoomAt","createObserver","observer","MutationObserver","updateMagnifier","startObserver","observe","childList","characterData","subtree","stopObserver","translateMagnifier","coordinate","actualSize","magnifierSize","delta","getElementFromPoint","el","elementFromPoint","findSourceNode","node","$node","$root","indexes","$this","pop","forEachRight","children","eq","initConfig","levelMin","levelMax","zoomLevelStep","levelStep","baseSize","zoomSize","$initTarget","getZoomLevel","getTarget","setTarget","$newTarget","$viewTarget","zoomTo","zoomBy","step","zoomIn","zoomOut","translate","debounceDelay","throttle","scrollId","scrollingTop","uniqueId","scrollingDelay","screenRatio","pageX","pageY","screen","defaultBaseSize","defaultLevelMin","defaultLevelMax","defaultLevel","zoomMin","zoomMax","zoomStep","getMagnifierPanel","hideMagnifier","magnifier","toggleMagnifier","showMagnifier","transformer","standard","increment","threshold","lower","upper","setZoomLevel","setTransformOrigin","scale","resetZoom","reset","forceRepaint","sel","style","offsetHeight","zoomAction","dir","sx","sy","inc","$zoomTarget","getBoundingClientRect","zoom","buttonZoomOut","buttonZoomIn","in","out","c","d","a","s","getElementsByTagName","cssText","createTextNode"],"mappings":"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","file":"testPlugins.min.js","sourcesContent":["/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\ndefine('taoTests/runner/plugin',['lodash', 'core/plugin'], function(_, pluginFactory){\r\n    'use strict';\r\n\r\n    /**\r\n     * A pluginFactory configured for the test runner\r\n     * @returns {Function} the preconfigured plugin factory\r\n     */\r\n    return _.partialRight(pluginFactory, {\r\n        //alias getHost to getTestRunner\r\n        hostName : 'testRunner'\r\n    });\r\n});\r\n\n","\ndefine('css!taoQtiTestCss/plugins/key-navigation',[],function(){});\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * Test Runner Content Plugin : Navigate through the item focusable elements using the keyboard\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/accessibility/keyNavigation',[\r\n    'jquery',\r\n    'lodash',\r\n    'ui/keyNavigation/navigator',\r\n    'ui/keyNavigation/navigableDomElement',\r\n    'ui/keyNavigation/navigableGroupElement',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoTests/runner/plugin',\r\n    'css!taoQtiTestCss/plugins/key-navigation'\r\n], function ($, _, keyNavigator, navigableDomElement, navigableGroupElement, shortcut, namespaceHelper, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Init the navigation in the toolbar\r\n     *\r\n     * @param {Object} testRunner\r\n     * @returns {Array}\r\n     */\r\n    function initToolbarNavigation(){\r\n        var $navigationBar = $('.bottom-action-bar');\r\n        var $focusables = $navigationBar.find('.action:not(.btn-group):visible, .action.btn-group .li-inner:visible');\r\n        var navigables = navigableDomElement.createFromDoms($focusables);\r\n        if (navigables.length) {\r\n            return [keyNavigator({\r\n                id : 'bottom-toolbar',\r\n                replace : true,\r\n                group : $navigationBar,\r\n                elements : navigables,\r\n                //start from the last button \"goto next\"\r\n                defaultPosition : navigables.length - 1\r\n            }).on('right down', function(){\r\n                this.next();\r\n            }).on('left up', function(){\r\n                this.previous();\r\n            }).on('activate', function(cursor){\r\n                cursor.navigable.getElement().click().mousedown();\r\n            })];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * Init the navigation in the header block\r\n     *\r\n     * @param {Object} testRunner\r\n     * @returns {Array}\r\n     */\r\n    function initHeaderNavigation(){\r\n        //need global selector as currently no way to access delivery frame from test runner\r\n        var $headerElements = $('[data-control=\"exit\"]:visible a');\r\n        var navigables = navigableDomElement.createFromDoms($headerElements);\r\n        if (navigables.length) {\r\n            return [keyNavigator({\r\n                id : 'header-toolbar',\r\n                group : $headerElements.closest('.infoControl'),\r\n                elements : navigables,\r\n                loop : true,\r\n                replace : true\r\n            }).on('activate', function(cursor){\r\n                cursor.navigable.getElement().click();\r\n            })];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * Init the navigation in the review panel\r\n     *\r\n     * @param {Object} testRunner\r\n     * @returns {Array} the keyNavigator of the main navigation group\r\n     */\r\n    function initNavigatorNavigation(testRunner){\r\n\r\n        var $panel = testRunner.getAreaBroker().getPanelArea();\r\n        var $navigator = $panel.find('.qti-navigator');\r\n        var navigators = [];\r\n        var filtersNavigator;\r\n        var itemsNavigator;\r\n        var $filters, $trees, navigableFilters, navigableTrees;\r\n\r\n        //the tag to identify if the item listing has been browsed, to only \"smart jump\" to active item only on the first visit\r\n        var itemListingVisited = false;\r\n        //the position of the filter in memory, to only \"smart jump\" to active item only on the first visit\r\n        var filterCursor;\r\n\r\n        if($navigator.length && !$navigator.hasClass('disabled')){\r\n            $filters = $navigator.find('.qti-navigator-filters .qti-navigator-filter');\r\n            navigableFilters = navigableDomElement.createFromDoms($filters);\r\n            if (navigableFilters.length) {\r\n                filtersNavigator = keyNavigator({\r\n                    keepState : true,\r\n                    id : 'navigator-filters',\r\n                    replace : true,\r\n                    elements : navigableFilters,\r\n                    group : $navigator\r\n                }).on('right', function(){\r\n                    this.next();\r\n                }).on('left', function(){\r\n                    this.previous();\r\n                }).on('down', function(){\r\n                    if(itemsNavigator){\r\n                        _.defer(function(){\r\n                            if(itemListingVisited){\r\n                                itemsNavigator.focus().first();\r\n                            }else{\r\n                                itemsNavigator.focus();\r\n                            }\r\n                        });\r\n                    }\r\n                }).on('up', function(){\r\n                    if(itemsNavigator){\r\n                        _.defer(function(){\r\n                            itemsNavigator.last();\r\n                        });\r\n                    }\r\n                }).on('focus', function(cursor, origin){\r\n                    //activate the tab in the navigators\r\n                    cursor.navigable.getElement().click();\r\n\r\n                    //reset the item listing browsed tag whenever the focus on the filter happens after a focus on another element\r\n                    if((filterCursor && filterCursor.position !== cursor.position) || origin){\r\n                        itemListingVisited = false;\r\n                    }\r\n                    //set the filter cursor in memory\r\n                    filterCursor = cursor;\r\n                });\r\n                navigators.push(filtersNavigator);\r\n            }\r\n\r\n            $trees = $navigator.find('.qti-navigator-tree .qti-navigator-item:not(.unseen) .qti-navigator-label');\r\n            navigableTrees = navigableDomElement.createFromDoms($trees);\r\n            if (navigableTrees.length) {\r\n                //instantiate a key navigator but do not add it to the returned list of navigators as this is not supposed to be reached with tab key\r\n                itemsNavigator = keyNavigator({\r\n                    id : 'navigator-items',\r\n                    replace : true,\r\n                    elements : navigableTrees,\r\n                    defaultPosition : function defaultPosition(navigables){\r\n                        var pos = 0;\r\n                        if(filterCursor && filterCursor.navigable.getElement().data('mode') !== 'flagged'){\r\n                            _.forIn(navigables, function(navigable, i){\r\n                                var $parent = navigable.getElement().parent('.qti-navigator-item');\r\n                                //find the first active and visible item\r\n                                if($parent.hasClass('active') && $parent.is(':visible')){\r\n                                    pos = i;\r\n                                    return false;\r\n                                }\r\n                            });\r\n                        }\r\n                        return pos;\r\n                    }\r\n                }).on('down', function(){\r\n                    this.next();\r\n                }).on('up', function(){\r\n                    this.previous();\r\n                }).on('right', function(){\r\n                    if(filtersNavigator){\r\n                        filtersNavigator.focus().next();\r\n                    }\r\n                }).on('left', function(){\r\n                    if(filtersNavigator){\r\n                        filtersNavigator.focus().previous();\r\n                    }\r\n                }).on('activate', function(cursor){\r\n                    cursor.navigable.getElement().click();\r\n                }).on('lowerbound upperbound', function(){\r\n                    if(filtersNavigator){\r\n                        filtersNavigator.focus();\r\n                    }\r\n                }).on('focus', function(cursor){\r\n                    itemListingVisited = true;\r\n                    cursor.navigable.getElement().parent().addClass('key-navigation-highlight');\r\n                }).on('blur', function(cursor){\r\n                    cursor.navigable.getElement().parent().removeClass('key-navigation-highlight');\r\n                });\r\n            }\r\n\r\n        }\r\n        return navigators;\r\n    }\r\n\r\n    /**\r\n     * Init the navigation in the item content\r\n     * Navigable item content are interaction choices and body element with the special class \"key-navigation-focusable\"\r\n     * It returns an array of keyNavigators as the content is dynamically determined\r\n     *\r\n     * @param {Object} testRunner\r\n     * @returns {Array} of keyNavigator ids\r\n     */\r\n    function initContentNavigation(testRunner){\r\n\r\n        var itemNavigators = [];\r\n        var $content = testRunner.getAreaBroker().getContentArea();\r\n\r\n        //the item focusable body elements are considered scrollable\r\n        $content.find('.key-navigation-focusable').addClass('key-navigation-scrollable');\r\n        $content.find('.key-navigation-focusable,.qti-interaction').filter(function(){\r\n            //filter out interaction as it will be managed separately\r\n            return (!$(this).parents('.qti-interaction').length);\r\n        }).each(function(){\r\n            var $itemElement = $(this);\r\n            if($itemElement.hasClass('qti-interaction')){\r\n                itemNavigators = _.union(itemNavigators, initInteractionNavigation($itemElement));\r\n            }else{\r\n                itemNavigators.push(keyNavigator({\r\n                    elements : navigableDomElement.createFromDoms($itemElement),\r\n                    group : $itemElement,\r\n                    propagateTab : false\r\n                }));\r\n            }\r\n        });\r\n\r\n        return itemNavigators;\r\n    }\r\n\r\n    /**\r\n     * Init interaction key navigation from the interaction navigator\r\n     *\r\n     * @param {JQuery} $interaction - the interaction container\r\n     * @returns {Array} array of navigators created from interaction container\r\n     */\r\n    function initInteractionNavigation($interaction){\r\n\r\n        var $inputs;\r\n        var interactionNavigables;\r\n        var interactionNavigators = [];\r\n\r\n        //add navigable elements from prompt\r\n        $interaction.find('.key-navigation-focusable').each(function(){\r\n            var $nav = $(this);\r\n            if(!$nav.closest('.qti-choice').length){\r\n                interactionNavigators.push(keyNavigator({\r\n                    elements : navigableDomElement.createFromDoms($nav),\r\n                    group : $nav,\r\n                    propagateTab : false\r\n                }));\r\n            }\r\n        });\r\n\r\n        //reset interaction custom key navigation to override the behaviour with the new one\r\n        $interaction.off('.keyNavigation');\r\n\r\n        //search for inputs that represent the interaction focusable choices\r\n        $inputs = $interaction.is(':input') ? $interaction : $interaction.find(':input');\r\n        interactionNavigables = navigableDomElement.createFromDoms($inputs);\r\n\r\n        if (interactionNavigables.length) {\r\n            interactionNavigators.push(keyNavigator({\r\n                elements : interactionNavigables,\r\n                group : $interaction,\r\n                loop : false\r\n            }).on('right down', function(){\r\n                this.next();\r\n            }).on('left up', function(){\r\n                this.previous();\r\n            }).on('activate', function(cursor){\r\n                cursor.navigable.getElement().click();\r\n            }).on('focus', function(cursor){\r\n                cursor.navigable.getElement().closest('.qti-choice').addClass('key-navigation-highlight');\r\n            }).on('blur', function(cursor){\r\n                cursor.navigable.getElement().closest('.qti-choice').removeClass('key-navigation-highlight');\r\n            }));\r\n        }\r\n\r\n        return interactionNavigators;\r\n    }\r\n\r\n    /**\r\n     * Init the navigation of test rubric blocks\r\n     * It returns an array of keyNavigator ids as the content is dynamically determined\r\n     *\r\n     * @param {Object} testRunner\r\n     * @returns {Array} of keyNavigator ids\r\n     */\r\n    function initRubricNavigation(){\r\n        var $itemElements;\r\n        var rubricNavigators = [];\r\n        var $rubricArea = $('#qti-rubrics');\r\n\r\n        $itemElements = $rubricArea.find('.qti-rubricBlock');\r\n        $itemElements.each(function(){\r\n            var $itemElement = $(this);\r\n            var id = 'rubric_element_navigation_group_'+rubricNavigators.length;\r\n\r\n            rubricNavigators.push(keyNavigator({\r\n                id : id,\r\n                elements : navigableDomElement.createFromDoms($itemElement),\r\n                group : $itemElement,\r\n                replace : true\r\n            }));\r\n        });\r\n\r\n        return rubricNavigators;\r\n    }\r\n\r\n    /**\r\n     * Init test runner navigation\r\n     * @param testRunner\r\n     * @returns {*}\r\n     */\r\n    function initTestRunnerNavigation(testRunner){\r\n\r\n        var navigators;\r\n\r\n        //blur current focused element, to reinitialize keyboard navigation\r\n        if (document.activeElement){\r\n            document.activeElement.blur();\r\n        }\r\n\r\n        navigators = _.union(\r\n            initRubricNavigation(testRunner),\r\n            initContentNavigation(testRunner),\r\n            initToolbarNavigation(testRunner),\r\n            initNavigatorNavigation(testRunner),\r\n            initHeaderNavigation(testRunner)\r\n        );\r\n\r\n        navigators = navigableGroupElement.createFromNavigators(navigators);\r\n\r\n        return keyNavigator({\r\n            id : 'test-runner',\r\n            replace : true,\r\n            loop : true,\r\n            elements : navigators,\r\n        }).on('tab', function(){\r\n            this.next();\r\n        }).on('shift+tab', function(){\r\n            this.previous();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'keyNavigation',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n\r\n            shortcut.add('tab shift+tab', function(){\r\n                if(!self.groupNavigator.isFocused()){\r\n                    self.groupNavigator.focus();\r\n                }\r\n            });\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .after('renderitem', function () {\r\n                    self.groupNavigator = initTestRunnerNavigation(testRunner);\r\n                    self.enable();\r\n                })\r\n                .on('unloaditem', function () {\r\n                    self.disable();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + this.getName());\r\n            if(this.groupNavigator) {\r\n                this.groupNavigator.destroy();\r\n            }\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Content Plugin : Overlay\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/dialog/dialog',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/dialog/alert',\r\n    'ui/dialog/confirm',\r\n    'util/shortcut/registry',\r\n    'util/shortcut',\r\n    'util/namespace'\r\n], function ($, _, __, pluginFactory, dialogAlert, dialogConfirm, shortcutRegistry, globalShortcut, namespaceHelper){\r\n    'use strict';\r\n\r\n    /**\r\n     * The public name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'dialog';\r\n\r\n    /**\r\n     * The prefix of actions triggered through the event loop\r\n     * @type {String}\r\n     */\r\n    var actionPrefix = 'tool-' + pluginName + '-';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n        name : pluginName,\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[pluginName] || {};\r\n            var alerts = [];\r\n            var confirms = [];\r\n            var opened = [];\r\n            var dialogShortcut = shortcutRegistry($('body'), {\r\n                propagate: false,\r\n                prevent: true\r\n            });\r\n\r\n            /**\r\n             * Closes a dialog with accept\r\n             * @param {dialog} dialog - The instance of the dialog\r\n             */\r\n            function closeAccept(dialog) {\r\n                // TODO: improve the dialog implementation in order to provide a better API\r\n                dialog.trigger('okbtn.modal').hide();\r\n            }\r\n\r\n            /**\r\n             * Closes a dialog with rejection\r\n             * @param {dialog} dialog - The instance of the dialog\r\n             */\r\n            function closeReject(dialog) {\r\n                dialog.hide();\r\n            }\r\n\r\n            /**\r\n             * Closes the last opened dialog\r\n             * @param {Boolean} accept Whether the dialog should be accepted or not\r\n             * @param {String} [shortcut] The shortcut that caused the action\r\n             */\r\n            function closeLast(accept, shortcut) {\r\n                var handle = opened.length && opened[opened.length - 1];\r\n                if (handle) {\r\n                    handle.shortcut = shortcut;\r\n                    if (accept) {\r\n                        closeAccept(handle.dialog);\r\n                    } else {\r\n                        closeReject(handle.dialog);\r\n                    }\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Add dialog on top of the provided stack\r\n             * @param {String} namespace - The event namespace that scope the dialog\r\n             * @param {Array} stack - The dialogs stack on which push the new instance\r\n             * @param {Function} dialog - The constructor of the dialog\r\n             * @param {String} message - The message to display\r\n             * @param {Function} accept - The callback for accept\r\n             * @param {Function} reject - The callback for reject\r\n             */\r\n            function addHandle(namespace, stack, dialog, message, accept, reject) {\r\n                var handle = {\r\n                    context: namespace,\r\n                    dialog: dialog(message, doAccept, doReject)\r\n                };\r\n\r\n                function doAccept(e, reason) {\r\n                    if (_.isFunction(accept)) {\r\n                        accept(handle.shortcut || reason);\r\n                    }\r\n                }\r\n                function doReject(e, reason) {\r\n                    if (_.isFunction(reject)) {\r\n                        reject(handle.shortcut || reason);\r\n                    }\r\n                }\r\n\r\n                // prevents all registered shortcuts to be triggered\r\n                // and brings back the dialog shortcuts\r\n                globalShortcut.disable();\r\n                dialogShortcut.enable();\r\n\r\n                stack.push(handle);\r\n                opened.push(handle);\r\n\r\n                handle.dialog.focus();\r\n                handle.dialog.on('closed.modal', function() {\r\n                    removeHandle(stack, handle.dialog);\r\n                    removeHandle(opened, handle.dialog);\r\n\r\n                    // if all dialogs have been closed allows all registered shortcuts to be triggered\r\n                    // also disables the dialog shortcuts\r\n                    if (!opened.length) {\r\n                        globalShortcut.enable();\r\n                        dialogShortcut.disable();\r\n                    }\r\n                });\r\n            }\r\n\r\n            /**\r\n             * Remove a dialog from the provided stack\r\n             * @param {Array} stack - The dialogs stack from which remove the dialog instance\r\n             * @param {dialog} dialog - The instance of the dialog\r\n             */\r\n            function removeHandle(stack, dialog) {\r\n                if (dialog) {\r\n                    _.remove(stack, function(handle) {\r\n                        if (handle && dialog === handle.dialog) {\r\n                            return true;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Closes all dialogs within the provided stack\r\n             * @param {String} namespace - The event namespace that scope the dialogs to close\r\n             * @param {Boolean} accept - Whether (`true`) or not (`false`) to close the dialogs with accept\r\n             * @param {Array} stack - The dialogs stack in which close the dialogs\r\n             */\r\n            function closeDialogs(namespace, accept, stack) {\r\n                if (stack) {\r\n                    _.forEach(stack, function(handle) {\r\n                        if (handle && (namespace === '@' || namespace === handle.context)) {\r\n                            if (accept) {\r\n                                closeAccept(handle.dialog);\r\n                            } else {\r\n                                closeReject(handle.dialog);\r\n                            }\r\n                        }\r\n                    });\r\n                } else {\r\n                    closeDialogs(namespace, accept, alerts);\r\n                    closeDialogs(namespace, accept, confirms);\r\n                }\r\n            }\r\n\r\n            // starts with shortcuts disabled, prevents the TAB key to be used to move outside the dialog box\r\n            dialogShortcut.disable().set('Tab Shift+Tab');\r\n\r\n            // handle the plugin's shortcuts\r\n            if (testConfig.allowShortcuts) {\r\n                _.forEach(pluginShortcuts, function(command, key) {\r\n                    dialogShortcut.add(namespaceHelper.namespaceAll(command, pluginName, true), function(e, shortcut) {\r\n                        // just fire the action using the event loop\r\n                        testRunner.trigger(actionPrefix + key, shortcut);\r\n                    });\r\n                });\r\n            }\r\n\r\n            //change plugin state\r\n            testRunner\r\n                .before('alert.*', function(e, msg, accept) {\r\n                    addHandle(e.namespace, alerts, dialogAlert, msg, accept, accept);\r\n                })\r\n                .before('confirm.*', function(e, msg, accept, reject) {\r\n                    addHandle(e.namespace, confirms, dialogConfirm, msg, accept, reject);\r\n                })\r\n                .before('closedialog.*', function(e, accept) {\r\n                    closeDialogs(e.namespace, accept);\r\n                })\r\n                .on(actionPrefix + 'accept', function(shortcut) {\r\n                    closeLast(true, shortcut);\r\n                })\r\n                .on(actionPrefix + 'reject', function(shortcut) {\r\n                    closeLast(false, shortcut);\r\n                })\r\n                .on('destroy', function() {\r\n                    closeDialogs('.@');\r\n\r\n                    dialogShortcut.clear();\r\n                    dialogShortcut = null;\r\n                });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/dialog/exitMessages',[\r\n    'lodash',\r\n    'core/promise',\r\n    'taoTests/runner/plugin'\r\n], function (_, Promise, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Creates the testState plugin.\r\n     * Displays exit message, then leaves the runner once the user has acknowledged\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'exitMessages',\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            // this function is mandatory\r\n        },\r\n\r\n        /**\r\n         * Installs the plugin (called when the runner bind the plugin)\r\n         */\r\n        install: function install() {\r\n            var testRunner = this.getTestRunner();\r\n\r\n            // intercepts the `leave` event,\r\n            // then if a message needs to be displayed displays it and waits the user acknowledges it\r\n            testRunner.before('leave', function leave(e, data) {\r\n                if (_.isObject(data) && data.message) {\r\n                    return new Promise(function(resolve) {\r\n                        var context = testRunner.getTestContext();\r\n\r\n                        // the leave can occurs when the runner is in inconsistent state (i.e. error)\r\n                        // prevent side error with item disabling\r\n                        if (context && context.itemUri) {\r\n                            testRunner.disableItem(context.itemUri);\r\n                        }\r\n\r\n                        // wait for the message acknowledge before leaving the runner\r\n                        testRunner.trigger('alert.leave', data.message, resolve);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\r\n */\r\n\r\n\r\n/**\r\n * Create dialog form with message, with overlapped content\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/dialog/itemAlertMessage',[\r\n    'jquery',\r\n    'i18n',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin'\r\n], function($, __, hider, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name : 'itemAlertMessage',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            this.$element = $(this.getContent().dom);\r\n\r\n            this.$element\r\n                // for GUI actions\r\n                .on('closed.modal', function(){\r\n                    $(this).modal('destroy');\r\n                })\r\n                .on('destroyed.modal', function(){\r\n                    self.$element = null;\r\n                    self.trigger('resume', self);\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            var testRunner = this.getTestRunner();\r\n            var itemRunner = testRunner.itemRunner;\r\n            var $modalsContainer = this.getContent().$container;\r\n            if (!$modalsContainer) {\r\n                $modalsContainer = $('#modalFeedbacks', itemRunner._item.container);\r\n            }\r\n            $modalsContainer.append(this.$element);\r\n\r\n            this.$element.modal();\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            if (this.$element && this.$element.length){\r\n                this.$element.modal('close');\r\n            }\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/templates/button', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \" \";\n  if (helper = helpers.className) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.className); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1);\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"<span class=\\\"icon icon-\";\n  if (helper = helpers.icon) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.icon); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1);\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.text), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\"></span>\";\n  return buffer;\n  }\nfunction program4(depth0,data) {\n  \n  \n  return \" no-label\";\n  }\n\nfunction program6(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"<span class=\\\"text\\\">\";\n  if (helper = helpers.text) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.text); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\";\n  return buffer;\n  }\n\n  buffer += \"<li data-control=\\\"\";\n  if (helper = helpers.control) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.control); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"small btn-info action\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.className), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" title=\\\"\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n    <a class=\\\"li-inner\\\" href=\\\"#\\\">\\r\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.icon), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.text), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n    </a>\\r\\n</li>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\r\n */\r\n\r\n/**\r\n * Create form with message in test runner and replace all control buttons on his personal\r\n */\r\n\r\ndefine('taoQtiTest/runner/plugins/content/dialog/itemInlineMessage',[\r\n    'jquery',\r\n    'i18n',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'tpl!taoQtiTest/runner/plugins/templates/button'\r\n], function($, __, hider, pluginFactory, buttonTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The display of the next button\r\n     */\r\n    var buttonData = {\r\n        next : {\r\n            control : 'move-forward',\r\n            title   : __('Submit and go to the next item'),\r\n            icon    : 'forward',\r\n            text    : __('OK')\r\n        },\r\n        end : {\r\n            control : 'move-end',\r\n            title   : __('Submit and go to the end of the test'),\r\n            icon    : 'fast-forward',\r\n            text    : __('OK & End test')\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name : 'itemInlineMessage',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n\r\n            /**\r\n             * Create the button based on the current context\r\n             * @returns {*|jQuery|HTMLElement} the button\r\n             */\r\n            var createOkButton = function createElement(){\r\n                var dataType = !!testRunner.getTestContext().isLast ? 'end' : 'next';\r\n                var $btn = $(buttonTpl(buttonData[dataType]));\r\n                $btn.addClass('modalFeedback-button');\r\n\r\n                //plugin behavior\r\n                $btn.on('click', function(e){\r\n                    e.preventDefault();\r\n\r\n                    self.disable();\r\n                    if($(this).data('control') === 'move-end'){\r\n                        self.trigger('end');\r\n                    }\r\n\r\n                    $btn.remove();\r\n                    self.$element.remove();\r\n\r\n                    self.trigger('resume', self);\r\n                });\r\n\r\n                return $btn;\r\n            };\r\n\r\n            this.$button = createOkButton();\r\n            this.$element = $(this.getContent().dom);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            var $navigationContainer = this.getAreaBroker().getNavigationArea();\r\n            var testRunner = this.getTestRunner();\r\n            var itemRunner = testRunner.itemRunner;\r\n            var $inlineContainer = this.getContent().$container;\r\n            if (!$inlineContainer && itemRunner._item.container) {\r\n                $inlineContainer = $('.qti-itemBody', itemRunner._item.container);\r\n            }\r\n\r\n            $inlineContainer.append(this.$element);\r\n\r\n            // hide all navigation buttons, create new instead of\r\n            if (!$('.modalFeedback-button', $navigationContainer).length){\r\n                $navigationContainer.append(this.$button);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable (){\r\n            this.$button.removeProp('disabled')\r\n                .removeClass('disabled');\r\n        },\r\n\r\n        disable: function disable (){\r\n            this.$button.prop('disabled', true)\r\n                .addClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            this.$button.click();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Content Plugin : Feedback\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/feedback/feedback',[\r\n    'jquery',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/feedback'\r\n], function ($, __, pluginFactory, feedback){\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n        name : 'feedback',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n\r\n            //keep a ref of the feedbacks\r\n            var currentFeedback;\r\n\r\n            var testRunner = this.getTestRunner();\r\n\r\n            /**\r\n             * Close the current feedback\r\n             */\r\n            var closeCurrent = function closeCurrent(){\r\n                if(currentFeedback){\r\n                    currentFeedback.close();\r\n                }\r\n            };\r\n\r\n            //change plugin state\r\n            testRunner\r\n                .on('error', function(err){\r\n                    var message = err;\r\n                    var type = 'error';\r\n\r\n                    if ('object' === typeof err) {\r\n                        message = err.message;\r\n                        type = err.type;\r\n                    }\r\n\r\n                    if (!message) {\r\n                        switch (type) {\r\n                            case 'TestState':\r\n                                message = __('The test has been closed/suspended!');\r\n                                break;\r\n\r\n                            case 'FileNotFound':\r\n                                message = __('File not found!');\r\n                                break;\r\n\r\n                            default:\r\n                                message = __('An error occurred!');\r\n                        }\r\n                    }\r\n\r\n                    currentFeedback = feedback().error(message);\r\n                })\r\n                .on('danger', function(message){\r\n                    currentFeedback = feedback().danger(message);\r\n                })\r\n                .on('warning', function(message){\r\n                    currentFeedback = feedback().warning(message);\r\n                })\r\n                .on('info', function(message){\r\n                    currentFeedback = feedback().info(message);\r\n                })\r\n                .on('alert.* confirm.* unloaditem', closeCurrent);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/loading/loading',[\r\n    'layout/loading-bar',\r\n    'taoTests/runner/plugin'\r\n], function (loadingBar, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Creates the loading bar plugin.\r\n     * Displays a loading bar when a blocking task is running\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'loading',\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var testRunner = this.getTestRunner();\r\n            testRunner\r\n                .on('unloaditem', function () {\r\n                    loadingBar.start();\r\n                })\r\n                .on('renderitem', function () {\r\n                    loadingBar.stop();\r\n                });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\r\n */\r\n\r\n/**\r\n * @see http://www.imsglobal.org/question/qtiv2p1/imsqti_implv2p1.html#section10008 modalFeedback\r\n */\r\n\r\ndefine('taoQtiTest/runner/plugins/content/modalFeedback/modalFeedback',[\r\n    'jquery',\r\n    'lodash',\r\n    'module',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/plugins/content/dialog/itemInlineMessage',\r\n    'taoQtiTest/runner/plugins/content/dialog/itemAlertMessage',\r\n    'ui/autoscroll'\r\n], function ($, _, module, pluginFactory, inlineMessage, alertMessage, autoscroll) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Modal or inline type of the messages\r\n     */\r\n    var inlineMode;\r\n\r\n    /**\r\n     * Form of the feedback\r\n     * by default dialog (modal) form\r\n     */\r\n    var messagePlugin;\r\n\r\n    /**\r\n     * All feedback messages\r\n     */\r\n    var renderedFeedbacks;\r\n\r\n    /**\r\n     * modalFeedback was resolved and all components were destroyed\r\n     */\r\n    var isDestroyed;\r\n\r\n    /**\r\n     * Method which should be halted after modalFeedbacks confirmation action\r\n     */\r\n    var nextStep;\r\n\r\n    function destroyFeedback(feedback) {\r\n\r\n        var removed = false;\r\n        _.remove(renderedFeedbacks, function (storedFeedback) {\r\n\r\n            var found = storedFeedback === feedback;\r\n            if (found) {\r\n                removed = true;\r\n            }\r\n            return found;\r\n        });\r\n\r\n        if (removed) {\r\n            feedback.destroy();\r\n\r\n            if (!renderedFeedbacks.length) {\r\n                nextStep();\r\n            }\r\n        }\r\n    }\r\n\r\n    function defineMode(inline) {\r\n        inlineMode = inline;\r\n        messagePlugin = inlineMode ? inlineMessage : alertMessage;\r\n    }\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'QtiModalFeedback',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            nextStep = function(){};\r\n\r\n            defineMode(!!module.config().inlineModalFeedback);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render: function render() {\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n\r\n            var createMessages = function createMessages(renderingQueue, inline){\r\n\r\n                var bInlineMode = inlineMode;\r\n\r\n                isDestroyed = false;\r\n                renderedFeedbacks = [];\r\n\r\n                if (_.isBoolean(inline)) {\r\n                    defineMode(inline);\r\n                }\r\n\r\n                if (renderingQueue.length) {\r\n\r\n                    _.forEach(renderingQueue, function (renderingToken) {\r\n\r\n                        var feedback = messagePlugin(testRunner, testRunner.getAreaBroker());\r\n                        feedback.init({\r\n                            dom: renderingToken.feedback.render({\r\n                                inline: inlineMode\r\n                            }),\r\n                            // for alerts will be used #modalMessages container\r\n                            $container: inlineMode ? renderingToken.$container : null\r\n                        });\r\n                        feedback.render();\r\n\r\n                        renderedFeedbacks.push(feedback);\r\n                    });\r\n\r\n                    // auto scroll to the first feedback, only for the \"inline\" mode\r\n                    if (inlineMode && renderedFeedbacks) {\r\n                        autoscroll($('.qti-modalFeedback', testRunner.getAreaBroker().getContentArea()).first(), testRunner.getAreaBroker().getContentArea().parents('.content-wrapper'));\r\n                    }\r\n                } else {\r\n                    nextStep();\r\n                }\r\n\r\n                // restore global feedback mode\r\n                defineMode(bInlineMode);\r\n            };\r\n\r\n            if (inlineMode) {\r\n                testRunner\r\n                    .off('plugin-resume.itemInlineMessage')\r\n                    .on('plugin-resume.itemInlineMessage', function () {\r\n                        self.destroy();\r\n                    });\r\n            } else {\r\n                testRunner\r\n                    .off('plugin-resume.itemAlertMessage')\r\n                    .on('plugin-resume.itemAlertMessage', function (feedback) {\r\n                        destroyFeedback(feedback);\r\n                    });\r\n            }\r\n\r\n            testRunner.on('modalFeedbacks', function(renderingQueue, done, inline) {\r\n                nextStep = done;\r\n                createMessages(renderingQueue, inline);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         * allow to run that function only once\r\n         */\r\n        destroy: function destroy() {\r\n            var tFeedbacks, i;\r\n            if (!isDestroyed) {\r\n                isDestroyed = true;\r\n\r\n                if (!renderedFeedbacks) {\r\n                    nextStep();\r\n                } else {\r\n                    tFeedbacks = renderedFeedbacks.slice(0);\r\n                    for (i in tFeedbacks) {\r\n                        destroyFeedback(tFeedbacks[i]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Content Plugin : Overlay\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/overlay/overlay',[\r\n    'jquery',\r\n    'i18n',\r\n    'taoTests/runner/plugin'\r\n], function ($, __, pluginFactory){\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n        name : 'overlay',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n\r\n            this.$element = $('<div />');\r\n            this.$element.on('click mousedown mouseup touchstart touchend keyup keydow keypress scroll drop', function(e){\r\n                e.stopImmediatePropagation();\r\n                e.stopPropagation();\r\n            });\r\n\r\n            var shield = function shield(){\r\n                self.enable();\r\n            };\r\n            var unshield = function unshield(itemRef){\r\n                self.disable();\r\n            };\r\n\r\n            //change plugin state\r\n            testRunner\r\n                .on('disableitem',  shield)\r\n                .on('enableitem unloaditem', unshield);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render (){\r\n            var $contentArea = this.getTestRunner().getAreaBroker().getContentArea();\r\n            $contentArea.after(this.$element);\r\n        },\r\n\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enable the overlay\r\n         */\r\n        enable : function enable (){\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginsConfig = testConfig.plugins || {};\r\n            var overlayConfig = pluginsConfig.overlay || {};\r\n\r\n            this.$element.addClass('overlay');\r\n\r\n            if (overlayConfig.full) {\r\n                this.$element.addClass('overlay-full');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Disable the overlay\r\n         */\r\n        disable : function disable (){\r\n            this.$element.removeClass('overlay overlay-full');\r\n        },\r\n\r\n        /**\r\n         * Show the overlay\r\n         */\r\n        show: function show(){\r\n            this.enable();\r\n        },\r\n\r\n        /**\r\n         * Hide the overlay\r\n         */\r\n        hide: function hide(){\r\n            this.disable();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/responsiveness/collapser',[\r\n    'lodash',\r\n    'taoTests/runner/plugin'\r\n], function (_, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Name of the CSS class used to collapse the buttons\r\n     * @type {String}\r\n     */\r\n    var noLabelCls = 'no-tool-label';\r\n\r\n    /**\r\n     * Name of the CSS class used to collapse the buttons and allow to expand on mouse over\r\n     * @type {String}\r\n     */\r\n    var noLabelHoverCls = 'no-tool-label-hover';\r\n\r\n    /**\r\n     * Default plugin options\r\n     * @type {Object}\r\n     */\r\n    var defaults = {\r\n        collapseTools: true,        // collapse the tools buttons\r\n        collapseNavigation: false,  // collapse the navigation buttons\r\n        collapseInOrder: false,     // collapse any button in the given order\r\n        hover: false,               // expand when the mouse is over a button,\r\n\r\n        /**\r\n         * Allow to set manually which buttons should collapse and in which order.\r\n         * This can be set by triggering the \"collapser-set-order\" event on the testRunner.\r\n         * Given as an array of jQuery selectors: first index will be the first to be collapsed, and so on.\r\n         * If no selector is given for a button, then this one will never collapse.\r\n         * ex:\r\n         * var collapseOrder = [\r\n         *      '[data-control=\"highlight-clear\"],[data-control=\"highlight-trigger\"]',  // those will collapse first...\r\n         *      '[data-control=\"hide-review\"]',                                         // this one second...\r\n         *      '[data-control=\"set-item-flag\"]',                                       // third...\r\n         *      ...                                                                     // ...\r\n         * ];\r\n         * @type {String[]}\r\n         */\r\n        collaspeOrder: []\r\n    };\r\n\r\n    /**\r\n     * Creates the responsiveness collapser plugin.\r\n     * Reduce the size of the action bar tools when the available space is below the needed one.\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'collapser',\r\n\r\n        /**\r\n         * Installs the plugin (called when the runner bind the plugin)\r\n         */\r\n        init: function init() {\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginsConfig = testConfig.plugins || {};\r\n            var config = _.defaults(pluginsConfig.collapser || {}, defaults);\r\n            var areaBroker = testRunner.getAreaBroker();\r\n            var $actionsBar = areaBroker.getArea('actionsBar');\r\n            var $toolbox = areaBroker.getToolboxArea();\r\n            var $navigation = areaBroker.getNavigationArea();\r\n            var collapseCls = config.hover ? noLabelHoverCls : noLabelCls;\r\n\r\n\r\n            function getAvailableWidth() {\r\n                return $actionsBar.width();\r\n            }\r\n\r\n            function getToolbarWidth() {\r\n                return $toolbox.width() + $navigation.width();\r\n            }\r\n\r\n            function collapseNeeded() {\r\n                return getToolbarWidth() > getAvailableWidth();\r\n            }\r\n\r\n            function collapseAll(yes) {\r\n                if (config.collapseTools) {\r\n                    $toolbox.toggleClass(collapseCls, yes);\r\n                }\r\n                if (config.collapseNavigation) {\r\n                    $navigation.toggleClass(collapseCls, yes);\r\n                }\r\n            }\r\n\r\n            function shouldCollapseInOrder() {\r\n                return config.collapseInOrder && _.isArray(config.collapseOrder) && config.collapseOrder.length;\r\n            }\r\n\r\n            function collapseInOrder() {\r\n                var collapseOrderCopy = _.clone(config.collapseOrder),\r\n                    toCollapse;\r\n\r\n                while (collapseNeeded() && collapseOrderCopy.length) {\r\n                    toCollapse = collapseOrderCopy.shift();\r\n                    $actionsBar.find(toCollapse).toggleClass(collapseCls, true);\r\n                }\r\n            }\r\n\r\n            testRunner\r\n                .on('renderitem loaditem', function() {\r\n                    collapseAll(false);\r\n                    if (shouldCollapseInOrder()) {\r\n                        collapseInOrder();\r\n                    } else {\r\n                        collapseAll(collapseNeeded());\r\n                    }\r\n                });\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div id=\\\"qti-rubrics\\\"></div>\\r\\n\";\n  });\n});\n\n",";\ndefine(\"mathJax\", function(){});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Content Plugin : RubricBlock\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock',[\r\n    'jquery',\r\n    'i18n',\r\n    'core/promise',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'tpl!taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock'\r\n], function ($, __, Promise, hider, pluginFactory, containerTpl){\r\n    'use strict';\r\n\r\n    /**\r\n     * Ensure the <a> links opens to blank pages\r\n     * @param {jQueryElement} $container - lookup scope\r\n     */\r\n    var blankifyLinks = function blankifyLinks($container){\r\n        $('a', $container).attr('target', '_blank');\r\n    };\r\n\r\n    /**\r\n     * Apply mathjax\r\n     */\r\n    var mathify = function mathify($container) {\r\n\r\n        return new Promise(function(resolve){\r\n            if($('math', $container).length > 0){\r\n                //load mathjax only if necessary\r\n                require(['mathJax'], function(MathJax){\r\n                    if(MathJax){\r\n                        MathJax.Hub.Queue([\"Typeset\", MathJax.Hub], $container[0]);\r\n                        MathJax.Hub.Queue(resolve);\r\n                    } else {\r\n                        resolve();\r\n                    }\r\n                }, resolve);\r\n            } else {\r\n                resolve();\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n        name : 'rubricBlock',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n\r\n            this.$element = $(containerTpl());\r\n\r\n            this.hide();\r\n\r\n            //change plugin state\r\n            testRunner\r\n                .on('ready', function(){\r\n                    self.hide();\r\n                })\r\n                .on('loaditem', function(itemRef, itemData){\r\n                    if(itemData.rubrics) {\r\n                        self.$element.html(itemData.rubrics);\r\n\r\n                        blankifyLinks(self.$element);\r\n                        mathify(self.$element).then(function(){\r\n                            // notify that the rubric blocks are loaded\r\n                            testRunner.trigger('rubricblock');\r\n                        });\r\n                    }\r\n                })\r\n                .on('renderitem', function(){\r\n                    self.show();\r\n                })\r\n                .on('unloaditem', function(){\r\n                    self.hide();\r\n                    self.$element.empty();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            //attach the element before the content area\r\n            var $container = this.getAreaBroker().getContentArea();\r\n            $container.before(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enable the container\r\n         */\r\n        enable : function enable (){\r\n            this.$element.removeProp('disabled')\r\n                         .removeClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Disable the container\r\n         */\r\n        disable : function disable (){\r\n            this.$element.prop('disabled', true)\r\n                         .addClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Show the container\r\n         */\r\n        show: function show(){\r\n            hider.show(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Hide the container\r\n         */\r\n        hide: function hide(){\r\n            hider.hide(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/connectivity/connectivity',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin'\r\n], function ($, _, __, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Creates the connectivity plugin.\r\n     * Detects connectivity issues\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'connectivity',\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            // this function is mandatory\r\n        },\r\n\r\n        /**\r\n         * Installs the plugin (called when the runner bind the plugin)\r\n         */\r\n        install: function install() {\r\n\r\n            var testRunner = this.getTestRunner();\r\n\r\n            function disconnect() {\r\n                if (!testRunner.getState('disconnected')) {\r\n                    testRunner.trigger('disconnect');\r\n                }\r\n            }\r\n\r\n            function reconnect() {\r\n                if (testRunner.getState('disconnected')) {\r\n                    testRunner.trigger('reconnect');\r\n                }\r\n            }\r\n\r\n            // immediate detection of connectivity loss using Offline API\r\n            $(window).on('offline.connectivity', function() {\r\n                disconnect();\r\n            });\r\n\r\n            // immediate detection of connectivity back using Offline API\r\n            $(window).on('online.connectivity', function() {\r\n                reconnect();\r\n            });\r\n\r\n            testRunner\r\n                .on('disconnect', function() {\r\n                    testRunner.setState('disconnected', true);\r\n                })\r\n                .on('reconnect', function() {\r\n                    testRunner.setState('disconnected', false);\r\n                })\r\n                .before('error', function(e, error) {\r\n                    // detect connectivity errors as network error without error code\r\n                    if (_.isObject(error) && error.source === 'network' && !error.code) {\r\n                        disconnect();\r\n\r\n                        // prevent default error handling\r\n                        return false;\r\n                    }\r\n                });\r\n\r\n            testRunner.getProxy()\r\n                .on('receive', function() {\r\n                    // any message received, state the runner is connected\r\n                    reconnect();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            $(window).off('offline.connectivity');\r\n            $(window).off('online.connectivity');\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Control Plugin : Duration (record exact spent time duration)\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/duration/duration',[\r\n    'lodash',\r\n    'core/polling',\r\n    'core/timer',\r\n    'core/store',\r\n    'core/promise',\r\n    'taoTests/runner/plugin',\r\n], function (_, pollingFactory, timerFactory, store, Promise, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Time interval between duration capture in ms\r\n     * @type {Number}\r\n     */\r\n    var refresh = 1000;\r\n\r\n\r\n    /**\r\n     * Creates the timer plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'duration',\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n\r\n            var self = this;\r\n            var testRunner   = this.getTestRunner();\r\n            var initContext  = testRunner.getTestContext();\r\n            var initItemAttemptId = initContext.itemIdentifier + '#' + initContext.attempt;\r\n\r\n            //where the duration of attempts are stored\r\n            return store('duration-' + testRunner.getConfig().serviceCallId).then(function(durationStore){\r\n\r\n                /**\r\n                 * Gets the duration of a particular item from the store\r\n                 * @param {String} attemptId - the attempt id to get the duration for\r\n                 * @returns {Promise}\r\n                 */\r\n                function getItemDuration(attemptId){\r\n                    if(!/^(.*)+#+\\d+$/.test(attemptId)){\r\n                        return Promise.reject(new Error('Is it really an attempt id, like \"itemid#attempt\"'));\r\n                    }\r\n\r\n                    return durationStore.getItem(attemptId);\r\n                }\r\n\r\n                //one stopwatch to count the time\r\n                self.stopwatch = timerFactory({\r\n                    autoStart : false\r\n                });\r\n\r\n                return durationStore.getItem(initItemAttemptId)\r\n                    .then(function(initDuration){\r\n                        initDuration = _.isNumber(initDuration) ? initDuration : 0;\r\n\r\n                        // if the current item attempt duration is empty in the client storage,\r\n                        // the test has probably been started in another browser or computer and a crash occurred,\r\n                        // so take the server provided duration to take care of elapsed time on the same attempt\r\n                        if (!initDuration && initContext.attemptDuration) {\r\n                            return durationStore.setItem(initItemAttemptId, initContext.attemptDuration || 0);\r\n                        }\r\n                    })\r\n                    .then(function(){\r\n                        //update the duration on a regular basis\r\n                        self.polling = pollingFactory({\r\n\r\n                            action : function updateDuration() {\r\n\r\n                                //how many time elapsed from the last tick ?\r\n                                var elapsed = self.stopwatch.tick();\r\n                                var context = testRunner.getTestContext();\r\n\r\n                                //store by attempt\r\n                                var itemAttemptId = context.itemIdentifier + '#' + context.attempt;\r\n\r\n                                durationStore.getItem(itemAttemptId).then(function(duration){\r\n                                    duration = _.isNumber(duration) ? duration : 0;\r\n                                    elapsed  = _.isNumber(elapsed) && elapsed > 0 ? (elapsed / 1000) : 0;\r\n\r\n                                    //store the last duration\r\n                                    durationStore.setItem(itemAttemptId, duration + elapsed);\r\n                                });\r\n                            },\r\n                            interval : refresh,\r\n                            autoStart : false\r\n                        });\r\n\r\n                        //change plugin state\r\n                        testRunner\r\n\r\n                            .after('renderitem enableitem', function(){\r\n                                self.enable();\r\n                            })\r\n\r\n                            .before('move disableitem skip error', function(){\r\n                                if (self.getState('enabled')) {\r\n                                    self.disable();\r\n                                }\r\n                            })\r\n\r\n                            .before('move skip exit timeout', function(){\r\n                                var context = testRunner.getTestContext();\r\n                                var itemAttemptId = context.itemIdentifier + '#' + context.attempt;\r\n                                return getItemDuration(itemAttemptId).then(function(duration) {\r\n                                    var params = {\r\n                                        itemDuration: 0\r\n                                    };\r\n                                    if(_.isNumber(duration) && duration > 0){\r\n                                        params.itemDuration = duration;\r\n                                    }\r\n\r\n                                    // the duration will be sent to the server with the next request,\r\n                                    // usually submitItem() or callItemAction()\r\n                                    testRunner.getProxy().addCallActionParams(params);\r\n                                });\r\n                            })\r\n\r\n                            /**\r\n                             * @event duration.get\r\n                             * @param {String} attemptId - the attempt id to get the duration for\r\n                             * @param {getDuration} getDuration - a receiver callback\r\n                             */\r\n                            .on('plugin-get.duration', function(e, attemptId, getDuration){\r\n                                if(_.isFunction(getDuration)){\r\n                                    getDuration(getItemDuration(attemptId));\r\n                                }\r\n                            })\r\n\r\n                            .before('finish', function(){\r\n                                return new Promise(function(resolve) {\r\n                                    durationStore.removeStore()\r\n                                        .then(resolve)\r\n                                        .catch(resolve);\r\n                                });\r\n                            });\r\n                    });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            this.polling.stop();\r\n            this.stopwatch.stop();\r\n        },\r\n\r\n        /**\r\n         * Enables the duration count\r\n         */\r\n        enable : function enable (){\r\n            this.polling.start();\r\n            this.stopwatch.resume();\r\n        },\r\n\r\n        /**\r\n         * Disables the duration count\r\n         */\r\n        disable : function disable (){\r\n            this.polling.stop();\r\n            this.stopwatch.pause();\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/controls/progressbar/progressbar', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"progress-box\\\">\\r\\n    <div data-control=\\\"progress-bar\\\" class=\\\"qti-controls progressbar info\\\"></div>\\r\\n    <div data-control=\\\"progress-label\\\" class=\\\"qti-controls\\\"></div>\\r\\n</div>\\r\\n\";\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Control Plugin : Progress Bar\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/progressbar/progressbar',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'tpl!taoQtiTest/runner/plugins/controls/progressbar/progressbar',\r\n    'ui/progressbar'\r\n], function ($, _, __, pluginFactory, progressTpl){\r\n    'use strict';\r\n\r\n    /**\r\n     * Calculate progression based on the current context\r\n     *\r\n     * @param {Object} testContext - The current test context\r\n     * @param {Object} testMap - The items organization map\r\n     * @param {Object} progressConfig\r\n     * @param {String} progressConfig.indicator - to select the progression type\r\n     * @param {String} [progressConfig.scope] - to select the progression type\r\n     * @param {Bool} progressConfig.showTotal - display 'item x of y' (true) | 'item x'\r\n     * @returns {Object} the progression with a label and a ratio\r\n     */\r\n    var progressUpdater = function progressUpdater(testContext, testMap, progressConfig){\r\n\r\n\r\n        /**\r\n         * Provide progression calculation based on the type of indicator\r\n         */\r\n        var updater = {\r\n\r\n            /**\r\n            * Updates the progress bar displaying the percentage\r\n            * @param {Object} testContext The progression context\r\n            * @returns {{ratio: number, label: string}}\r\n            */\r\n            percentage : function percentage() {\r\n                var total = Math.max(1, testContext.numberItems);\r\n                var ratio = Math.floor(testContext.numberCompleted / total * 100);\r\n                return {\r\n                    ratio : ratio,\r\n                    label : ratio + '%'\r\n                };\r\n            },\r\n\r\n            /**\r\n            * Updates the progress bar displaying the position\r\n            * @param {Object} testContext The progression context\r\n            * @returns {{ratio: number, label: string}}\r\n            */\r\n            position : function position() {\r\n\r\n                //get the current test part in the map\r\n                var getTestPart = function getTestPart(){\r\n                    if(testMap && testMap.parts){\r\n                        return testMap.parts[testContext.testPartId];\r\n                    }\r\n                };\r\n\r\n                //get the current test section in the map\r\n                var getTestSection = function getTestSection(){\r\n                    var testPart = getTestPart();\r\n                    if(testPart && testPart.sections){\r\n                        return testPart.sections[testContext.sectionId];\r\n                    }\r\n                };\r\n\r\n                //provides you the methods to get total and position by scope\r\n                var progressScopeCounter = {\r\n                    test : {\r\n                        total : function(){\r\n                            return Math.max(1, testContext.numberItems);\r\n                        },\r\n                        position : function(){\r\n                            return testContext.itemPosition + 1;\r\n                        }\r\n                    },\r\n                    testPart : {\r\n                        total : function(){\r\n                            var testPart = getTestPart();\r\n                            if(testPart){\r\n                                return _.reduce(testMap.parts[testContext.testPartId].sections, function(acc, section){\r\n                                    return acc + _.size(section.items);\r\n                                }, 0);\r\n                            }\r\n                            return 0;\r\n                        },\r\n                        position : function(){\r\n                            var testSection = getTestSection();\r\n                            if(testSection){\r\n                                return testSection.items[testContext.itemIdentifier].positionInPart + 1;\r\n                            }\r\n                            return 0;\r\n                        }\r\n                    },\r\n                    testSection : {\r\n                        total : function(){\r\n                            var testSection = getTestSection();\r\n                            if(testSection){\r\n                                return _.size(testSection.items);\r\n                            }\r\n                            return 0;\r\n                        },\r\n                        position : function(){\r\n                            var testSection = getTestSection();\r\n                            if(testSection){\r\n                                return testSection.items[testContext.itemIdentifier].positionInSection + 1;\r\n                            }\r\n                            return 0;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                var counter = progressScopeCounter[progressConfig.scope] || progressScopeCounter.test;\r\n                var total = counter.total();\r\n                var currentPosition = counter.position();\r\n\r\n                return {\r\n                    ratio : total > 0 ? Math.floor(currentPosition / total * 100) : 0,\r\n                    label : progressConfig.showTotal ?\r\n                        __('Item %d of %d', currentPosition, total) :\r\n                        __('Item %d', currentPosition)\r\n                };\r\n            }\r\n        };\r\n        return updater[progressConfig.indicator]();\r\n    };\r\n\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name : 'progressBar',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var $progressLabel,\r\n                $progressControl;\r\n            var testRunner = this.getTestRunner();\r\n            var testData   = testRunner.getTestData();\r\n            var config     = testData.config.progressIndicator || {};\r\n\r\n            var progressConfig = {\r\n                indicator: config.type || 'percentage',\r\n                scope: config.scope || 'test',\r\n                showTotal: !!config.showTotal\r\n            };\r\n\r\n            /**\r\n             * Update the progress bar\r\n             */\r\n            var update = function update (){\r\n                var progressData = progressUpdater(testRunner.getTestContext(), testRunner.getTestMap(), progressConfig);\r\n                if(progressData && $progressLabel && $progressControl){\r\n                    $progressLabel.text(progressData.label);\r\n                    $progressControl.progressbar('value', progressData.ratio);\r\n                }\r\n            };\r\n\r\n            //create the progressbar\r\n            this.$element = $(progressTpl());\r\n\r\n            //store the controls\r\n            $progressLabel = $('[data-control=\"progress-label\"]', this.$element);\r\n            $progressControl = $('[data-control=\"progress-bar\"]', this.$element);\r\n\r\n            //and initialize the progress bar component\r\n            $progressControl.progressbar();\r\n\r\n            //let update the progression\r\n            update();\r\n\r\n            testRunner\r\n                .on('ready', update)\r\n                .on('loaditem', update);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            var $container = this.getAreaBroker().getControlArea();\r\n            $container.append(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/testState/testState',[\r\n    'lodash',\r\n    'taoTests/runner/plugin'\r\n], function (_, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Creates the testState plugin.\r\n     * Handle particular states of the assessment test\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'testState',\r\n\r\n        /**\r\n         * Installs the plugin (called when the runner bind the plugin)\r\n         */\r\n        install: function install() {\r\n            var testRunner = this.getTestRunner();\r\n\r\n            // middleware invoked on every requests\r\n            testRunner.getProxy()\r\n                .use(function qtiFilter(req, res, next) {\r\n                    var data = res && res.data;\r\n\r\n                    // test has been closed/suspended => redirect to the index page after message acknowledge\r\n                    if (data && data.type && data.type === 'TestState') {\r\n                        // spread the world about the reason of the leave\r\n                        testRunner.setState('closedOrSuspended', true);\r\n\r\n                        if (!testRunner.getState('ready')) {\r\n                            // if we open an inconsistent test just leave\r\n                            // should happen if we refresh an auto paused test\r\n                            testRunner.trigger('destroy');\r\n                        } else if (_.isEmpty(data.messages) || !_.find(data.messages, {channel: 'teststate'})) {\r\n                            testRunner.trigger('leave', data);\r\n                        }\r\n                        // break the chain to avoid uncaught exception in promise...\r\n                        // this will lead to unresolved promise, but the browser will be redirected soon!\r\n                        return;\r\n                    }\r\n                    next();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var testRunner = this.getTestRunner();\r\n            var isLeaving = false;\r\n\r\n            // immediate handling of proctor's actions\r\n            testRunner.getProxy()\r\n                .channel('teststate', function (data) {\r\n                    if (!isLeaving && data && ('close' === data.type || 'pause' === data.type) && !testRunner.getState('closedOrSuspended')) {\r\n                        isLeaving = true;\r\n\r\n                        testRunner.setState('closedOrSuspended', true);\r\n\r\n                        testRunner.trigger('leave', data);\r\n                    }\r\n                });\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/controls/timer/timer', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  \n  return \" disabled\";\n  }\n\n  buffer += \"<span class=\\\"qti-timer qti-timer__type-\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \" qti-controls \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.running), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" data-control=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n    <span class=\\\"qti-timer_label truncate\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\r\\n    <span class=\\\"qti-timer_time\\\"></span>\\r\\n</span>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Component that controls the display of a timer (countdown/stopwatch like) into a QTI Test.\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/timer/timerComponent',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'moment',\r\n    'core/encoder/time',\r\n    'tpl!taoQtiTest/runner/plugins/controls/timer/timer'\r\n], function ($, _, __, moment, timeEncoder, timerTpl) {\r\n    'use strict';\r\n\r\n    var hasAnimationFrame = 'requestAnimationFrame' in window;\r\n\r\n    /**\r\n     * Duration of a second in the timer's base unit\r\n     * @type {Number}\r\n     */\r\n    var precision = 1000;\r\n\r\n    /**\r\n     * In a Qti context timers could be associated to those elements\r\n     */\r\n    var timerTypes = {\r\n        test:     'assessmentTest',\r\n        testPart: 'testPart',\r\n        section:  'assessmentSection',\r\n        item:     'assessmentItemRef'\r\n    };\r\n\r\n    /**\r\n     * Create a new timer component\r\n     * @param {Object} config - the timer config\r\n     * @param {String} config.id - used to identified the timer\r\n     * @param {String} config.type - the associated type (from timerTypes above)\r\n     * @param {String} [config.label] - the label to display next to the timer\r\n     * @param {Number} [config.remaining = 0] - the remaining time\r\n     * @param {Number|Boolean} [config.warning = false] - to warn the user their is only the specified amount of time left\r\n     * @param {Boolean} [config.running = true] - timer state\r\n     * @returns {timerComponent} the timer component\r\n     * @throws {TypeError} if the config is not correct\r\n     */\r\n    var timerComponentFactory = function timerComponentFactory(config){\r\n        var data;\r\n\r\n        if(!_.isPlainObject(config)){\r\n            throw new TypeError('A timer needs to be configured using a config object');\r\n        }\r\n        if(_.isEmpty(config.id)){\r\n            throw new TypeError('A timer needs and identifier');\r\n        }\r\n        if(!_.contains(timerTypes, config.type)){\r\n            throw new TypeError('Invalid type configured');\r\n        }\r\n\r\n        data = _.defaults(config, {\r\n            label:     '',\r\n            remaining: 0,\r\n            warnings: {},\r\n            running:   true\r\n        });\r\n\r\n        /**\r\n         * @typedef {timerComponent} the component to manage the timer\r\n         */\r\n        return {\r\n\r\n            /**\r\n             * Initialize the component\r\n             * @returns {timerComponent} chains\r\n             */\r\n            init   : function init(){\r\n               this.$element = $(timerTpl(data));\r\n               this.$display = $('.qti-timer_time', this.$element);\r\n               return this;\r\n            },\r\n\r\n            /**\r\n             * Attach the component to the DOM\r\n             * @param {jQueryElement} $container - where to append the component\r\n             * @returns {timerComponent} chains\r\n             */\r\n            render : function render($container){\r\n                $container.append(this.$element);\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Destroy the component\r\n             * @returns {timerComponent} chains\r\n             */\r\n            destroy : function destroy(){\r\n                this.$element.remove();\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Refresh the display\r\n             * @returns {timerComponent} chains\r\n             */\r\n            refresh : function refresh(){\r\n                var self = this;\r\n                var update = function update(){\r\n                    self.$display.text( timeEncoder.encode( data.remaining / precision) );\r\n                };\r\n                if(hasAnimationFrame){\r\n                   window.requestAnimationFrame(update);\r\n                } else {\r\n                    update();\r\n                }\r\n\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Warn about time remaining\r\n             * @returns {Object} the warning message and type of popup\r\n             */\r\n            warn : function warn() {\r\n                var remaining,\r\n                    message = {},\r\n                    warning = _.findLast(data.warnings, { showed: false });\r\n\r\n                if (!_.isEmpty(warning)\r\n                    && _.isFinite(warning.point)\r\n                    && data.remaining <= warning.point\r\n                ) {\r\n                    remaining = moment.duration(data.remaining / precision, \"seconds\").humanize();\r\n                    this.$display.removeClass('txt-info txt-warning txt-danger').addClass('txt-' + warning.type);\r\n                    switch (data.type) {\r\n                        case 'assessmentItemRef':\r\n                            message.text = __(\"Warning – You have %s remaining to complete this item.\", remaining);\r\n                            break;\r\n\r\n                        case 'assessmentSection':\r\n                            message.text = __(\"Warning – You have %s remaining to complete this section.\", remaining);\r\n                            break;\r\n\r\n                        case 'testPart':\r\n                            message.text = __(\"Warning – You have %s remaining to complete this test part.\", remaining);\r\n                            break;\r\n\r\n                        case 'assessmentTest':\r\n                            message.text = __(\"Warning – You have %s remaining to complete the test.\", remaining);\r\n                            break;\r\n                    }\r\n\r\n                    var showed = _.find(data.warnings, { point: warning.point });\r\n                    if (showed && showed.point && data.warnings[showed.point / precision]) {\r\n                        data.warnings[showed.point / precision].showed = true;\r\n                    }\r\n\r\n                    message.type = warning.type;\r\n                }\r\n\r\n                return message;\r\n            },\r\n\r\n\r\n            /**\r\n             * Get the timer id\r\n             * @returns {String} the id\r\n             */\r\n            id  : function id(){\r\n                return data.id;\r\n            },\r\n\r\n            /**\r\n             * Get/set the current/remaining value\r\n             * @param {Number} [value] - only as a setter\r\n             * @returns {Number|timerComponent} the value as a getter, or chains as a setter\r\n             */\r\n            val : function val(value){\r\n                if(typeof value !== 'undefined'){\r\n                    data.remaining = value;\r\n                    return this;\r\n                }\r\n                return data.remaining;\r\n            },\r\n\r\n            /**\r\n             * Get/set the running state\r\n             * @param {Boolean} [value] - only as a setter\r\n             * @returns {Boolean|timerComponent} the value as a getter, or chains as a setter\r\n             */\r\n            running : function running(value){\r\n                if(typeof value !== 'undefined'){\r\n                    data.running = !!value;\r\n                    return this;\r\n                }\r\n                return !!data.running;\r\n            }\r\n        };\r\n    };\r\n\r\n    return timerComponentFactory;\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/helpers/map',[\r\n    'lodash'\r\n], function (_) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Gets an empty stats record\r\n     * @returns {Object}\r\n     */\r\n    function getEmptyStats() {\r\n        return {\r\n            questions: 0,\r\n            answered: 0,\r\n            flagged: 0,\r\n            viewed: 0,\r\n            total: 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Defines a helper that provides extractors for an assessment test map\r\n     */\r\n    return {\r\n        /**\r\n         * Gets the jumps table\r\n         * @param {Object} map - The assessment test map\r\n         * @returns {Object}\r\n         */\r\n        getJumps: function getJumps(map) {\r\n            return map && map.jumps;\r\n        },\r\n\r\n        /**\r\n         * Gets the parts table\r\n         * @param {Object} map - The assessment test map\r\n         * @returns {Object}\r\n         */\r\n        getParts: function getParts(map) {\r\n            return map && map.parts;\r\n        },\r\n\r\n        /**\r\n         * Gets the jump at a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The position of the item\r\n         * @returns {Object}\r\n         */\r\n        getJump: function getJump(map, position) {\r\n            var jumps = this.getJumps(map);\r\n            return jumps && jumps[position];\r\n        },\r\n\r\n        /**\r\n         * Gets a test part by its identifier\r\n         * @param {Object} map - The assessment test map\r\n         * @param {String} partName - The identifier of the test part\r\n         * @returns {Object}\r\n         */\r\n        getPart: function getPart(map, partName) {\r\n            var parts = this.getParts(map);\r\n            return parts && parts[partName];\r\n        },\r\n\r\n        /**\r\n         * Gets a test section by its identifier\r\n         * @param {Object} map - The assessment test map\r\n         * @param {String} sectionName - The identifier of the test section\r\n         * @returns {Object}\r\n         */\r\n        getSection: function getSection(map, sectionName) {\r\n            var parts = this.getParts(map);\r\n            var section = null;\r\n            _.forEach(parts, function (part) {\r\n                var sections = part.sections;\r\n                if (sections && sections[sectionName]) {\r\n                    section = sections[sectionName];\r\n                    return false;\r\n                }\r\n            });\r\n            return section;\r\n        },\r\n\r\n        /**\r\n         * Gets a test item by its identifier\r\n         * @param {Object} map - The assessment test map\r\n         * @param {String} itemName - The identifier of the test item\r\n         * @returns {Object}\r\n         */\r\n        getItem: function getItem(map, itemName) {\r\n            var jump = _.find(this.getJumps(map), {identifier: itemName});\r\n            return this.getItemAt(map, jump && jump.position);\r\n        },\r\n\r\n        /**\r\n         * Gets the global stats of the assessment test\r\n         * @param {Object} map - The assessment test map\r\n         * @returns {Object}\r\n         */\r\n        getTestStats: function getTestStats(map) {\r\n            return map && map.stats;\r\n        },\r\n\r\n        /**\r\n         * Gets the stats of the test part containing a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {String} partName - The identifier of the test part\r\n         * @returns {Object}\r\n         */\r\n        getPartStats: function getPartStats(map, partName) {\r\n            var part = this.getPart(map, partName);\r\n            return part && part.stats;\r\n        },\r\n\r\n        /**\r\n         * Gets the stats of the test section containing a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {String} sectionName - The identifier of the test section\r\n         * @returns {Object}\r\n         */\r\n        getSectionStats: function getSectionStats(map, sectionName) {\r\n            var section = this.getSection(map, sectionName);\r\n            return section && section.stats;\r\n        },\r\n\r\n        /**\r\n         * Gets the stats related to a particular scope\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The current position\r\n         * @param {String} [scope] - The name of the scope. Can be: test, part, section (default: test)\r\n         * @returns {Object}\r\n         */\r\n        getScopeStats: function getScopeStats(map, position, scope) {\r\n            var jump = this.getJump(map, position);\r\n\r\n            switch (scope) {\r\n                case 'section':\r\n                case 'testSection':\r\n                    return this.getSectionStats(map, jump && jump.section);\r\n\r\n                case 'part':\r\n                case 'testPart':\r\n                    return this.getPartStats(map, jump && jump.part);\r\n\r\n                default:\r\n                case 'test':\r\n                    return this.getTestStats(map);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Gets the map of a particular scope from a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The current position\r\n         * @param {String} [scope] - The name of the scope. Can be: test, part, section (default: test)\r\n         * @returns {object} The scoped map\r\n         */\r\n        getScopeMap: function getScopeMap(map, position, scope) {\r\n            // need a clone of the map as we will change some properties\r\n            var scopeMap = _.cloneDeep(map || {});\r\n\r\n            // gets the current part and section\r\n            var jump = this.getJump(map, position);\r\n            var part = this.getPart(scopeMap, jump && jump.part);\r\n            var section = this.getSection(scopeMap, jump && jump.section);\r\n\r\n            // reduce the map to the scope part\r\n            if (scope && scope !== 'test') {\r\n                scopeMap.parts = {};\r\n                if (part) {\r\n                    scopeMap.parts[jump.part] = part;\r\n                }\r\n            }\r\n\r\n            // reduce the map to the scope section\r\n            if (part && (scope === 'section' || scope === 'testSection')) {\r\n                part.sections = {};\r\n                if (section) {\r\n                    part.sections[jump.section] = section;\r\n                }\r\n            }\r\n\r\n            // update the stats to reflect the scope\r\n            if (section) {\r\n                section.stats = this.computeItemStats(section.items);\r\n            }\r\n            if (part) {\r\n                part.stats = this.computeStats(part.sections);\r\n            }\r\n            scopeMap.stats = this.computeStats(scopeMap.parts);\r\n\r\n            return scopeMap;\r\n        },\r\n\r\n        /**\r\n         * Gets the test part containing a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The position of the item\r\n         * @returns {Object}\r\n         */\r\n        getItemPart: function getItemPart(map, position) {\r\n            var jump = this.getJump(map, position);\r\n            return this.getPart(map, jump && jump.part);\r\n        },\r\n\r\n        /**\r\n         * Gets the test section containing a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The position of the item\r\n         * @returns {Object}\r\n         */\r\n        getItemSection: function getItemSection(map, position) {\r\n            var jump = this.getJump(map, position);\r\n            var part = this.getPart(map, jump && jump.part);\r\n            var sections = part && part.sections;\r\n            return sections && sections[jump && jump.section];\r\n        },\r\n\r\n        /**\r\n         * Gets the item located at a particular position\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The position of the item\r\n         * @returns {Object}\r\n         */\r\n        getItemAt: function getItemAt(map, position) {\r\n            var jump = this.getJump(map, position);\r\n            var part = this.getPart(map, jump && jump.part);\r\n            var sections = part && part.sections;\r\n            var section = sections && sections[jump && jump.section];\r\n            var items = section && section.items;\r\n            return items && items[jump && jump.identifier];\r\n        },\r\n\r\n        /**\r\n         * Applies a callback on each item of the provided map\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Function} callback(item, section, part, map) - A callback to apply on each item\r\n         * @returns {Object}\r\n         */\r\n        each: function each(map, callback) {\r\n            if (_.isFunction(callback)) {\r\n                _.forEach(map && map.parts, function(part) {\r\n                    _.forEach(part && part.sections, function(section) {\r\n                        _.forEach(section && section.items, function(item) {\r\n                            callback(item, section, part, map);\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            return map;\r\n        },\r\n\r\n        /**\r\n         * Update the map stats from a particular item\r\n         * @param {Object} map - The assessment test map\r\n         * @param {Number} position - The position of the item\r\n         * @returns {Object}\r\n         */\r\n        updateItemStats: function updateItemStats(map, position) {\r\n            var jump = this.getJump(map, position);\r\n            var part = this.getPart(map, jump && jump.part);\r\n            var sections = part && part.sections;\r\n            var section = sections && sections[jump && jump.section];\r\n\r\n            if (section) {\r\n                section.stats = this.computeItemStats(section.items);\r\n            }\r\n            if (part) {\r\n                part.stats = this.computeStats(part.sections);\r\n            }\r\n            if (map) {\r\n                map.stats = this.computeStats(map.parts);\r\n            }\r\n\r\n            return map;\r\n        },\r\n\r\n        /**\r\n         * Computes the stats for a list of items\r\n         * @param {Object} items\r\n         * @returns {Object}\r\n         */\r\n        computeItemStats: function computeItemStats(items) {\r\n            return _.reduce(items, function accStats(acc, item) {\r\n                if (!item.informational) {\r\n                    acc.questions++;\r\n                }\r\n                if (item.answered) {\r\n                    acc.answered++;\r\n                }\r\n                if (item.flagged) {\r\n                    acc.flagged++;\r\n                }\r\n                if (item.viewed) {\r\n                    acc.viewed++;\r\n                }\r\n                acc.total++;\r\n                return acc;\r\n            }, getEmptyStats());\r\n        },\r\n\r\n        /**\r\n         * Computes the global stats of a collection of stats\r\n         * @param {Object} collection\r\n         * @returns {Object}\r\n         */\r\n        computeStats: function computeStats(collection) {\r\n            return _.reduce(collection, function accStats(acc, item) {\r\n                acc.questions += item.stats.questions;\r\n                acc.answered += item.stats.answered;\r\n                acc.flagged += item.stats.flagged;\r\n                acc.viewed += item.stats.viewed;\r\n                acc.total += item.stats.total;\r\n                return acc;\r\n            }, getEmptyStats());\r\n        }\r\n    };\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * This helper provides information about the current item\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/helpers/currentItem',[\r\n    'lodash'\r\n], function (_) {\r\n    'use strict';\r\n\r\n    /**\r\n     * List of QTI model cardinalities\r\n     * @type {Object}\r\n     */\r\n    var responseCardinalities = {\r\n        single: 'base',\r\n        multiple: 'list',\r\n        ordered: 'list',\r\n        record: 'record'\r\n    };\r\n\r\n    /**\r\n     * @typedef {currentItemHelper}\r\n     */\r\n    var currentItemHelper = {\r\n        /**\r\n         * Gets the responses declarations of the current item.\r\n         * @param {Object} runner - testRunner instance\r\n         * @returns {Object}\r\n         */\r\n        getDeclarations: function getDeclarations(runner) {\r\n            var itemRunner = runner.itemRunner;\r\n            return itemRunner._item && itemRunner._item.responses;\r\n        },\r\n\r\n        /**\r\n         * Gets a response declaration by the identifier of the response\r\n         * @param {Object} runner - testRunner instance\r\n         * @param {String} identifier - The identifier of the response\r\n         * @returns {Object|null}\r\n         */\r\n        getResponseDeclaration: function getResponseDeclaration(runner, identifier) {\r\n            var found = null;\r\n            _.forEach(currentItemHelper.getDeclarations(runner), function (declaration) {\r\n                var attributes = declaration.attributes || {};\r\n                if (attributes.identifier === identifier) {\r\n                    found = declaration;\r\n                    return false;\r\n                }\r\n            });\r\n            return found;\r\n        },\r\n\r\n        /**\r\n         * Convert a value to a response object\r\n         * @param {Array|String} value\r\n         * @param {String} baseType\r\n         * @param {String} cardinality\r\n         * @returns {Object}\r\n         */\r\n        toResponse: function toResponse(value, baseType, cardinality) {\r\n            var mappedCardinality = responseCardinalities[cardinality];\r\n            var response = {};\r\n\r\n            if (_.isString(value)) {\r\n                value = [value];\r\n            }\r\n\r\n            value = _.map(value || [], function (v) {\r\n                return (baseType === 'boolean') ? (v === true || v === 'true') : v;\r\n            });\r\n\r\n            if (mappedCardinality) {\r\n                if (mappedCardinality === 'base') {\r\n                    if (value.length === 0) {\r\n                        //return empty response:\r\n                        response.base = null;\r\n                    } else {\r\n                        response.base = {};\r\n                        response.base[baseType] = value[0];\r\n                    }\r\n                } else {\r\n                    response[mappedCardinality] = {};\r\n                    response[mappedCardinality][baseType] = value;\r\n                }\r\n            }\r\n\r\n            return response;\r\n        },\r\n\r\n        /**\r\n         * Checks if the provided value can be considered as null\r\n         * @param {Object} value\r\n         * @param {String} baseType\r\n         * @param {String} cardinality\r\n         * @returns {boolean}\r\n         */\r\n        isQtiValueNull: function isQtiValueNull(value, baseType, cardinality) {\r\n            var mappedCardinality = responseCardinalities[cardinality];\r\n            if (_.isObject(value) && value[mappedCardinality] && 'undefined' !== typeof value[mappedCardinality][baseType]) {\r\n                value = value[mappedCardinality][baseType];\r\n            }\r\n            return null === value || ('string' === baseType && _.isEmpty(value)) || (cardinality !== 'single' && _.isEmpty(value));\r\n        },\r\n\r\n        /**\r\n         * Tells if an item question has been answered or not\r\n         * @param response\r\n         * @param baseType\r\n         * @param cardinality\r\n         * @param [defaultValue]\r\n         * @returns {*}\r\n         */\r\n        isQuestionAnswered: function isQuestionAnswered(response, baseType, cardinality, defaultValue) {\r\n            var answered;\r\n            defaultValue = defaultValue || null;\r\n            if (currentItemHelper.isQtiValueNull(response, baseType, cardinality)) {\r\n                answered = !currentItemHelper.isQtiValueNull(defaultValue, baseType, cardinality);\r\n            } else {\r\n                answered = !_.isEqual(response, currentItemHelper.toResponse(defaultValue, baseType, cardinality));\r\n            }\r\n            return answered;\r\n        },\r\n\r\n        /**\r\n         * Tells is the current item has been answered or not\r\n         * The item is considered answered when at least one response has been set to not empty {base : null}\r\n         * @param {Object} runner - testRunner instance\r\n         * @returns {Boolean}\r\n         */\r\n        isAnswered: function isAnswered(runner) {\r\n            var itemRunner = runner.itemRunner;\r\n            var responses = itemRunner && itemRunner.getResponses();\r\n            var count = 0;\r\n            var empty = 0;\r\n\r\n            if (itemRunner) {\r\n                _.forEach(currentItemHelper.getDeclarations(runner), function (declaration) {\r\n                    var attributes = declaration.attributes || {};\r\n                    var response = responses[attributes.identifier];\r\n                    var baseType = attributes.baseType;\r\n                    var cardinality = attributes.cardinality;\r\n\r\n                    count++;\r\n                    if (!currentItemHelper.isQuestionAnswered(response, baseType, cardinality, declaration.defaultValue)) {\r\n                        empty++;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return count !== 0 && empty !== count;\r\n        }\r\n    };\r\n\r\n    return currentItemHelper;\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * This helper provides more statistics about the test\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/helpers/stats',[\r\n    'lodash',\r\n    'taoQtiTest/runner/helpers/map',\r\n    'taoQtiTest/runner/helpers/currentItem'\r\n], function (_, mapHelper, currentItemHelper) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Return scope stats that takes into account any test taker interaction made since the item has been loaded\r\n     * @param {String} scope - scope to consider for calculating the stats\r\n     * @param {Object} runner - testRunner instance\r\n     * @returns {Object}\r\n     */\r\n    function getInstantStats(scope, runner) {\r\n        var map = runner.getTestMap(),\r\n            context = runner.getTestContext(),\r\n            stats = _.clone(mapHelper.getScopeStats(map, context.itemPosition, scope)),\r\n\r\n            isItemCurrentlyAnswered = currentItemHelper.isAnswered(runner);\r\n\r\n        if (isItemCurrentlyAnswered){\r\n            if (!isItemCurrentlyAnswered && context.itemAnswered) {\r\n                stats.answered--;\r\n            }\r\n\r\n            if (isItemCurrentlyAnswered && !context.itemAnswered) {\r\n                stats.answered++;\r\n            }\r\n        }\r\n        return stats;\r\n    }\r\n\r\n    return {\r\n        getInstantStats: getInstantStats\r\n    };\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/helpers/messages',[\r\n    'i18n',\r\n    'taoQtiTest/runner/helpers/map',\r\n    'taoQtiTest/runner/helpers/stats'\r\n], function (__, mapHelper, statsHelper) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Completes an exit message\r\n     * @param {String} message - custom message that will be appended to the unanswered stats count\r\n     * @param {String} scope - scope to consider for calculating the stats\r\n     * @param {Object} runner - testRunner instance\r\n     * @returns {String} Returns the message text\r\n     */\r\n    function getExitMessage(message, scope, runner) {\r\n        var stats = statsHelper.getInstantStats(scope, runner),\r\n            unansweredCount = stats && (stats.questions - stats.answered),\r\n            flaggedCount = stats && stats.flagged,\r\n            itemsCountMessage = '';\r\n\r\n        var testData = runner.getTestData(),\r\n            testConfig = testData && testData.config,\r\n            messageEnabled = testConfig ? testConfig.enableUnansweredItemsWarning : true;\r\n\r\n        if (messageEnabled) {\r\n            if (flaggedCount && unansweredCount) {\r\n                itemsCountMessage = __('You have %s unanswered question(s) and have %s item(s) marked for review.',\r\n                    unansweredCount.toString(),\r\n                    flaggedCount.toString()\r\n                );\r\n\r\n            } else if (flaggedCount) {\r\n                itemsCountMessage = __('You have %s item(s) marked for review.', flaggedCount.toString());\r\n\r\n            } else if (unansweredCount) {\r\n                itemsCountMessage = __('You have %s unanswered question(s).', unansweredCount.toString());\r\n            }\r\n        }\r\n        return (itemsCountMessage + ' ' + message).trim();\r\n    }\r\n\r\n    return {\r\n        getExitMessage: getExitMessage\r\n    };\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/controls/timer/timers', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"timer-box\\\"></div>\\r\\n\";\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Control Plugin : Timer\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/timer/timer',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'core/promise',\r\n    'core/polling',\r\n    'core/timer',\r\n    'core/store',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/plugins/controls/timer/timerComponent',\r\n    'taoQtiTest/runner/helpers/messages',\r\n    'tpl!taoQtiTest/runner/plugins/controls/timer/timers'\r\n], function($, _, __, Promise, pollingFactory, timerFactory, store, hider, pluginFactory, timerComponentFactory, messages, timerBoxTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Time interval between timer refreshes, in milliseconds\r\n     * @type {Number}\r\n     */\r\n    var timerRefresh = 1000;\r\n\r\n    /**\r\n     * Duration of a second in the timer's base unit\r\n     * @type {Number}\r\n     */\r\n    var precision = 1000;\r\n\r\n    /**\r\n     * The message to display when exiting\r\n     */\r\n    var exitMessage = __('After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?');\r\n\r\n\r\n    var timerTypes = {\r\n        test: 'assessmentTest',\r\n        testPart: 'testPart',\r\n        section: 'assessmentSection',\r\n        item: 'assessmentItemRef'\r\n    };\r\n\r\n    /**\r\n     * Are we in a timed section\r\n     * @param {Object} context - the current test context\r\n     * @returns {Boolean}\r\n     */\r\n    var isTimedSection = function isTimedSection(context) {\r\n        var timeConstraints = context.timeConstraints || [];\r\n        return _.some(timeConstraints, function(constraint) {\r\n            return constraint.qtiClassName === 'assessmentSection';\r\n        });\r\n    };\r\n\r\n\r\n    /**\r\n     * Creates the timer plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'timer',\r\n\r\n        /**\r\n         * Installation of the plugin (called before init)\r\n         */\r\n        install: function install() {\r\n            var self = this;\r\n            //the storechange event is fired early (before runner's init is done)\r\n            //so we attach the handler early\r\n            var testRunner = this.getTestRunner();\r\n            testRunner.on('storechange', function handleStoreChange() {\r\n                self.shouldClearStorage = true;\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n\r\n            var self         = this;\r\n            var testRunner   = this.getTestRunner();\r\n            var testData     = testRunner.getTestData() || {};\r\n            var itemStates   = testData.itemStates || {};\r\n            var timerWarning = testData.config && testData.config.timerWarning || {};\r\n\r\n            var displayedTimers = {};\r\n            var timers = {};\r\n\r\n            var extraTime = 0;\r\n            var consumedExtraTime = 0;\r\n            var lastConsumedExtraTime = 0;\r\n\r\n            /**\r\n             * Gets the remaining extra time, if any\r\n             * @returns {Number} the remaining extra time in milliseconds\r\n             */\r\n            var getRemainingExtraTime = function getRemainingExtraTime() {\r\n                return Math.max(0, extraTime - consumedExtraTime) * precision;\r\n            };\r\n\r\n            /**\r\n             * Sets correctly the remaining time on a timer config set\r\n             * @param {Object} timerConfig\r\n             * @param {Number} remaining\r\n             * @returns {Object}\r\n             */\r\n            var setRemainingTime = function setRemainingTime(timerConfig, remaining) {\r\n                // will display the timer with extra time, if any\r\n                timerConfig.remaining = remaining + getRemainingExtraTime();\r\n\r\n                // keep track of the regular timer, without extra time\r\n                timerConfig.regular = remaining;\r\n\r\n                return timerConfig;\r\n            };\r\n\r\n            /**\r\n             * Load the configuration of a timer from the current context\r\n             * @param {String} type - the timer type/qtiClass\r\n             * @returns {Object} the timer config if there's one for the given type\r\n             */\r\n            var getTimerConfig = function getTimerConfig(type) {\r\n                var timeConstraint;\r\n                var timer;\r\n                var closestPreviousWarning;\r\n                var context = testRunner.getTestContext();\r\n\r\n                // get the config of each timer\r\n                if (!context.isTimeout && context.itemSessionState === itemStates.interacting) {\r\n                    timeConstraint = _.findLast(context.timeConstraints, {\r\n                        qtiClassName: type\r\n                    });\r\n                    if (timeConstraint) {\r\n                        timer = setRemainingTime({\r\n                            label: timeConstraint.label,\r\n                            type: timeConstraint.qtiClassName,\r\n                            id: timeConstraint.source,\r\n                            running: true,\r\n                            warnings: {}\r\n                        }, timeConstraint.seconds * precision);\r\n\r\n                        _(timerWarning[timeConstraint.qtiClassName]).forEach(function(value, key) {\r\n                            if (_.contains(['info', 'warning', 'danger'], value)) {\r\n                                timer.warnings[key] = {\r\n                                    type: value,\r\n                                    showed: timer.remaining / precision <= key,\r\n                                    point: parseInt(key, 10) * precision\r\n                                };\r\n                            }\r\n                        });\r\n\r\n                        closestPreviousWarning = _.find(timer.warnings, {\r\n                            showed: true\r\n                        });\r\n                        if (!_.isEmpty(closestPreviousWarning) && closestPreviousWarning.point && timer.warnings[closestPreviousWarning.point / precision]) {\r\n                            timer.warnings[closestPreviousWarning.point / precision].showed = false;\r\n                        }\r\n                    }\r\n                }\r\n                return timer;\r\n            };\r\n\r\n            //TODO this kind of function is generic enough to be moved to a util/helper\r\n            var leaveTimedSection = function leaveTimedSection(type, scope, position) {\r\n                var context = testRunner.getTestContext();\r\n                var map = testRunner.getTestMap();\r\n\r\n                var section = map.parts[context.testPartId].sections[context.sectionId];\r\n                var nbItems = _.size(section.items);\r\n                var item = _.find(section.items, {\r\n                    position: context.itemPosition\r\n                });\r\n\r\n                if (!context.isTimeout && context.itemSessionState !== itemStates.closed && isTimedSection(context) && item) {\r\n\r\n                    return !!((type === 'next' && (scope === 'assessmentSection' || ((item.positionInSection + 1) === nbItems))) ||\r\n                        (type === 'previous' && item.positionInSection === 0) ||\r\n                        (type === 'jump' && position > 0 && (position < section.position || position >= section.position + nbItems)));\r\n\r\n                }\r\n                return false;\r\n            };\r\n\r\n            /**\r\n             * Remove a timer from the current ones\r\n             * @param {String} type - the timer type to remove\r\n             */\r\n            var removeTimer = function removeTimer(type) {\r\n                if (displayedTimers[type]) {\r\n                    self.storage.removeItem(displayedTimers[type].id());\r\n\r\n                    displayedTimers[type].destroy();\r\n                    displayedTimers = _.omit(displayedTimers, type);\r\n                    timers = _.omit(timers, type);\r\n\r\n                    /**\r\n                     * @event timerPlugin#removetimer\r\n                     * @param {String} type of timer (such as 'assessmentSection', 'testPart' etc.)\r\n                     */\r\n                    self.trigger('removetimer', type);\r\n                }\r\n            };\r\n\r\n            /**\r\n             * Add and initialize a timer of the given type\r\n             * @param {Object} config - the timer config\r\n             * @param {String} type - the timer type to remove\r\n             */\r\n            var addTimer = function addTimer(type, config) {\r\n                if (config) {\r\n                    // track the regular remaining timer, without the extra time\r\n                    timers[type] = config.regular;\r\n\r\n                    // creates the component that will display the final timer\r\n                    displayedTimers[type] = timerComponentFactory(config);\r\n                    displayedTimers[type]\r\n                        .init()\r\n                        .render(self.$element);\r\n\r\n                    /**\r\n                     * @event timerPlugin#addtimer\r\n                     * @param {String} type of timer (such as 'assessmentSection', 'testPart' etc.)\r\n                     * @param {Object} timer instance ('core/timer' timer factory).\r\n                     */\r\n                    self.trigger('addtimer', type, displayedTimers[type]);\r\n                }\r\n            };\r\n\r\n            /**\r\n             * Update the timers.\r\n             * It will remove, let, add or update the current timers based on the current context.\r\n             */\r\n            var updateTimers = function updateTimers(checkStorage) {\r\n                var timerUpdatePromises = [];\r\n                var context = testRunner.getTestContext();\r\n                if (context.extraTime) {\r\n                    extraTime = context.extraTime.total;\r\n                    consumedExtraTime = Math.max(consumedExtraTime, context.extraTime.consumed);\r\n                }\r\n\r\n                _.forEach(timerTypes, function(type) {\r\n                    timerUpdatePromises.push(\r\n                        new Promise(function(resolve) {\r\n                            var timerConfig = getTimerConfig(type);\r\n\r\n                            if (displayedTimers[type]) {\r\n                                if (!timerConfig) {\r\n                                    removeTimer(type);\r\n                                } else if (displayedTimers[type].id() !== timerConfig.id) {\r\n                                    removeTimer(type);\r\n                                    addTimer(type, timerConfig);\r\n                                } else {\r\n                                    setRemainingTime(timerConfig, timers[type]);\r\n                                    displayedTimers[type].val(timerConfig.remaining);\r\n                                }\r\n                                return resolve();\r\n                            } else if (timerConfig) {\r\n\r\n                                if (checkStorage) {\r\n                                    //check for the last value in the storage\r\n                                    self.storage.getItem(timerConfig.id).then(function(savedTime) {\r\n                                        if (_.isNumber(savedTime) && savedTime >= 0) {\r\n                                            setRemainingTime(timerConfig, savedTime);\r\n                                        }\r\n                                        addTimer(type, timerConfig);\r\n                                        return resolve();\r\n                                    }).catch(function() {\r\n                                        //add the timer even if the storage doesn't work\r\n                                        addTimer(type, timerConfig);\r\n                                        return resolve();\r\n                                    });\r\n                                } else {\r\n                                    addTimer(type, timerConfig);\r\n                                    return resolve();\r\n                                }\r\n                            } else {\r\n                                return resolve();\r\n                            }\r\n                        })\r\n                    );\r\n                });\r\n                return Promise.all(timerUpdatePromises);\r\n            };\r\n\r\n            /**\r\n             * Secured call to enable\r\n             */\r\n            function doEnable() {\r\n                if (!self.getState('enabled')) {\r\n                    self.enable();\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Secured call to disable\r\n             */\r\n            function doDisable() {\r\n                if (self.getState('enabled')) {\r\n                    self.disable();\r\n                }\r\n            }\r\n\r\n            return store('timer-' + testRunner.getConfig().serviceCallId)\r\n                .then(function(timeStore) {\r\n                    if (self.shouldClearStorage) {\r\n                        return timeStore.clear().then(function() {\r\n                            return timeStore;\r\n                        });\r\n                    }\r\n                    return Promise.resolve(timeStore);\r\n                }).then(function(timeStore) {\r\n\r\n                    //the timer's storage\r\n                    self.storage = timeStore;\r\n\r\n                    //the element that'll contain the timers\r\n                    self.$element = $(timerBoxTpl());\r\n\r\n                    //one stopwatch to count the time\r\n                    self.stopwatch = timerFactory({\r\n                        autoStart: false\r\n                    });\r\n\r\n                    //update the timers at regular intervals\r\n                    self.polling = pollingFactory({\r\n\r\n                        /**\r\n                         * The polling action consists in updating each timers,\r\n                         * checking timeout and warnings\r\n                         */\r\n                        action: function updateTime() {\r\n\r\n                            //how many time elapsed from the last tick ?\r\n                            var elapsed = self.stopwatch.tick();\r\n                            var elapsedExtraTime = 0;\r\n                            var timeout = false;\r\n                            var timeoutScope, timeoutRef;\r\n\r\n                            _.forEach(displayedTimers, function(timer, type) {\r\n                                var regularVal,\r\n                                    displayedVal,\r\n                                    warning;\r\n                                var runTimeout = function runTimeout() {\r\n                                    testRunner.timeout(timeoutScope, timeoutRef);\r\n                                };\r\n\r\n                                if (timer.running()) {\r\n                                    regularVal = timers[type] - elapsed;\r\n                                    displayedVal = timer.val() - elapsed;\r\n                                    timers[type] = Math.max(regularVal, 0);\r\n                                    timer\r\n                                        .val(Math.max(displayedVal, 0))\r\n                                        .refresh();\r\n\r\n                                    if (regularVal <= 0) {\r\n                                        // compute the actual consumed extra time for this period\r\n                                        elapsedExtraTime = Math.max(elapsedExtraTime, Math.abs(regularVal));\r\n                                    }\r\n\r\n                                    if (displayedVal <= 0) {\r\n                                        timer.running(false);\r\n                                        timeout = true;\r\n                                        timeoutRef = timer.id();\r\n                                        timeoutScope = type;\r\n\r\n                                        self.storage.setItem(timer.id(), 0)\r\n                                            .then(runTimeout)\r\n                                            .catch(runTimeout);\r\n\r\n                                    } else {\r\n                                        self.storage.setItem(timer.id(), timers[type]);\r\n                                        warning = timer.warn();\r\n                                        if (!_.isEmpty(warning)) {\r\n                                            testRunner.trigger(warning.type, warning.text);\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                            if (elapsedExtraTime) {\r\n                                consumedExtraTime += elapsedExtraTime / precision;\r\n                                lastConsumedExtraTime += elapsedExtraTime;\r\n                            }\r\n                            if (timeout) {\r\n                                self.disable();\r\n                            }\r\n                        },\r\n                        interval: timerRefresh,\r\n                        autoStart: false\r\n                    });\r\n\r\n                    //change plugin state\r\n                    testRunner\r\n                        .before('renderitem resumeitem', function() {\r\n                            return updateTimers(true);\r\n                        })\r\n                        .on('enableitem', doEnable)\r\n                        .on('disableitem disconnect', doDisable)\r\n                        .after('renderitem', doEnable)\r\n                        .before('move', function(e, type, scope, position) {\r\n                            var context = testRunner.getTestContext();\r\n                            var testData = testRunner.getTestData();\r\n                            var config = testData && testData.config;\r\n                            var timerConfig = config && config.timer || {};\r\n                            var options = context && context.options || {};\r\n\r\n                            var movePromise = new Promise(function(resolve, reject) {\r\n                                // endTestWarning has already been displayed, so we don't repeat the warning\r\n                                if (context.isLast && options.endTestWarning) {\r\n                                    resolve();\r\n                                    // display a message if we exit a timed section\r\n                                } else if (leaveTimedSection(type, scope, position) && !options.noExitTimedSectionWarning && !timerConfig.keepUpToTimeout) {\r\n                                    testRunner.trigger('confirm.exittimed', messages.getExitMessage(exitMessage, 'section', testRunner), resolve, reject);\r\n                                } else {\r\n                                    resolve();\r\n                                }\r\n                            });\r\n\r\n                            movePromise\r\n                                .then(function doMove() {\r\n                                    //pause the timers when moving\r\n                                    doDisable();\r\n                                    removeTimer(timerTypes.item);\r\n                                })\r\n                                .catch(function cancelMove() {\r\n                                    // Use `defer` to be sure the timer resume will occur after the move event is\r\n                                    // finished to be handled. Otherwise, the duration plugin will be frozen and\r\n                                    // the additional time will not be taken into account!\r\n                                    _.defer(function() {\r\n                                        testRunner.trigger('enableitem enablenav');\r\n                                    });\r\n                                });\r\n\r\n                            return movePromise;\r\n                        })\r\n                        .before('move skip exit timeout', function() {\r\n                            testRunner.getProxy().addCallActionParams({\r\n                                consumedExtraTime: lastConsumedExtraTime / precision\r\n                            });\r\n                            lastConsumedExtraTime = 0;\r\n                        })\r\n                        .before('finish', function() {\r\n                            return new Promise(function(resolve) {\r\n                                self.storage.removeStore()\r\n                                    .then(resolve)\r\n                                    .catch(resolve);\r\n                            });\r\n                        });\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render: function render() {\r\n            var $container = this.getAreaBroker().getControlArea();\r\n            $container.append(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            this.polling.stop();\r\n            this.stopwatch.stop();\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enables the timers\r\n         */\r\n        enable: function enable() {\r\n            this.polling.start();\r\n            this.stopwatch.resume();\r\n        },\r\n\r\n        /**\r\n         * Disables the timers\r\n         */\r\n        disable: function disable() {\r\n            this.polling.stop();\r\n            this.stopwatch.pause();\r\n        },\r\n\r\n        /**\r\n         * Shows the timers\r\n         */\r\n        show: function show() {\r\n            hider.show(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Hides the timers\r\n         */\r\n        hide: function hide() {\r\n            hider.hide(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/controls/title/title', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n        <span data-control=\\\"\";\n  if (helper = helpers.control) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.control); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"qti-controls\\\" title=\\\"\";\n  if (helper = helpers.text) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.text); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\";\n  stack1 = helpers.unless.call(depth0, (data == null || data === false ? data : data.first), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  if (helper = helpers.text) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.text); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\r\\n    \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  \n  return \" - \";\n  }\n\n  buffer += \"<div class=\\\"title-box truncate\\\">\\r\\n    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.titles), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Control Plugin : Title\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/title/title',[\r\n    'jquery',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'tpl!taoQtiTest/runner/plugins/controls/title/title'\r\n], function ($, __, pluginFactory, titleTpl){\r\n    'use strict';\r\n\r\n    return pluginFactory({\r\n        name : 'title',\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var testData   = testRunner.getTestData();\r\n\r\n            var createElement = function(){\r\n\r\n                var context  = testRunner.getTestContext();\r\n                var titles =  [{\r\n                    control : 'qti-test-title',\r\n                    text    : testData.title\r\n                }];\r\n               if(context.isDeepestSectionVisible){\r\n                    titles.push({\r\n                        control : 'qti-test-position',  //WTF !? isn't it the section title... ?\r\n                        text    : context.sectionTitle\r\n                    });\r\n                }\r\n\r\n                return $(titleTpl({ titles : titles }));\r\n            };\r\n\r\n            this.$element = createElement();\r\n\r\n\r\n            testRunner\r\n                .after('renderitem', function(){\r\n                    var $element = createElement();\r\n                    self.$element.replaceWith($element);\r\n                    self.$element = $element;\r\n                });\r\n\r\n        },\r\n        render : function render(){\r\n            var $container = this.getAreaBroker().getControlArea();\r\n            $container.append(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * Test Runner Control Plugin : Item Trace Variables\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/controls/trace/itemTraceVariables',[\r\n    'lodash',\r\n    'moment',\r\n    'core/store',\r\n    'taoTests/runner/plugin'\r\n], function (_, moment, storeFactory, pluginFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Duration of a second in the timer's base unit\r\n     * @type {Number}\r\n     */\r\n    var precision = 1000;\r\n\r\n    /**\r\n     * Gets the current timestamp\r\n     * @returns {Number}\r\n     */\r\n    function timestamp() {\r\n        return Date.now() / precision;\r\n    }\r\n\r\n    /**\r\n     * Creates the timer plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'itemTraceVariables',\r\n\r\n        /**\r\n         * Installation of the plugin (called before init)\r\n         */\r\n        install: function install() {\r\n            var self = this;\r\n            self.getTestRunner().on('storechange', function () {\r\n                self.shouldClearStorage = true;\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var variables = {};\r\n\r\n            function onError(err) {\r\n                testRunner.trigger('error', err);\r\n            }\r\n\r\n            return storeFactory('trace-' + testRunner.getConfig().serviceCallId)\r\n                .then(function (tracesStore) {\r\n                    if (self.shouldClearStorage) {\r\n                        return tracesStore.clear().then(function () {\r\n                            return tracesStore;\r\n                        });\r\n                    }\r\n                    return tracesStore;\r\n                }).then(function (tracesStore) {\r\n                    testRunner\r\n                        .after('renderitem enableitem', function () {\r\n                            var context = testRunner.getTestContext();\r\n\r\n                            variables = {\r\n                                ITEM_START_TIME_CLIENT: timestamp()\r\n                            };\r\n\r\n                            tracesStore.getItem(context.itemUri)\r\n                                .then(function (data) {\r\n                                    if (data) {\r\n                                        _.merge(variables, data);\r\n                                    }\r\n\r\n                                    return tracesStore.setItem(context.itemUri, variables);\r\n                                })\r\n                                .catch(onError);\r\n                        })\r\n\r\n                        .before('move skip exit timeout', function () {\r\n                            var context = testRunner.getTestContext();\r\n\r\n                            variables.ITEM_END_TIME_CLIENT = timestamp();\r\n                            variables.ITEM_TIMEZONE = moment().utcOffset(moment().utcOffset()).format('Z');\r\n\r\n                            return tracesStore.setItem(context.itemUri, variables).catch(onError);\r\n                        })\r\n\r\n                        .before('unloaditem', function () {\r\n                            var context = testRunner.getTestContext();\r\n                            return testRunner.getProxy().callItemAction(context.itemUri, 'storeTraceData', {\r\n                                traceData: JSON.stringify(variables)\r\n                            });\r\n                        })\r\n\r\n                        .before('finish', function () {\r\n                            return new Promise(function (resolve) {\r\n                                tracesStore.removeStore()\r\n                                    .then(resolve)\r\n                                    .catch(resolve);\r\n                            });\r\n                        });\r\n                });\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * This is a helper for navigation plugins. It decides if a warning should be displayed\r\n * before actually moving to the next item\r\n *\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/next/nextWarningHelper',[], function () {\r\n    'use strict';\r\n\r\n    /**\r\n     * Convert a value to a boolean\r\n     * @param {*} value\r\n     * @param {Boolean} defaultValue\r\n     * @returns {Boolean}\r\n     */\r\n    var toBoolean = function toBoolean(value, defaultValue) {\r\n        if (typeof(value) === \"undefined\") {\r\n            return defaultValue;\r\n        } else {\r\n            return (value === true || value === \"true\");\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {Boolean} options.endTestWarning - enables the end test warning, when applicable\r\n     * @param {Boolean} options.isLast - if the item is the last of the test\r\n     * @param {Boolean} options.isLinear - if the current part is linear\r\n     * @param {Boolean} options.nextItemWarning - enables the next item warning, when applicable\r\n     * @param {Boolean} options.nextPartWarning - enables the next item warning on part change\r\n     * @param {Boolean} options.stats - current state of the test\r\n     * @param {Object} options.nextPart - description of the next part of the test\r\n     * @param {Number} options.remainingAttempts - remaining attempts for the current item\r\n     * @param {String} options.testPartId - current test part identifier\r\n     * @param {Boolean} options.unansweredOnly - warn only if there are unanswered/flagged items\r\n     * @returns {Object}\r\n     */\r\n    var nextWarningHelper = function nextWarningHelper(options) {\r\n        var endTestWarning      = toBoolean(options.endTestWarning, false),\r\n            isLast              = toBoolean(options.isLast, false),\r\n            isLinear            = toBoolean(options.isLinear, false),\r\n            nextItemWarning     = toBoolean(options.nextItemWarning, false),\r\n            nextPartWarning     = toBoolean(options.nextPartWarning, false),\r\n            stats               = options.stats,\r\n            nextPart            = options.nextPart || {},\r\n            remainingAttempts   = typeof(options.remainingAttempts) === 'undefined' ? -1 : options.remainingAttempts,\r\n            testPartId          = options.testPartId || '',\r\n            unansweredOnly      = toBoolean(options.unansweredOnly, false),\r\n\r\n            warnBeforeNext = shouldWarnBeforeNext(),\r\n            warnBeforeEnd = shouldWarnBeforeEnd();\r\n\r\n        /**\r\n         * Decide if we should display a warning before moving to the next item.\r\n         * This is useful to prevent accidental navigation (for example by pressing a shortcut) that would occur\r\n         * before the test taker actually gets a chance to answer an item\r\n         */\r\n        function shouldWarnBeforeNext() {\r\n            return nextItemWarning\r\n                && !itemCanBeTriedAtWill();\r\n                //&& !exitTimedSectionWarning(); //todo: this should be implemented to prevent a double warning!\r\n        }\r\n\r\n        /**\r\n         * We try to decide if the test taker has the freedom to come back to this item as many times as he wants\r\n         */\r\n        function itemCanBeTriedAtWill() {\r\n            return (\r\n                isLast === false                // the test is not over\r\n                && isLinear === false           // the context is not linear\r\n                && remainingAttempts === -1     // the item doesn't have a configured max attempts number\r\n                && !isNextItemInLinearPart()    // the next item is not in a linear part\r\n            );\r\n        }\r\n\r\n        /**\r\n         * Check if the next item is in a linear part, as this would prevent the test taker to come back to the current item\r\n         */\r\n        function isNextItemInLinearPart() {\r\n            return nextPart && typeof nextPart.isLinear !== 'undefined'\r\n                && isLastOfPart()\r\n                && nextPart.isLinear === true;\r\n        }\r\n\r\n        /**\r\n         * Decide if we should display a warning before ending the test\r\n         */\r\n        function shouldWarnBeforeEnd() {\r\n            return shouldWarnOnTestEnd()\r\n                || shouldWarnOnPartChange();\r\n        }\r\n\r\n        /**\r\n         * Are we on the last test item?\r\n         * @returns {Boolean}\r\n         */\r\n        function shouldWarnOnTestEnd() {\r\n            return isLast\r\n                && (\r\n                    endTestWarning                      // warning is explicitly required by endTestWarning category\r\n                    || warnBeforeNext                   // warning is implicitly triggered by the next item warning being true (prevent double warning)\r\n                )\r\n                && shouldWarnForUnansweredItems();\r\n        }\r\n\r\n        /**\r\n         * Provide the opportunity to cancel the display of the warning if there are no unanswered/flagged item\r\n         * for this to work, the unansweredOnly option has to be set\r\n         * @returns {Boolean}\r\n         */\r\n        function shouldWarnForUnansweredItems() {\r\n            var hasUnanswered = stats && ((stats.questions - stats.answered) !== 0),\r\n                hasFlagged = stats && stats.flagged !== 0;\r\n\r\n            if (unansweredOnly) {\r\n                return (hasUnanswered || hasFlagged);\r\n            } else {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Are we on the last part item?\r\n         * @returns {Boolean}\r\n         */\r\n        function shouldWarnOnPartChange() {\r\n            return nextPartWarning\r\n                && isLastOfPart()\r\n                && shouldWarnForUnansweredItems();\r\n        }\r\n\r\n        /**\r\n         * Check if the next item belong to a different part\r\n         * @returns {Boolean}\r\n         */\r\n        function isLastOfPart() {\r\n            return nextPart && nextPart.id\r\n                && testPartId !== nextPart.id;\r\n        }\r\n\r\n        /**\r\n         * The helper object\r\n         */\r\n        return {\r\n            shouldWarnBeforeEnd: function () {\r\n                return warnBeforeEnd;\r\n            },\r\n            shouldWarnBeforeNext: function () {\r\n                return warnBeforeNext;\r\n            }\r\n        };\r\n    };\r\n\r\n    return nextWarningHelper;\r\n\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Navigation Plugin : Next\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/next',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/plugins/navigation/next/nextWarningHelper',\r\n    'taoQtiTest/runner/helpers/messages',\r\n    'taoQtiTest/runner/helpers/map',\r\n    'taoQtiTest/runner/helpers/stats',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'tpl!taoQtiTest/runner/plugins/templates/button'\r\n], function ($, _, __, hider, pluginFactory, nextWarningHelper, messages, mapHelper, statsHelper, shortcut, namespaceHelper, buttonTpl){\r\n    'use strict';\r\n\r\n    /**\r\n     * The display of the next button\r\n     */\r\n    var buttonData = {\r\n        next : {\r\n            control : 'move-forward',\r\n            title   : __('Submit and go to the next item'),\r\n            icon    : 'forward',\r\n            text    : __('Next')\r\n        },\r\n        end : {\r\n            control : 'move-end',\r\n            title   : __('Submit and go to the end of the test'),\r\n            icon    : 'fast-forward',\r\n            text    : __('End test')\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Create the button based on the current context\r\n     * @param {Object} context - the test context\r\n     * @returns {jQueryElement} the button\r\n     */\r\n    var createElement = function createElement(context){\r\n        var dataType = context.isLast ? 'end' : 'next';\r\n        return $(buttonTpl(buttonData[dataType]));\r\n    };\r\n\r\n    /**\r\n     * Update the button based on the context\r\n     * @param {jQueryElement} $element - the element to update\r\n     * @param {Object} context - the test context\r\n     */\r\n    var updateElement = function updateElement($element, context){\r\n        var dataType = context.isLast ? 'end' : 'next';\r\n        if($element.data('control') !== buttonData[dataType].control){\r\n\r\n            $element.data('control', buttonData[dataType].control)\r\n                    .attr('title', buttonData[dataType].title)\r\n                    .find('.text').text(buttonData[dataType].text);\r\n\r\n            if(dataType === 'next'){\r\n                $element.find('.icon-' + buttonData.end.icon)\r\n                        .removeClass('icon-' + buttonData.end.icon)\r\n                        .addClass('icon-' + buttonData.next.icon);\r\n            } else {\r\n                $element.find('.icon-' + buttonData.next.icon)\r\n                        .removeClass('icon-' + buttonData.next.icon)\r\n                        .addClass('icon-' + buttonData.end.icon);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n        name : 'next',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData();\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n\r\n            //plugin behavior\r\n            /**\r\n             * @param {Boolean} nextItemWarning - enable the display of a warning when going to the next item.\r\n             * Note: the actual display of the warning depends on other conditions (see nextWarningHelper)\r\n             */\r\n            function doNext(nextItemWarning) {\r\n                var context = testRunner.getTestContext(),\r\n                    testOptions = context.options || {};\r\n\r\n                var map = testRunner.getTestMap();\r\n                var nextItemPosition = context.itemPosition + 1;\r\n\r\n                // x-tao-option-unansweredWarning is a deprecated option whose behavior now matches the one of\r\n                // x-tao-option-nextPartWarning with the unansweredOnly option\r\n                var nextPartWarning = testOptions.nextPartWarning || testOptions.unansweredWarning;\r\n                var unansweredOnly =\r\n                    !testOptions.endTestWarning // this check to avoid an edge case where having both endTestWarning\r\n                                                // and unansweredWarning options would prevent endTestWarning to behave normally\r\n                    && testOptions.unansweredWarning;\r\n\r\n                var warningScope = (nextPartWarning) ? 'part' : 'test';\r\n\r\n                var warningHelper = nextWarningHelper({\r\n                    endTestWarning:     testOptions.endTestWarning,\r\n                    isLast:             context.isLast,\r\n                    isLinear:           context.isLinear,\r\n                    nextItemWarning:    nextItemWarning,\r\n                    nextPartWarning:    nextPartWarning,\r\n                    nextPart:           mapHelper.getItemPart(map, nextItemPosition),\r\n                    remainingAttempts:  context.remainingAttempts,\r\n                    testPartId:         context.testPartId,\r\n                    unansweredWarning:  testOptions.unansweredWarning,\r\n                    stats:              statsHelper.getInstantStats(warningScope, testRunner),\r\n                    unansweredOnly:     unansweredOnly\r\n                });\r\n\r\n                function enable() {\r\n                    testRunner.trigger('enablenav enabletools');\r\n                }\r\n\r\n                if(self.getState('enabled') !== false) {\r\n                    testRunner.trigger('disablenav disabletools');\r\n\r\n                    if (warningHelper.shouldWarnBeforeEnd()) {\r\n                        testRunner.trigger(\r\n                            'confirm.endTest',\r\n                            messages.getExitMessage(\r\n                                __('You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test.'),\r\n                                warningScope, testRunner),\r\n                            _.partial(triggerNextAction, context), // if the test taker accept\r\n                            enable  // if the test taker refuse\r\n                        );\r\n\r\n                    } else if (warningHelper.shouldWarnBeforeNext()) {\r\n                        testRunner.trigger(\r\n                            'confirm.next',\r\n                            __('You are about to go to the next item. Click OK to continue and go to the next item.'),\r\n                            _.partial(triggerNextAction, context), // if the test taker accept\r\n                            enable  // if the test taker refuse\r\n                        );\r\n\r\n                    } else {\r\n                        triggerNextAction(context);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function triggerNextAction(context) {\r\n                if(context.isLast){\r\n                    self.trigger('end');\r\n                }\r\n                testRunner.next();\r\n            }\r\n\r\n            //create the button (detached)\r\n            this.$element = createElement(testRunner.getTestContext());\r\n\r\n            //attach behavior\r\n            this.$element.on('click', function(e){\r\n                e.preventDefault();\r\n                testRunner.trigger('nav-next');\r\n            });\r\n\r\n            if(testConfig.allowShortcuts && pluginShortcuts.trigger){\r\n                shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.trigger, this.getName(), true), function(e) {\r\n                    if (self.getState('enabled') === true) {\r\n                        testRunner.trigger('nav-next', true);\r\n                    }\r\n                }, {\r\n                    avoidInput: true,\r\n                    prevent: true\r\n                });\r\n            }\r\n\r\n            //disabled by default\r\n            this.disable();\r\n\r\n            //change plugin state\r\n            testRunner\r\n                .on('loaditem', function(){\r\n                    updateElement(self.$element, testRunner.getTestContext());\r\n                })\r\n                .on('enablenav', function(){\r\n                    self.enable();\r\n                })\r\n                .on('disablenav', function(){\r\n                    self.disable();\r\n                })\r\n                .on('nav-next', function(nextItemWarning) {\r\n                    doNext(nextItemWarning);\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n\r\n            //attach the element to the navigation area\r\n            var $container = this.getAreaBroker().getNavigationArea();\r\n            $container.append(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            shortcut.remove('.' + this.getName());\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable (){\r\n            this.$element.removeProp('disabled')\r\n                         .removeClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable (){\r\n            this.$element.prop('disabled', true)\r\n                         .addClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show(){\r\n            hider.show(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide(){\r\n            hider.hide(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Navigation Plugin : Next Section\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/nextSection',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/helpers/messages',\r\n    'tpl!taoQtiTest/runner/plugins/templates/button'\r\n], function ($, _, __, hider, pluginFactory, messages, buttonTpl){\r\n    'use strict';\r\n\r\n    return pluginFactory({\r\n        name : 'nextsection',\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var testConfig = testRunner.getTestData().config;\r\n\r\n            function toggle(){\r\n                var options = testRunner.getTestContext().options;\r\n                if(testConfig.nextSection && (options.nextSection || options.nextSectionWarning)){\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            function nextSection() {\r\n                testRunner.next('section');\r\n            }\r\n\r\n            this.$element = $(buttonTpl({\r\n                control : 'next-section',\r\n                title   : __('Skip to the next section'),\r\n                icon    : 'fast-forward',\r\n                text    : __('Next Section')\r\n            }));\r\n\r\n            this.$element.on('click', function(e){\r\n                var context = testRunner.getTestContext();\r\n                var enable = _.bind(self.enable, self);\r\n                e.preventDefault();\r\n                if(self.getState('enabled') !== false){\r\n                    self.disable();\r\n\r\n                    if(context.options.nextSectionWarning){\r\n                        testRunner.trigger(\r\n                            'confirm.nextsection',\r\n                            messages.getExitMessage(\r\n                                __('After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?'),\r\n                                'section', testRunner),\r\n                            nextSection, // if the test taker accept\r\n                            enable       // if the test taker refuse\r\n                        );\r\n                    } else {\r\n                        nextSection();\r\n                    }\r\n                }\r\n            });\r\n\r\n            this.disable();\r\n            toggle();\r\n\r\n            testRunner\r\n                .on('loaditem', toggle)\r\n                .on('enablenav', function(){\r\n                    self.enable();\r\n                })\r\n                .on('disablenav', function(){\r\n                    self.disable();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n\r\n            //attach the element to the navigation area\r\n            var $container = this.getAreaBroker().getNavigationArea();\r\n            $container.append(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable (){\r\n            this.$element.removeProp('disabled')\r\n                         .removeClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable (){\r\n            this.$element.prop('disabled', true)\r\n                         .addClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show(){\r\n            hider.show(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide(){\r\n            hider.hide(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Navigation Plugin : Previous\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/previous',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'tpl!taoQtiTest/runner/plugins/templates/button'\r\n], function ($, _, __, hider, pluginFactory, shortcut, namespaceHelper, buttonTpl){\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name : 'previous',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData();\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n\r\n            /**\r\n             * Check if the \"Previous\" functionality should be available or not\r\n             */\r\n            var canDoPrevious = function canDoPrevious() {\r\n                var context = testRunner.getTestContext();\r\n                return context.isLinear === false && context.canMoveBackward === true;\r\n            };\r\n\r\n            /**\r\n             * Hide the plugin if the Previous functionality shouldn't be available\r\n             */\r\n            var toggle = function toggle(){\r\n                if(canDoPrevious()){\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            };\r\n\r\n            //build element (detached)\r\n            this.$element =  $(buttonTpl({\r\n                control : 'move-backward',\r\n                title   : __('Submit and go to the previous item'),\r\n                icon    : 'backward',\r\n                text    : __('Previous')\r\n            }));\r\n\r\n            //attach behavior\r\n            function doPrevious(previousItemWarning) {\r\n                var context = testRunner.getTestContext();\r\n\r\n                function enable() {\r\n                    testRunner.trigger('enablenav enabletools');\r\n                }\r\n\r\n                if(self.getState('enabled') !== false){\r\n                    testRunner.trigger('disablenav disabletools');\r\n\r\n                    if (previousItemWarning && context.remainingAttempts !== -1) {\r\n                        testRunner.trigger(\r\n                            'confirm.previous',\r\n                            __('You are about to go to the previous item. Click OK to continue and go to the previous item.'),\r\n                            testRunner.previous, // if the test taker accept\r\n                            enable  // if the test taker refuse\r\n                        );\r\n\r\n                    } else {\r\n                        testRunner.previous();\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.$element.on('click', function(e){\r\n                e.preventDefault();\r\n                testRunner.trigger('nav-previous');\r\n            });\r\n\r\n            if(testConfig.allowShortcuts && pluginShortcuts.trigger){\r\n                shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.trigger, this.getName(), true), function(e) {\r\n                    if (canDoPrevious() && self.getState('enabled') === true) {\r\n                        testRunner.trigger('nav-previous', [true]);\r\n                    }\r\n                }, {\r\n                    avoidInput: true,\r\n                    prevent: true\r\n                });\r\n            }\r\n\r\n            //start disabled\r\n            toggle();\r\n            self.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', toggle)\r\n                .on('enablenav', function(){\r\n                    self.enable();\r\n                })\r\n                .on('disablenav', function(){\r\n                    self.disable();\r\n                })\r\n                .on('nav-previous', function(previousItemWarning){\r\n                    doPrevious(previousItemWarning);\r\n                });\r\n        },\r\n\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            var $container = this.getAreaBroker().getNavigationArea();\r\n            $container.append(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            shortcut.remove('.' + this.getName());\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable (){\r\n            this.$element.removeProp('disabled')\r\n                         .removeClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable (){\r\n            this.$element.prop('disabled', true)\r\n                         .addClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show(){\r\n            hider.show(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide(){\r\n            hider.hide(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/navigation/review/navigator', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  \n  return \" hidden\";\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\r\\n    <div class=\\\"qti-navigator-info collapsible\\\">\\r\\n                <span class=\\\"qti-navigator-label\\\">\\r\\n                    <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Test status\", options) : helperMissing.call(depth0, \"__\", \"Test status\", options)))\n    + \"</span>\\r\\n                    <span class=\\\"icon-up\\\"></span>\\r\\n                    <span class=\\\"icon-down\\\"></span>\\r\\n                </span>\\r\\n        <ul class=\\\"collapsible-panel plain\\\">\\r\\n            <li class=\\\"qti-navigator-viewed\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Viewed items\", options) : helperMissing.call(depth0, \"__\", \"Viewed items\", options)))\n    + \"\\\">\\r\\n                        <span class=\\\"qti-navigator-label\\\">\\r\\n                            <span class=\\\"qti-navigator-icon icon-viewed\\\"></span>\\r\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Viewed\", options) : helperMissing.call(depth0, \"__\", \"Viewed\", options)))\n    + \"</span>\\r\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\r\\n                        </span>\\r\\n            </li>\\r\\n            <li class=\\\"qti-navigator-answered\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Completed items\", options) : helperMissing.call(depth0, \"__\", \"Completed items\", options)))\n    + \"\\\">\\r\\n                        <span class=\\\"qti-navigator-label\\\">\\r\\n                            <span class=\\\"qti-navigator-icon icon-answered\\\"></span>\\r\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Answered\", options) : helperMissing.call(depth0, \"__\", \"Answered\", options)))\n    + \"</span>\\r\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\r\\n                        </span>\\r\\n            </li>\\r\\n            <li class=\\\"qti-navigator-unanswered\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Unanswered items\", options) : helperMissing.call(depth0, \"__\", \"Unanswered items\", options)))\n    + \"\\\">\\r\\n                        <span class=\\\"qti-navigator-label\\\">\\r\\n                            <span class=\\\"qti-navigator-icon icon-unanswered\\\"></span>\\r\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Unanswered\", options) : helperMissing.call(depth0, \"__\", \"Unanswered\", options)))\n    + \"</span>\\r\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\r\\n                        </span>\\r\\n            </li>\\r\\n            <li class=\\\"qti-navigator-flagged\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Items marked for later review\", options) : helperMissing.call(depth0, \"__\", \"Items marked for later review\", options)))\n    + \"\\\">\\r\\n                        <span class=\\\"qti-navigator-label\\\">\\r\\n                            <span class=\\\"qti-navigator-icon icon-flagged\\\"></span>\\r\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Flagged\", options) : helperMissing.call(depth0, \"__\", \"Flagged\", options)))\n    + \"</span>\\r\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\r\\n                        </span>\\r\\n            </li>\\r\\n        </ul>\\r\\n    </div>\\r\\n    \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  \n  return \"(<span class=\\\"qti-navigator-counter\\\">0</span>)\";\n  }\n\nfunction program7(depth0,data) {\n  \n  \n  return \"icon-unanswered \";\n  }\n\nfunction program9(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Unanswered\", options) : helperMissing.call(depth0, \"__\", \"Unanswered\", options)))\n    + \" (<span class=\\\"qti-navigator-counter\\\">0</span>)\";\n  return buffer;\n  }\n\nfunction program11(depth0,data) {\n  \n  \n  return \"icon-flagged \";\n  }\n\nfunction program13(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Flagged\", options) : helperMissing.call(depth0, \"__\", \"Flagged\", options)))\n    + \" (<span class=\\\"qti-navigator-counter\\\">0</span>)\";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"qti-panel qti-navigator\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.hidden), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\">\\r\\n    <div class=\\\"qti-navigator-collapsible\\\">\\r\\n        <span class=\\\"qti-navigator-collapse icon icon-left\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Collapse the review panel\", options) : helperMissing.call(depth0, \"__\", \"Collapse the review panel\", options)))\n    + \"\\\"></span>\\r\\n        <span class=\\\"qti-navigator-expand icon icon-right\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Expand the review panel\", options) : helperMissing.call(depth0, \"__\", \"Expand the review panel\", options)))\n    + \"\\\"></span>\\r\\n    </div>\\r\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showLegend), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n\\r\\n\\r\\n    <div class=\\\"qti-navigator-filters\\\">\\r\\n        <ul class=\\\"plain clearfix\\\">\\r\\n            <li class=\\\"qti-navigator-filter active\\\" data-mode=\\\"all\\\">\\r\\n                <span title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Reset filters\", options) : helperMissing.call(depth0, \"__\", \"Reset filters\", options)))\n    + \"\\\" class=\\\"qti-navigator-tab\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"All\", options) : helperMissing.call(depth0, \"__\", \"All\", options)))\n    + \"\\r\\n                    \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.showLegend), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                </span>\\r\\n            </li>\\r\\n\\r\\n            <li class=\\\"qti-navigator-filter\\\" data-mode=\\\"unanswered\\\">\\r\\n                <span class=\\\"\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showLegend), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"qti-navigator-tab\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Only display the unanswered items\", options) : helperMissing.call(depth0, \"__\", \"Only display the unanswered items\", options)))\n    + \"\\\">\\r\\n                    \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.showLegend), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                </span>\\r\\n            </li>\\r\\n\\r\\n            <li class=\\\"qti-navigator-filter\\\" data-mode=\\\"flagged\\\">\\r\\n                <span class=\\\"\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showLegend), {hash:{},inverse:self.noop,fn:self.program(11, program11, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"qti-navigator-tab\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Only display the items marked for review\", options) : helperMissing.call(depth0, \"__\", \"Only display the items marked for review\", options)))\n    + \"\\\">\\r\\n                    \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.showLegend), {hash:{},inverse:self.noop,fn:self.program(13, program13, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                </span>\\r\\n            </li>\\r\\n        </ul>\\r\\n    </div>\\r\\n\\r\\n    <nav class=\\\"qti-navigator-tree\\\"></nav>\\r\\n\\r\\n    <div id=\\\"qti-navigator-linear\\\" class=\\\"qti-navigator-linear\\\">\\r\\n        <span class=\\\"icon icon-info\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\\"></span>\\r\\n        <p class=\\\"qti-navigator-message\\\">\\r\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\r\\n        </p>\\r\\n    </div>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/navigation/review/navigatorTree', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n    <li class=\\\"qti-navigator-part collapsible \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.active), {hash:{},inverse:self.program(4, program4, data),fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" data-id=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n        <span class=\\\"qti-navigator-label\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n            <span class=\\\"qti-navigator-text\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\r\\n            <span class=\\\"icon-up\\\"></span>\\r\\n            <span class=\\\"icon-down\\\"></span>\\r\\n        </span>\\r\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.isLinear), {hash:{},inverse:self.program(8, program8, data),fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n    </li>\\r\\n    \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  \n  return \"active\";\n  }\n\nfunction program4(depth0,data) {\n  \n  \n  return \"collapsed\";\n  }\n\nfunction program6(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\r\\n        <div class=\\\"qti-navigator-linear-part collapsible-panel\\\">\\r\\n            <span class=\\\"icon icon-info\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\\"></span>\\r\\n            <p class=\\\"qti-navigator-message\\\">\\r\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\r\\n            </p>\\r\\n            <p class=\\\"qti-navigator-actions\\\">\\r\\n                <button class=\\\"btn-info small\\\" data-position=\\\"\";\n  if (helper = helpers.position) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.position); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Start Test-part\", options) : helperMissing.call(depth0, \"__\", \"Start Test-part\", options)))\n    + \"\\\">\\r\\n                    <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Start Test-part\", options) : helperMissing.call(depth0, \"__\", \"Start Test-part\", options)))\n    + \"</span>\\r\\n                    <span class=\\\"icon-play r\\\"></span>\\r\\n                </button>\\r\\n            </p>\\r\\n        </div>\\r\\n        \";\n  return buffer;\n  }\n\nfunction program8(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\r\\n        <ul class=\\\"qti-navigator-sections collapsible-panel plain\\\">\\r\\n            \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.sections), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n        </ul>\\r\\n        \";\n  return buffer;\n  }\nfunction program9(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n            <li class=\\\"qti-navigator-section collapsible \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.active), {hash:{},inverse:self.program(4, program4, data),fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" data-id=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n                <span class=\\\"qti-navigator-label\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n                    <span class=\\\"qti-navigator-text\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\r\\n                    <span class=\\\"qti-navigator-counter\\\">\"\n    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.stats)),stack1 == null || stack1 === false ? stack1 : stack1.answered)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"/\"\n    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.stats)),stack1 == null || stack1 === false ? stack1 : stack1.total)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"</span>\\r\\n                </span>\\r\\n                <ul class=\\\"qti-navigator-items collapsible-panel plain\\\">\\r\\n                    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.items), {hash:{},inverse:self.noop,fn:self.program(10, program10, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n                </ul>\\r\\n            </li>\\r\\n            \";\n  return buffer;\n  }\nfunction program10(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\r\\n                    <li class=\\\"qti-navigator-item \";\n  if (helper = helpers.cls) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.cls); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-id=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-position=\\\"\";\n  if (helper = helpers.position) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.position); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n                        <span class=\\\"qti-navigator-label truncate\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\r\\n                            <span class=\\\"qti-navigator-icon icon-\";\n  if (helper = helpers.icon) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.icon); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></span>\\r\\n                            <span class=\\\"qti-navigator-number\\\">\";\n  if (helper = helpers.index) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.index); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\r\\n                            \";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\r\\n                        </span>\\r\\n                    </li>\\r\\n                    \";\n  return buffer;\n  }\n\n  buffer += \"<ul class=\\\"qti-navigator-parts plain\\\">\\r\\n    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.parts), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n</ul>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/review/navigator',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/component',\r\n    'ui/autoscroll',\r\n    'taoQtiTest/runner/helpers/map',\r\n    'tpl!taoQtiTest/runner/plugins/navigation/review/navigator',\r\n    'tpl!taoQtiTest/runner/plugins/navigation/review/navigatorTree'\r\n], function ($, _, __, component, autoscroll, mapHelper, navigatorTpl, navigatorTreeTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Some default values\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    var _defaults = {\r\n        scope: 'test',\r\n        canCollapse: false,\r\n        preventsUnseen: true,\r\n        hidden: false\r\n    };\r\n\r\n    /**\r\n     * List of CSS classes\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    var _cssCls = {\r\n        active: 'active',\r\n        collapsed: 'collapsed',\r\n        collapsible: 'collapsible',\r\n        hidden: 'hidden',\r\n        disabled: 'disabled',\r\n        flagged: 'flagged',\r\n        answered: 'answered',\r\n        viewed: 'viewed',\r\n        unseen: 'unseen',\r\n        info: 'info',\r\n        icon: 'qti-navigator-icon',\r\n        scope: {\r\n            test: 'scope-test',\r\n            testPart: 'scope-test-part',\r\n            testSection: 'scope-test-section'\r\n        }\r\n    };\r\n\r\n    /**\r\n     * List of icon CSS classes\r\n     * @type {Array}\r\n     * @private\r\n     */\r\n    var _iconCls = [\r\n        _cssCls.info,\r\n        _cssCls.flagged,\r\n        _cssCls.answered,\r\n        _cssCls.viewed\r\n    ];\r\n\r\n    /**\r\n     * List of common CSS selectors\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    var _selectors = {\r\n        component: '.qti-navigator',\r\n        filterBar: '.qti-navigator-filters',\r\n        filter: '.qti-navigator-filter',\r\n        tree: '.qti-navigator-tree',\r\n        collapseHandle: '.qti-navigator-collapsible',\r\n        linearState: '.qti-navigator-linear',\r\n        infoAnswered: '.qti-navigator-answered .qti-navigator-counter',\r\n        infoViewed: '.qti-navigator-viewed .qti-navigator-counter',\r\n        infoUnanswered: '.qti-navigator-unanswered .qti-navigator-counter',\r\n        infoFlagged: '.qti-navigator-flagged .qti-navigator-counter',\r\n        infoPanel: '.qti-navigator-info',\r\n        infoPanelLabels: '.qti-navigator-info > .qti-navigator-label',\r\n        tabInfoAll: '[data-mode=\"all\"] .qti-navigator-counter',\r\n        tabInfoUnanswered: '[data-mode=\"unanswered\"] .qti-navigator-counter',\r\n        tabInfoFlagged: '[data-mode=\"flagged\"] .qti-navigator-counter',\r\n        parts: '.qti-navigator-part',\r\n        partLabels: '.qti-navigator-part > .qti-navigator-label',\r\n        sections: '.qti-navigator-section',\r\n        sectionLabels: '.qti-navigator-section > .qti-navigator-label',\r\n        items: '.qti-navigator-item',\r\n        itemLabels: '.qti-navigator-item > .qti-navigator-label',\r\n        itemIcons: '.qti-navigator-item > .qti-navigator-icon',\r\n        activeItem: '.qti-navigator-item.active',\r\n        icons: '.qti-navigator-icon',\r\n        linearStart: '.qti-navigator-linear-part button',\r\n        counters: '.qti-navigator-counter',\r\n        actives: '.active',\r\n        collapsible: '.collapsible',\r\n        collapsiblePanels: '.collapsible-panel',\r\n        unseen: '.unseen',\r\n        answered: '.answered',\r\n        flagged: '.flagged',\r\n        notFlagged: ':not(.flagged)',\r\n        notAnswered: ':not(.answered)',\r\n        notInformational: ':not(.info)',\r\n        informational: '.info',\r\n        hidden: '.hidden',\r\n        disabled : '.disabled'\r\n    };\r\n\r\n    /**\r\n     * Maps the filter mode to filter criteria.\r\n     * Each filter criteria is a CSS selector used to find and mask the items to be discarded by the filter.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    var _filterMap = {\r\n        all: \"\",\r\n        unanswered: [_selectors.answered, _selectors.informational].join(','),\r\n        flagged: _selectors.notFlagged,\r\n        answered: _selectors.notAnswered,\r\n        filtered: _selectors.hidden\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @type {Object}\r\n     */\r\n    var navigatorApi = {\r\n        /**\r\n         * Updates the stats on the flagged items in the current map\r\n         * @param {Number} position\r\n         * @param {Boolean} flag\r\n         */\r\n        updateStats: function updateStats(position, flag) {\r\n            var map = this.map;\r\n            var item;\r\n\r\n            if (map) {\r\n                item = mapHelper.getItemAt(map, position);\r\n\r\n                if (item) {\r\n                    item.flagged = flag;\r\n                    mapHelper.updateItemStats(map, position);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Gets the total number of items for the provided target\r\n         * @param {Object} progression\r\n         * @param {String} target\r\n         * @returns {Number}\r\n         */\r\n        getProgressionTotal: function getProgressionTotal(progression, target) {\r\n            var total;\r\n\r\n            if ('questions' === target) {\r\n                total = progression.questions;\r\n            } else {\r\n                total = progression.total;\r\n            }\r\n\r\n            return total;\r\n        },\r\n\r\n        /**\r\n         * Set the marked state of an item\r\n         * @param {Number|String|jQuery} position\r\n         * @param {Boolean} flag\r\n         */\r\n        setItemFlag: function setItemFlag(position, flag) {\r\n            var $item = position && position.jquery ? position : this.controls.$tree.find('[data-position=' + position + ']');\r\n            var progression = this.progression;\r\n            var icon;\r\n\r\n            // update the map stats\r\n            this.updateStats(position, flag);\r\n\r\n            // update the item flag\r\n            $item.toggleClass(_cssCls.flagged, flag);\r\n\r\n            // set the item icon according to its state\r\n            icon = _.find(_iconCls, _.bind($item.hasClass, $item)) || _cssCls.unseen;\r\n            $item.find(_selectors.icons).attr('class', _cssCls.icon + ' icon-' + icon);\r\n\r\n            // update the info panel\r\n            progression.flagged = this.controls.$tree.find(_selectors.flagged).length;\r\n            this.writeCount(this.controls.$infoFlagged, progression.flagged, this.getProgressionTotal(progression, 'questions'));\r\n\r\n            // recompute the filters\r\n            this.filter(this.currentFilter);\r\n        },\r\n\r\n        /**\r\n         * Filters the items by a criteria\r\n         * @param {String} criteria\r\n         */\r\n        filter: function filter(criteria) {\r\n            var self = this;\r\n\r\n            // remove the current filter by restoring all items\r\n            var $items = this.controls.$tree.find(_selectors.items).removeClass(_cssCls.hidden);\r\n\r\n            // filter the items according to the provided criteria\r\n            var filterCb = _filterMap[criteria];\r\n            if (filterCb) {\r\n                $items.filter(filterCb).addClass(_cssCls.hidden);\r\n            }\r\n\r\n            // update the section counters\r\n            this.controls.$tree.find(_selectors.sections).each(function () {\r\n                var $section     = $(this);\r\n                var $itemsFound  = $section.find(_selectors.items).not(_selectors.hidden);\r\n                var $filtered    = $itemsFound.not(_selectors.disabled);\r\n                self.writeCount($section.find(_selectors.counters), $filtered.length, $itemsFound.length);\r\n            });\r\n            this.currentFilter = criteria;\r\n        },\r\n\r\n        /**\r\n         * Update the config\r\n         * @param {Object} [config]\r\n         * @returns {navigatorApi}\r\n         */\r\n        updateConfig: function updateConfig(config) {\r\n            var $component = this.getElement();\r\n            var scopeClass = _cssCls.scope[this.config.scope || _defaults.scope];\r\n\r\n            // apply the new config\r\n            config = _.merge(this.config, config || {});\r\n\r\n            // enable/disable the collapsing of the panel\r\n            $component.toggleClass(_cssCls.collapsible, config.canCollapse);\r\n\r\n            // update the component CSS class according to the scope\r\n            $component.removeClass(scopeClass);\r\n            scopeClass = _cssCls.scope[this.config.scope || _defaults.scope];\r\n            $component.addClass(scopeClass);\r\n\r\n            return this;\r\n        },\r\n\r\n        /**\r\n         * Keep the active item visible, auto scroll if needed\r\n         */\r\n        autoScroll: function autoScroll() {\r\n            autoscroll(this.controls.$tree.find(_selectors.activeItem), this.controls.$tree);\r\n        },\r\n\r\n        /**\r\n         * Updates the review screen\r\n         * @param {Object} map The current test map\r\n         * @param {Object} context The current test context\r\n         * @returns {navigatorApi}\r\n         * @fires navigator#update\r\n         */\r\n        update: function update(map, context) {\r\n            var scopedMap = this.getScopedMap(map, context);\r\n            var progression = scopedMap.stats || {\r\n                questions: 0,\r\n                answered: 0,\r\n                flagged: 0,\r\n                viewed: 0,\r\n                total: 0\r\n            };\r\n            var totalQuestions = this.getProgressionTotal(progression, 'questions');\r\n\r\n            this.map = map;\r\n            this.progression = progression;\r\n\r\n            // update the info panel\r\n            this.writeCount(this.controls.$infoAnswered, progression.answered, totalQuestions);\r\n            this.writeCount(this.controls.$infoUnanswered, totalQuestions - progression.answered, totalQuestions);\r\n            this.writeCount(this.controls.$infoViewed, progression.viewed, this.getProgressionTotal(progression, 'total'));\r\n            this.writeCount(this.controls.$infoFlagged, progression.flagged, totalQuestions);\r\n            this.writeCount(this.controls.$infoAll, totalQuestions, null);\r\n\r\n\r\n            // rebuild the tree\r\n            if (!context.isLinear) {\r\n                this.controls.$filterBar.show();\r\n                this.controls.$linearState.hide();\r\n                this.controls.$tree.html(navigatorTreeTpl(scopedMap));\r\n\r\n                this.autoScroll();\r\n\r\n                this.setState('prevents-unseen', this.config.preventsUnseen);\r\n                if (this.config.preventsUnseen) {\r\n                    // disables all unseen items to prevent the test taker has access to.\r\n                    this.controls.$tree.find(_selectors.unseen).addClass(_cssCls.disabled);\r\n                }\r\n            } else {\r\n                this.controls.$filterBar.hide();\r\n                this.controls.$linearState.show();\r\n                this.controls.$tree.empty();\r\n            }\r\n\r\n            // apply again the current filter\r\n            this.filter(this.controls.$filters.filter(_selectors.actives).data('mode'));\r\n\r\n            /**\r\n             * @event navigator#update the navigation data have changed\r\n             */\r\n            this.trigger('update');\r\n\r\n            return this;\r\n        },\r\n\r\n        /**\r\n         * Gets the scoped map\r\n         * @param {Object} map The current test map\r\n         * @param {Object} context The current test context\r\n         * @returns {object} The scoped map\r\n         */\r\n        getScopedMap: function getScopedMap(map, context) {\r\n            var scopedMap = mapHelper.getScopeMap(map, context.itemPosition, this.config.scope);\r\n            var testPart = mapHelper.getPart(scopedMap, context.testPartId) || {};\r\n            var section = mapHelper.getSection(scopedMap, context.sectionId) || {};\r\n            var item = mapHelper.getItem(scopedMap, context.itemIdentifier) || {};\r\n\r\n            // set the active part/section/item\r\n            testPart.active = true;\r\n            section.active = true;\r\n            item.active = true;\r\n\r\n            // adjust each item with additional meta\r\n            return mapHelper.each(scopedMap, function(itm) {\r\n                var cls = [];\r\n                var icon = '';\r\n\r\n                if (itm.active) {\r\n                    cls.push('active');\r\n                }\r\n                if (itm.informational) {\r\n                    cls.push('info');\r\n                    icon = icon || 'info';\r\n                }\r\n                if (itm.flagged) {\r\n                    cls.push('flagged');\r\n                    icon = icon || 'flagged';\r\n                }\r\n                if (itm.answered) {\r\n                    cls.push('answered');\r\n                    icon = icon || 'answered';\r\n                }\r\n                if (itm.viewed) {\r\n                    cls.push('viewed');\r\n                    icon = icon || 'viewed';\r\n                } else {\r\n                    cls.push('unseen');\r\n                    icon = icon || 'unseen';\r\n                }\r\n\r\n                itm.cls = cls.join(' ');\r\n                itm.icon = icon;\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Updates a counter\r\n         * @param {jQuery} $place\r\n         * @param {Number} count\r\n         * @param {Number|Null} total\r\n         * @private\r\n         */\r\n        writeCount: function writeCount($place, count, total) {\r\n\r\n            var display = 0;\r\n            if($place.parent().hasClass('qti-navigator-tab')){\r\n                display = Math.max(count, 0);\r\n            }\r\n            else if(total > 0){\r\n                display = Math.min(count, total) + '/' + total;\r\n            }\r\n            $place.text(display);\r\n        },\r\n\r\n        /**\r\n         * Selects an item\r\n         * @param {String|jQuery} position The item's position\r\n         * @param {Boolean} [open] Forces the tree to be opened on the selected item\r\n         * @returns {jQuery} Returns the selected item\r\n         */\r\n        select: function select(position, open) {\r\n            // find the item to select and extract its hierarchy\r\n            var $tree = this.controls.$tree;\r\n            var selected = position && position.jquery ? position : $tree.find('[data-position=' + position + ']');\r\n            var hierarchy = selected.parentsUntil($tree);\r\n            var previousPosition = 0;\r\n            var $previous = $tree.find(_selectors.activeItem);\r\n            if ( $previous.length ) {\r\n                previousPosition = $previous.data('position');\r\n            }\r\n\r\n            // collapse the full tree and open only the hierarchy of the selected item\r\n            if (open) {\r\n                this.openOnly(hierarchy);\r\n            }\r\n\r\n            // select the item\r\n            $tree.find(_selectors.actives).removeClass(_cssCls.active);\r\n            hierarchy.add(selected).addClass(_cssCls.active);\r\n\r\n            position = selected.data('position');\r\n\r\n            /**\r\n             * An item is selected\r\n             *\r\n             * @param {Number} position - The item position on which select\r\n             * @param {Number} previousPosition - The item position from which select\r\n             * @event navigator#selected\r\n             */\r\n            this.trigger('selected', position, previousPosition);\r\n\r\n            return selected;\r\n        },\r\n\r\n        /**\r\n         * Opens the tree on the selected item only\r\n         * @returns {jQuery} Returns the selected item\r\n         */\r\n        openSelected: function openSelected() {\r\n            // find the selected item and extract its hierarchy\r\n            var $tree = this.controls.$tree;\r\n            var selected = $tree.find(_selectors.items + _selectors.actives);\r\n            var hierarchy = selected.parentsUntil($tree);\r\n\r\n            // collapse the full tree and open only the hierarchy of the selected item\r\n            this.openOnly(hierarchy);\r\n\r\n            return selected;\r\n        },\r\n\r\n        /**\r\n         * Collapses the full tree and opens only the provided branch\r\n         * @param {jQuery} opened The element to be opened\r\n         * @param {jQuery} [root] The root element from which collapse the panels\r\n         */\r\n        openOnly: function openOnly(opened, root) {\r\n            (root || this.controls.$tree).find(_selectors.collapsible).addClass(_cssCls.collapsed);\r\n            opened.removeClass(_cssCls.collapsed);\r\n        },\r\n\r\n        /**\r\n         * Toggles a panel\r\n         * @param {jQuery} panel The panel to toggle\r\n         * @param {String} [collapseSelector] Selector of panels to collapse\r\n         * @returns {Boolean} Returns `true` if the panel just expanded now\r\n         */\r\n        togglePanel: function togglePanel(panel, collapseSelector) {\r\n            var collapsed = panel.hasClass(_cssCls.collapsed);\r\n\r\n            if (collapseSelector) {\r\n                this.controls.$tree.find(collapseSelector).addClass(_cssCls.collapsed);\r\n            }\r\n\r\n            if (collapsed) {\r\n                panel.removeClass(_cssCls.collapsed);\r\n            } else {\r\n                panel.addClass(_cssCls.collapsed);\r\n            }\r\n            return collapsed;\r\n        },\r\n\r\n        /**\r\n         * Toggles the display state of the component\r\n         * @param {Boolean} [show] External condition that's tells if the component must be shown or hidden\r\n         * @returns {navigatorApi}\r\n         */\r\n        toggle: function toggle(show) {\r\n            if (typeof show === 'undefined') {\r\n                show = this.is('hidden');\r\n            }\r\n\r\n            if (show) {\r\n                this.show();\r\n            } else {\r\n                this.hide();\r\n            }\r\n\r\n            return this;\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param {Object} config\r\n     * @param {String} [config.scope] Limit the review screen to a particular scope: test, testPart, testSection\r\n     * @param {Boolean} [config.preventsUnseen] Prevents the test taker to access unseen items\r\n     * @param {Boolean} [config.canCollapse] Allow the test taker to collapse the component\r\n     * @param {Boolean} [config.canFlag] Allow the test taker to flag items\r\n     * @param {Boolean} [config.hidden] Hide the component at init\r\n     * @param {Object} map The current test map\r\n     * @param {Object} context The current test context\r\n     * @returns {*}\r\n     */\r\n    function navigatorFactory(config, map, context) {\r\n\r\n        var navigator;\r\n\r\n        /**\r\n         * Flags an item\r\n         * @param {jQuery} $item\r\n         */\r\n        function flagItem($item) {\r\n            var position = $item.data('position');\r\n            var flagged = !$item.hasClass(_cssCls.flagged);\r\n\r\n            // update the display\r\n            navigator.setItemFlag(position, flagged);\r\n\r\n            /**\r\n             * An item is flagged\r\n             * @event navigator#flag\r\n             * @param {Number} position - The item position on which jump\r\n             * @param {Boolean} flag - Tells whether the item is marked for review or not\r\n             */\r\n            navigator.trigger('flag', position, flagged);\r\n        }\r\n\r\n        /**\r\n         * Jumps to an item\r\n         * @param {jQuery} $item\r\n         * @private\r\n         */\r\n        function jump($item) {\r\n            var position = $item.data('position');\r\n\r\n            /**\r\n             * A jump to a particular item is required\r\n             * @event navigator#jump\r\n             * @param {Number} position - The item position on which jump\r\n             */\r\n            navigator.trigger('jump', position);\r\n        }\r\n\r\n        navigator = component(navigatorApi, _defaults)\r\n            .setTemplate(navigatorTpl)\r\n\r\n\r\n            // uninstalls the component\r\n            .on('destroy', function () {\r\n                this.controls = null;\r\n            })\r\n\r\n            // keep the activ item visible\r\n            .on('show', function () {\r\n                this.autoScroll();\r\n            })\r\n\r\n            // renders the component\r\n            .on('render', function () {\r\n                var self = this;\r\n\r\n                // main component elements\r\n                var $component = this.getElement();\r\n                var $filterBar = $component.find(_selectors.filterBar);\r\n                var $filters = $filterBar.find('li');\r\n                var $tree = $component.find(_selectors.tree);\r\n\r\n                // links the component to the underlying DOM elements\r\n                this.controls = {\r\n                    // access to info panel displaying counters\r\n\r\n                    $infoAnswered: $component.find(_selectors.infoAnswered),\r\n                    $infoViewed: $component.find(_selectors.infoViewed),\r\n                    $infoAll: $component.find(_selectors.tabInfoAll),\r\n                    $infoUnanswered: this.config.showLegend ?\r\n                        $component.find(_selectors.infoUnanswered) :\r\n                        $component.find(_selectors.tabInfoUnanswered),\r\n                    $infoFlagged: this.config.showLegend ?\r\n                        $component.find(_selectors.infoFlagged) :\r\n                        $component.find(_selectors.tabInfoFlagged),\r\n\r\n                    // access to filter switches\r\n                    $filterBar: $filterBar,\r\n                    $filters: $filters,\r\n\r\n                    // access to the tree of parts/sections/items\r\n                    $tree: $tree,\r\n\r\n                    // access to the panel displayed when a linear part is reached\r\n                    $linearState: $component.find(_selectors.linearState)\r\n                };\r\n\r\n                // apply options\r\n                this.updateConfig();\r\n\r\n                // click on the collapse handle: collapse/expand the review panel\r\n                $component.on('click' + _selectors.component, _selectors.collapseHandle, function () {\r\n                    if (!self.is('disabled')) {\r\n                        $component.toggleClass(_cssCls.collapsed);\r\n                        if ($component.hasClass(_cssCls.collapsed)) {\r\n                            self.openSelected();\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // click on the info panel title: toggle the related panel\r\n                $component.on('click' + _selectors.component, _selectors.infoPanelLabels, function () {\r\n                    if (!self.is('disabled')) {\r\n                        self.togglePanel($(this).closest(_selectors.infoPanel), _selectors.infoPanel);\r\n                    }\r\n                });\r\n\r\n                // click on a part title: toggle the related panel\r\n                $tree.on('click' + _selectors.component, _selectors.partLabels, function () {\r\n                    var $panel;\r\n\r\n                    if (!self.is('disabled')) {\r\n                        $panel = $(this).closest(_selectors.parts);\r\n\r\n                        if (self.togglePanel($panel, _selectors.parts)) {\r\n                            if ($panel.hasClass(_cssCls.active)) {\r\n                                self.openSelected();\r\n                            } else {\r\n                                self.openOnly($panel.find(_selectors.sections).first(), $panel);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                });\r\n\r\n                // click on a section title: toggle the related panel\r\n                $tree.on('click' + _selectors.component, _selectors.sectionLabels, function () {\r\n                    if (!self.is('disabled')) {\r\n                        self.togglePanel($(this).closest(_selectors.sections), _selectors.sections);\r\n                    }\r\n                });\r\n\r\n                // click on an item: jump to the position\r\n                $tree.on('click' + _selectors.component, _selectors.itemLabels, function (event) {\r\n                    var $item, $target;\r\n\r\n                    if (!self.is('disabled')) {\r\n                        $item = $(this).closest(_selectors.items);\r\n\r\n                        if (!$item.hasClass(_cssCls.disabled)) {\r\n                            $target = $(event.target);\r\n                            if (self.config.canFlag && $target.is(_selectors.icons) && !$component.hasClass(_cssCls.collapsed)) {\r\n                                // click on the icon, just flag the item, unless the panel is collapsed\r\n                                if (!$item.hasClass(_cssCls.unseen) && !$item.hasClass(_cssCls.info)) {\r\n                                    flagItem($item);\r\n                                }\r\n                            } else if (!$item.hasClass(_cssCls.active)){\r\n                                // go to the selected item\r\n                                self.select($item);\r\n                                jump($item);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // click on the start button inside a linear part: jump to the position\r\n                $tree.on('click' + _selectors.component, _selectors.linearStart, function () {\r\n                    var $btn;\r\n\r\n                    if (!self.is('disabled')) {\r\n                        $btn = $(this);\r\n\r\n                        // go to the first item of the linear part\r\n                        if (!$btn.hasClass(_cssCls.disabled)) {\r\n                            $btn.addClass(_cssCls.disabled);\r\n                            jump($btn);\r\n                        }\r\n                    }\r\n\r\n                });\r\n\r\n                // click on a filter button\r\n                $filterBar.on('click' + _selectors.component, _selectors.filter, function () {\r\n                    var $btn, mode;\r\n\r\n                    if (!self.is('disabled')) {\r\n                        $btn = $(this);\r\n                        mode = $btn.data('mode');\r\n\r\n                        // select the button\r\n                        $filters.removeClass(_cssCls.active);\r\n                        $component.removeClass(_cssCls.collapsed);\r\n                        $btn.addClass(_cssCls.active);\r\n\r\n                        // filter the items\r\n                        self.filter(mode);\r\n\r\n                        //after filtering, ensure that the active item (if exists) is visible\r\n                        self.autoScroll();\r\n                    }\r\n                });\r\n\r\n                this.update(map, context);\r\n            });\r\n\r\n        // set default filter\r\n        navigator.currentFilter = 'all';\r\n\r\n        // the component will be ready\r\n        return navigator.init(config);\r\n    }\r\n\r\n    return navigatorFactory;\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Control Plugin : Review panel\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/review/review',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/helpers/map',\r\n    'taoQtiTest/runner/plugins/navigation/review/navigator'\r\n], function ($, _, __, hider, shortcut, namespaceHelper, pluginFactory, mapHelper, navigatorFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The display states of the buttons\r\n     */\r\n    var buttonData = {\r\n        setFlag: {\r\n            control: 'set-item-flag',\r\n            title: __('Flag the current item for later review'),\r\n            icon: 'anchor',\r\n            text: __('Flag for Review')\r\n        },\r\n        unsetFlag: {\r\n            control: 'unset-item-flag',\r\n            title: __('Do not flag the current item for later review'),\r\n            icon: 'anchor',\r\n            text: __('Unflag for Review')\r\n        },\r\n        showReview: {\r\n            control: 'show-review',\r\n            title: __('Show the review screen'),\r\n            icon: 'right',\r\n            text: __('Show Review')\r\n        },\r\n        hideReview: {\r\n            control: 'hide-review',\r\n            title: __('Hide the review screen'),\r\n            icon: 'left',\r\n            text: __('Hide Review')\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Gets the definition of the flagItem button related to the context\r\n     * @param {Object} context - the test context\r\n     * @returns {Object}\r\n     */\r\n    function getFlagItemButtonData(context) {\r\n        var dataType = context.itemFlagged ? 'unsetFlag' : 'setFlag';\r\n        return buttonData[dataType];\r\n    }\r\n\r\n    /**\r\n     * Gets the definition of the toggleNavigator button related to the context\r\n     * @param {Object} navigator - the navigator component\r\n     * @returns {Object}\r\n     */\r\n    function getToggleButtonData(navigator) {\r\n        var dataType = navigator.is('hidden') ? 'showReview' : 'hideReview';\r\n        return buttonData[dataType];\r\n    }\r\n\r\n    /**\r\n     * Update the button based on the provided data\r\n     * @param {Component} button - the element to update\r\n     * @param {Object} data - the button data\r\n     */\r\n    function updateButton(button, data) {\r\n        var $button = button.getElement();\r\n        if (button.is('rendered')) {\r\n            if ($button.data('control') !== data.control) {\r\n                $button\r\n                    .data('control', data.control)\r\n                    .attr('title', data.title);\r\n\r\n                $button.find('.icon').attr('class', 'icon icon-' + data.icon);\r\n                $button.find('.text').text(data.text);\r\n\r\n                if (_.contains(data.control, 'flag')) {\r\n                    if (button.is('active')) {\r\n                        button.turnOff();\r\n                    } else {\r\n                        button.turnOn();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if the current context allows to mark the item for review\r\n     * @param {Object} testRunner\r\n     * @returns {Boolean}\r\n     */\r\n    function canFlag(testRunner) {\r\n        var context = testRunner.getTestContext();\r\n        var map = testRunner.getTestMap();\r\n        var item = mapHelper.getItemAt(map, context.itemPosition);\r\n        return !!(!context.isLinear && context.options.markReview && !(item && item.informational));\r\n    }\r\n\r\n    /**\r\n     * Creates the timer plugin\r\n     */\r\n    return pluginFactory({\r\n        name: 'review',\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData();\r\n            var testContext = testRunner.getTestContext();\r\n            var testMap = testRunner.getTestMap();\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n            var navigatorConfig = testConfig.review || {};\r\n            var previousItemPosition;\r\n\r\n            /**\r\n             * Tells if the component is enabled\r\n             * @returns {Boolean}\r\n             */\r\n            function isPluginAllowed() {\r\n                var context = testRunner.getTestContext();\r\n                return navigatorConfig.enabled && context && context.options && context.options.reviewScreen;\r\n            }\r\n\r\n            /**\r\n             * Mark an item for review\r\n             * @param {Number} position\r\n             * @param {Boolean} flag\r\n             * @returns {Promise}\r\n             */\r\n            function flagItem(position, flag) {\r\n                self.disable();\r\n\r\n                return testRunner.getProxy()\r\n                    .callTestAction('flagItem', {\r\n                        position: position,\r\n                        flag: flag\r\n                    })\r\n                    .then(function () {\r\n                        var context = testRunner.getTestContext();\r\n\r\n                        // update the state in the context if the flagged item is the current one\r\n                        if (context.itemPosition === position) {\r\n                            context.itemFlagged = flag;\r\n                        }\r\n\r\n                        // update the display of the flag button\r\n                        updateButton(self.flagItemButton, getFlagItemButtonData(context));\r\n\r\n                        // update the item state\r\n                        self.navigator.setItemFlag(position, flag);\r\n                        self.enable();\r\n                    })\r\n                    .catch(function () {\r\n                        // rollback on the item flag\r\n                        self.navigator.setItemFlag(position, !flag);\r\n                        self.enable();\r\n                    });\r\n            }\r\n\r\n            /**\r\n             * Mark the current item for review\r\n             */\r\n            function flagCurrentItem() {\r\n                var context = testRunner.getTestContext();\r\n                if (self.getState('enabled') !== false) {\r\n                    flagItem(context.itemPosition, !context.itemFlagged);\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Shows/hides the review panel\r\n             *\r\n             * @param [{Boolean} forcedState], true will show the panel\r\n             */\r\n            function togglePanel(forcedState) {\r\n                var isHidden = _.isUndefined(forcedState) ? self.navigator.is('hidden') : forcedState;\r\n                if (isHidden) {\r\n                    self.explicitlyHidden = false;\r\n                    self.navigator.show();\r\n                } else {\r\n                    self.explicitlyHidden = true;\r\n                    self.navigator.hide();\r\n                }\r\n                updateButton(self.toggleButton, getToggleButtonData(self.navigator));\r\n            }\r\n\r\n            this.navigator = navigatorFactory(navigatorConfig, testMap, testContext)\r\n                .on('selected', function(position, previousPosition){\r\n                    previousItemPosition = previousPosition;\r\n                })\r\n                .on('jump', function (position) {\r\n                    if (self.getState('enabled') !== false) {\r\n                        self.disable();\r\n                        testRunner.jump(position, 'item');\r\n                    }\r\n                })\r\n                .on('flag', function (position, flag) {\r\n                    if (self.getState('enabled') !== false) {\r\n                        flagItem(position, flag);\r\n                    }\r\n                })\r\n                .render();\r\n\r\n            // restore current item in the navigator if movement not allowed\r\n            testRunner.on('alert.notallowed', function() {\r\n                self.navigator.select(previousItemPosition);\r\n            });\r\n\r\n            this.explicitlyHidden = false;\r\n\r\n            // register buttons in the toolbox component\r\n            this.toggleButton = this.getAreaBroker().getToolbox().createEntry(getToggleButtonData(this.navigator));\r\n            this.toggleButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-reviewpanel');\r\n            });\r\n\r\n            this.flagItemButton = this.getAreaBroker().getToolbox().createEntry(getFlagItemButtonData(testContext));\r\n            this.flagItemButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-flagitem');\r\n            });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.flag) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.flag, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-flagitem');\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                }\r\n\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-reviewpanel');\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                }\r\n            }\r\n\r\n            if (!isPluginAllowed()) {\r\n                this.hide();\r\n            }\r\n\r\n            //disabled by default\r\n            this.disable();\r\n\r\n            togglePanel(testConfig.review.defaultOpen);\r\n\r\n            //change plugin state\r\n            testRunner\r\n                .on('render', function () {\r\n                    if (isPluginAllowed()) {\r\n                        self.show();\r\n                        updateButton(self.toggleButton, getToggleButtonData(self.navigator));\r\n                    } else {\r\n                        self.hide();\r\n                    }\r\n                })\r\n                .on('loaditem', function () {\r\n                    var context = testRunner.getTestContext();\r\n                    var map = testRunner.getTestMap();\r\n\r\n                    if (isPluginAllowed()) {\r\n                        updateButton(self.flagItemButton, getFlagItemButtonData(context));\r\n                        self.navigator\r\n                            .update(map, context)\r\n                            .updateConfig({\r\n                                canFlag: !context.isLinear && context.options.markReview\r\n                            });\r\n                        self.show();\r\n                        updateButton(self.toggleButton, getToggleButtonData(self.navigator));\r\n                    } else {\r\n                        self.hide();\r\n                    }\r\n                })\r\n                .on('enabletools', function () {\r\n                    if (isPluginAllowed()) {\r\n                        self.enable();\r\n                    }\r\n                })\r\n                .on('disabletools', function () {\r\n                    if (isPluginAllowed()) {\r\n                        self.disable();\r\n                    }\r\n                })\r\n                .on('tool-flagitem', function () {\r\n                    if (isPluginAllowed() && canFlag(testRunner)) {\r\n                        flagCurrentItem();\r\n                    }\r\n                })\r\n                .on('tool-reviewpanel', function () {\r\n                    if (isPluginAllowed() && self.getState('enabled')) {\r\n                        togglePanel();\r\n                    }\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render: function render() {\r\n            var areaBroker = this.getAreaBroker();\r\n            var $panelContainer = areaBroker.getPanelArea();\r\n            $panelContainer.append(this.navigator.getElement());\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + this.getName());\r\n            this.navigator.destroy();\r\n        },\r\n\r\n        /**\r\n         * Enables the button\r\n         */\r\n        enable: function enable() {\r\n            var testRunner = this.getTestRunner();\r\n            var testContext = testRunner.getTestContext();\r\n\r\n            this.flagItemButton.enable();\r\n            this.toggleButton.enable();\r\n            this.navigator.enable();\r\n            if (testContext.itemFlagged) {\r\n                this.flagItemButton.turnOn();\r\n            } else {\r\n                this.flagItemButton.turnOff();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Disables the button\r\n         */\r\n        disable: function disable() {\r\n            this.flagItemButton.disable();\r\n            this.flagItemButton.turnOff();\r\n\r\n            this.toggleButton.disable();\r\n\r\n            this.navigator.disable();\r\n        },\r\n\r\n        /**\r\n         * Shows the button\r\n         */\r\n        show: function show() {\r\n            var testRunner = this.getTestRunner();\r\n            if (canFlag(testRunner)) {\r\n                this.flagItemButton.show();\r\n            } else {\r\n                this.flagItemButton.hide();\r\n            }\r\n            this.toggleButton.show();\r\n\r\n            if (!this.explicitlyHidden) {\r\n                this.navigator.show();\r\n            } else {\r\n                this.navigator.hide();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Hides the button\r\n         */\r\n        hide: function hide() {\r\n            this.flagItemButton.hide();\r\n            this.toggleButton.hide();\r\n            this.navigator.hide();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Navigation Plugin : Skip\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/navigation/skip',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/helpers/messages',\r\n    'tpl!taoQtiTest/runner/plugins/templates/button'\r\n], function ($, _, __, hider, pluginFactory, messages, buttonTpl){\r\n    'use strict';\r\n\r\n    /**\r\n     * The display of the skip\r\n     */\r\n    var buttonData = {\r\n        skip : {\r\n            control : 'skip',\r\n            title   : __('Skip  and go to the next item'),\r\n            icon    : 'external',\r\n            text    : __('Skip')\r\n        },\r\n        end : {\r\n            control : 'skip-end',\r\n            title   : __('Skip and go to the end of the test'),\r\n            icon    : 'external',\r\n            text    : __('Skip and end test')\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Create the button based on the current context\r\n     * @param {Object} context - the test context\r\n     * @returns {jQueryElement} the button\r\n     */\r\n    var createElement = function createElement(context){\r\n        var dataType = context.isLast ? 'end' : 'skip';\r\n        return $(buttonTpl(buttonData[dataType]));\r\n    };\r\n\r\n    /**\r\n     * Update the button based on the context\r\n     * @param {jQueryElement} $element - the element to update\r\n     * @param {Object} context - the test context\r\n     */\r\n    var updateElement = function updateElement($element, context){\r\n        var dataType = context.isLast ? 'end' : 'skip';\r\n        if($element.data('control') !== buttonData[dataType].control){\r\n\r\n            $element.data('control', buttonData[dataType].control)\r\n                    .attr('title', buttonData[dataType].title)\r\n                    .find('.text').text(buttonData[dataType].text);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name : 'skip',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n\r\n            var toggle = function toggle(){\r\n                var context = testRunner.getTestContext();\r\n                if(context.options.allowSkipping === true){\r\n                    self.show();\r\n                    return true;\r\n                }\r\n\r\n                self.hide();\r\n                return false;\r\n            };\r\n\r\n            function doSkip() {\r\n                testRunner.skip();\r\n            }\r\n\r\n            this.$element = createElement(testRunner.getTestContext());\r\n\r\n            this.$element.on('click', function(e){\r\n                var enable = _.bind(self.enable, self);\r\n                var context = testRunner.getTestContext();\r\n\r\n                e.preventDefault();\r\n\r\n                if(self.getState('enabled') !== false){\r\n                    self.disable();\r\n                    if(context.options.endTestWarning && context.isLast){\r\n                        testRunner.trigger(\r\n                            'confirm.endTest',\r\n                            messages.getExitMessage(\r\n                                __('You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test.'),\r\n                                'test', testRunner),\r\n                            doSkip, // if the test taker accept\r\n                            enable  // if the test taker refuse\r\n                        );\r\n                    } else {\r\n                        doSkip();\r\n                    }\r\n                }\r\n            });\r\n\r\n            toggle();\r\n            self.disable();\r\n\r\n            testRunner\r\n                .on('loaditem', function(){\r\n                    if(toggle()){\r\n                        updateElement(self.$element, testRunner.getTestContext());\r\n                    }\r\n                })\r\n                .on('enablenav', function(){\r\n                    self.enable();\r\n                })\r\n                .on('disablenav', function(){\r\n                    self.disable();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            var $container = this.getAreaBroker().getNavigationArea();\r\n            $container.append(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy (){\r\n            this.$element.remove();\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable (){\r\n            this.$element.removeProp('disabled')\r\n                         .removeClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable (){\r\n            this.$element.prop('disabled', true)\r\n                         .addClass('disabled');\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show(){\r\n            hider.show(this.$element);\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide(){\r\n            hider.hide(this.$element);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/security/disableRightClick',[\r\n    'taoTests/runner/plugin'\r\n], function (pluginFactory) {\r\n    'use strict';\r\n\r\n    return pluginFactory({\r\n\r\n        name: 'disableRightClick',\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var rightClickEvents = ['contextmenu', 'mousedown', 'mouseup'];\r\n\r\n            rightClickEvents.forEach(function(eventName) {\r\n                window.document.addEventListener(eventName, function disableRightClick(event) {\r\n                    if (event.button === 2) {\r\n                        event.preventDefault();\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    });\r\n});\r\n\n","\r\n/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\r\n */\r\n\r\n/**\r\n * Answer Eliminator Plugin\r\n *\r\n * While the platform's answer eliminator works on a per-item base, this variation allows\r\n * answer elimination on a test level. Essentially it allows to add a class 'eliminable'\r\n * to a choice interaction, from there the aforementioned item-based behaviour and styling takes\r\n * over.\r\n *\r\n * Alternative styling will be on a per customer basis and should always be published as a recipe\r\n * in the theme-toolkit.\r\n *\r\n * @author Dieter Raber <dieter@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/answerElimination/eliminator',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoTests/runner/plugin'\r\n], function ($, _, __, hider, shortcut, namespaceHelper, pluginFactory){\r\n    'use strict';\r\n\r\n    /**\r\n     * The public name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'eliminator';\r\n\r\n    /**\r\n     * The prefix of actions triggered through the event loop\r\n     * @type {String}\r\n     */\r\n    var actionPrefix = 'tool-' + pluginName + '-';\r\n\r\n\r\n    /**\r\n     * Some default options for the plugin\r\n     * @type {Object}\r\n     */\r\n    var defaultConfig = {\r\n        // when hiding the buttons, don't remove existing eliminations\r\n        removeEliminationsOnClose: false,\r\n        // when showing the buttons, restore previously set eliminations\r\n        restoreEliminationsOnOpen: false\r\n    };\r\n\r\n\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: pluginName,\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner();\r\n            var $container = testRunner.getAreaBroker().getContentArea().parent();\r\n            var testConfig = testRunner.getTestData().config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[pluginName] || {};\r\n            var config     = _.defaults(_.clone((testConfig.plugins || {})[pluginName]) || {}, defaultConfig);\r\n\r\n            // register the button in the toolbox\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                control : 'eliminator',\r\n                title : __('Eliminate choices'),\r\n                icon : 'eliminate',\r\n                text : __('Answer Eliminator')\r\n            });\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isPluginEnabled() {\r\n                var context = testRunner.getTestContext() || {},\r\n                    options = context.options || {};\r\n                //to be activated with the special category x-tao-option-eliminator\r\n                return !!options.eliminator;\r\n            }\r\n\r\n            /**\r\n             * Is plugin activated ? if not, then we hide the plugin\r\n             */\r\n            function togglePluginButton() {\r\n                if (isPluginEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            function togglePlugin() {\r\n                if (!self.$choiceInteractions) {\r\n                    return;\r\n                }\r\n                self.$choiceInteractions.toggleClass('eliminable');\r\n                if (isEliminable()) {\r\n                    enableEliminator();\r\n                } else {\r\n                    disableEliminator();\r\n                }\r\n            }\r\n\r\n            function isEliminable() {\r\n                if (!self.$choiceInteractions) {\r\n                    return;\r\n                }\r\n                return self.$choiceInteractions.hasClass('eliminable');\r\n            }\r\n\r\n            function enableEliminator() {\r\n                var $choices;\r\n                if (!self.$choiceInteractions) {\r\n                    return;\r\n                }\r\n                $choices = self.$choiceInteractions.find('.qti-choice');\r\n\r\n                self.button.turnOn();\r\n                self.trigger('start');\r\n\r\n                if(config.restoreEliminationsOnOpen) {\r\n                    $choices.each(function() {\r\n                        var input = this.querySelector('.real-label input');\r\n                        if(this.dataset.wasEliminated) {\r\n                            this.dataset.wasEliminated = null;\r\n                            this.classList.add('eliminated');\r\n                            input.setAttribute('disabled', 'disabled');\r\n                            input.checked = false;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            function disableEliminator() {\r\n                var $choices;\r\n                if (!self.$choiceInteractions) {\r\n                    return;\r\n                }\r\n                $choices = self.$choiceInteractions.find('.qti-choice');\r\n\r\n                self.$choiceInteractions.removeClass('eliminable');\r\n                self.button.turnOff();\r\n                self.trigger('end');\r\n\r\n                $choices.each(function() {\r\n                    if(this.classList.contains('eliminated')) {\r\n                        this.dataset.wasEliminated = true;\r\n                        this.classList.remove('eliminated');\r\n                        this.querySelector('.real-label input').removeAttribute('disabled');\r\n                    }\r\n                });\r\n            }\r\n\r\n            //add a new mask each time the button is pressed\r\n            this.button.on('click', function (e){\r\n                e.preventDefault();\r\n                testRunner.trigger(actionPrefix + 'toggle');\r\n            });\r\n\r\n            // handle the plugin's shortcuts\r\n            if (testConfig.allowShortcuts) {\r\n                _.forEach(pluginShortcuts, function (command, key) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(command, pluginName, true), function () {\r\n                        // just fire the action using the event loop\r\n                        testRunner.trigger(actionPrefix + key);\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                });\r\n            }\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', togglePluginButton)\r\n                .on('renderitem', function conditionalInit() {\r\n                    // show button only when in the presence of choice interactions\r\n                    self.$choiceInteractions = $container.find('.qti-choiceInteraction');\r\n                    if(!self.$choiceInteractions.length) {\r\n                        self.hide();\r\n                        return;\r\n                    }\r\n                    if (isPluginEnabled()) {\r\n                        self.show();\r\n                    }\r\n                })\r\n                .on('enabletools renderitem', function (){\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function (){\r\n                    self.disable();\r\n                    disableEliminator();\r\n                })\r\n\r\n                // commands that controls the plugin\r\n                .on(actionPrefix + 'toggle', function () {\r\n                    if (isPluginEnabled()) {\r\n                        togglePlugin();\r\n                    }\r\n                })\r\n                // Answer-eliminator and Answer-masking are mutually exclusive tools\r\n                .on('tool-answer-masking-toggle', function () {\r\n                    if (isEliminable()) {\r\n                        disableEliminator();\r\n                    }\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy(){\r\n            shortcut.remove('.' + pluginName);\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable(){\r\n            this.button.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable(){\r\n            this.button.disable();\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show : function show(){\r\n            this.button.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide : function hide(){\r\n            this.button.hide();\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/tools/answerMasking/tpl/mask', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"answer-mask\\\">\\r\\n    <span class=\\\"answer-mask-toggle\\\"></span>\\r\\n</div>\";\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\r\n */\r\n/**\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/answerMasking/answerMasking',[\r\n    'lodash',\r\n    'jquery',\r\n    'core/statifier',\r\n    'ui/component',\r\n    'tpl!taoQtiTest/runner/plugins/tools/answerMasking/tpl/mask'\r\n], function(_, $, statifier, componentFactory, maskTpl) {\r\n    'use strict';\r\n\r\n    var ns = '.answerMasking';\r\n\r\n    /**\r\n     * @param {jQuery} $contentArea - DOM element containing the rendered item\r\n     */\r\n    return function answerMaskingFactory($contentArea) {\r\n        var answerMasking,\r\n            allMasks = [],\r\n\r\n            maskApi = {\r\n                /**\r\n                 * Toggle mask visibility\r\n                 * @returns {component}\r\n                 */\r\n                toggle: function toggle() {\r\n                    if (this.is('masked')) {\r\n                        return this.reveal();\r\n                    } else {\r\n                        return this.mask();\r\n                    }\r\n                },\r\n\r\n                /**\r\n                 * Show the choice under the current mask\r\n                 * @returns {component}\r\n                 */\r\n                reveal: function reveal() {\r\n                    var $container = this.getContainer();\r\n                    $container.removeClass('masked');\r\n                    $container.find('input').removeAttr('disabled');\r\n\r\n                    this.setState('masked', false);\r\n\r\n                    return this;\r\n                },\r\n\r\n                /**\r\n                 * Cover the whole choice with the mask\r\n                 * @returns {component}\r\n                 */\r\n                mask: function mask() {\r\n                    var $container = this.getContainer();\r\n                    $container.addClass('masked');\r\n                    $container.find('input').attr('disabled', 'disabled');\r\n\r\n                    this.setState('masked', true);\r\n\r\n                    return this;\r\n                }\r\n            };\r\n\r\n        /**\r\n         * Creates a ui/component to serve as a mask over a QTI Choice\r\n         * @param {jQuery} $container - the qti-choice element\r\n         * @returns {component}\r\n         */\r\n        function createMask($container) {\r\n            return componentFactory(maskApi)\r\n                .setTemplate(maskTpl)\r\n                .on('render', function() {\r\n                    var self = this,\r\n                        $component = this.getElement();\r\n\r\n                    $component.on('click' + ns, function(e) {\r\n                        e.stopPropagation();\r\n                        e.preventDefault();\r\n\r\n                        self.toggle();\r\n                    });\r\n                })\r\n                .on('destroy', function() {\r\n                    var $component = this.getElement();\r\n                    $component.off(ns);\r\n                })\r\n                .init()\r\n                .render($container)\r\n                .mask();\r\n        }\r\n\r\n        /**\r\n         * The answer masking helper\r\n         */\r\n        answerMasking = {\r\n            /**\r\n             * Enable the answer masking functionality by creating masks over the Qti Choices\r\n             */\r\n            enable: function enable() {\r\n                var $choiceInteractions = $contentArea.find('.qti-choiceInteraction'),\r\n                    $qtiChoices = $contentArea.find('.qti-choice');\r\n\r\n                allMasks = [];\r\n\r\n                $choiceInteractions.addClass('maskable');\r\n\r\n                $qtiChoices.each(function () {\r\n                    var $choice = $(this);\r\n                    allMasks.push(createMask($choice));\r\n                });\r\n\r\n                this.setState('enabled', true);\r\n            },\r\n\r\n            /**\r\n             * Remove any answerMasking-related markup from the rendered item\r\n             */\r\n            disable: function disable() {\r\n                var $choiceInteractions = $contentArea.find('.qti-choiceInteraction');\r\n                $choiceInteractions.removeClass('maskable');\r\n\r\n                allMasks.forEach(function(mask) {\r\n                    mask.reveal(); // remove class on container\r\n                    mask.destroy();\r\n                });\r\n\r\n                allMasks = [];\r\n\r\n                this.setState('enabled', false);\r\n            },\r\n\r\n            /**\r\n             * Return the current state of the masks\r\n             * @returns {Boolean[]} - true if the choice is masked, false if the choice is revealed\r\n             */\r\n            getMasksState: function getMasksState() {\r\n                var state = allMasks.map(function (mask) {\r\n                    return mask.is('masked');\r\n                });\r\n                return state;\r\n            },\r\n\r\n            /**\r\n             * Restore a previously saved state for the masked choices\r\n             * @param {Boolean[]} state - array of boolean, most probably given by the getMasksState method\r\n             */\r\n            setMasksState: function setMasksState(state) {\r\n                state = state || [];\r\n\r\n                state.forEach(function (masked, index) {\r\n                    var mask = allMasks[index];\r\n\r\n                    if (_.isObject(mask) && _.isFunction(mask.reveal) && ! masked) {\r\n                        mask.reveal();\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        statifier(answerMasking);\r\n\r\n        return answerMasking;\r\n    };\r\n});\n","/*\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n *\r\n */\r\n/**\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/answerMasking/plugin',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoQtiTest/runner/plugins/tools/answerMasking/answerMasking'\r\n], function ($, _, __, pluginFactory, hider, shortcut, namespaceHelper, answerMaskingFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The public name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'answer-masking';\r\n\r\n    /**\r\n     * The prefix of actions triggered through the event loop\r\n     * @type {String}\r\n     */\r\n    var actionPrefix = 'tool-' + pluginName + '-';\r\n\r\n    /**\r\n     * Stores the masking state for each item in the test\r\n     * @type {Object}\r\n     */\r\n    var itemStates = {};\r\n\r\n    /**\r\n     * Default Configuration\r\n     */\r\n    var defaultConfig = {\r\n        restoreStateOnToggle: true,\r\n        restoreStateOnMove: true\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: pluginName,\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner(),\r\n                testData = testRunner.getTestData() || {},\r\n                testConfig = testData.config || {},\r\n                pluginConfig = _.defaults((testConfig.plugins || {})[pluginName] || {}, defaultConfig),\r\n                pluginShortcuts = (testConfig.shortcuts || {})[pluginName] || {},\r\n                $contentArea = this.getAreaBroker().getContentArea();\r\n\r\n            var answerMasking = answerMaskingFactory($contentArea);\r\n\r\n            function isPluginEnabled() {\r\n                var context = testRunner.getTestContext() || {},\r\n                    options = context.options || {};\r\n                //to be activated with the special category x-tao-option-answerMasking\r\n                return options.answerMasking && itemContainsChoiceInteraction();\r\n            }\r\n\r\n            function itemContainsChoiceInteraction() {\r\n                var $container = self.getAreaBroker().getContentArea().parent();\r\n                return $container.find('.qti-choiceInteraction').length;\r\n            }\r\n\r\n            function togglePluginButton() {\r\n                if (isPluginEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            function togglePlugin() {\r\n                if (! answerMasking.getState('enabled')) {\r\n                    enableMasking();\r\n                } else {\r\n                    disableMasking();\r\n                }\r\n            }\r\n\r\n            function enableMasking() {\r\n                var testContext = testRunner.getTestContext(),\r\n                    itemId = testContext.itemIdentifier;\r\n\r\n                answerMasking.enable();\r\n                if (pluginConfig.restoreStateOnToggle) {\r\n                    answerMasking.setMasksState(itemStates[itemId]);\r\n                }\r\n                self.button.turnOn();\r\n                self.trigger('start');\r\n            }\r\n\r\n            function disableMasking() {\r\n                var testContext = testRunner.getTestContext(),\r\n                    itemId = testContext.itemIdentifier;\r\n\r\n                if (answerMasking.getState('enabled')) {\r\n                    itemStates[itemId] = answerMasking.getMasksState();\r\n                }\r\n\r\n                answerMasking.disable();\r\n                self.button.turnOff();\r\n                self.trigger('end');\r\n            }\r\n\r\n            // create buttons\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                title: __('Answer Masking'),\r\n                icon: 'result-nok',\r\n                control: 'answer-masking',\r\n                text: __('Answer Masking')\r\n            });\r\n\r\n            // attach user events\r\n            this.button\r\n                .on('click', function(e) {\r\n                    e.preventDefault();\r\n                    testRunner.trigger(actionPrefix + 'toggle');\r\n                });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger(actionPrefix + 'toggle');\r\n                    }, { avoidInput: true, prevent: true });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', function() {\r\n                    var testContext = testRunner.getTestContext(),\r\n                        itemId = testContext.itemIdentifier;\r\n\r\n                    if (! pluginConfig.restoreStateOnMove) {\r\n                        itemStates[itemId] = [];\r\n                    }\r\n\r\n                    togglePluginButton();\r\n                })\r\n                .on('enabletools renderitem', function () {\r\n                    togglePluginButton(); // we repeat this here as we need the rendered item markup in order to decide whether the plugin is enabled\r\n                    self.enable();\r\n                })\r\n                .on('beforeunloaditem', function() {\r\n                    disableMasking();\r\n                })\r\n                .on('disabletools unloaditem', function () {\r\n                    self.disable();\r\n                    disableMasking();\r\n                })\r\n                .on(actionPrefix + 'toggle', function () {\r\n                    if (isPluginEnabled()) {\r\n                        togglePlugin();\r\n                    }\r\n                })\r\n                // Answer-eliminator and Answer-masking are mutually exclusive tools\r\n                .on('tool-eliminator-toggle', function () {\r\n                    disableMasking();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + this.getName());\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable: function enable() {\r\n            this.button.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable: function disable() {\r\n            this.button.disable();\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show() {\r\n            this.button.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide() {\r\n            this.button.hide();\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/tools/areaMasking/mask', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"mask\\\">\\r\\n   <div class=\\\"inner\\\"></div>\\r\\n   <div class=\\\"controls\\\">\\r\\n        <a href=\\\"#\\\" class=\\\"view\\\"  title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Preview the covered area\", options) : helperMissing.call(depth0, \"__\", \"Preview the covered area\", options)))\n    + \"\\\"><span class=\\\"icon-preview\\\"></span></a>\\r\\n        <a href=\\\"#\\\" class=\\\"close\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close the mask\", options) : helperMissing.call(depth0, \"__\", \"Close the mask\", options)))\n    + \"\\\"><span class=\\\"icon-result-nok\\\"></span></a>\\r\\n   </div>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA;\r\n */\r\n\r\n/**\r\n * Create a movable and resizable element in order to mask areas.\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/areaMasking/mask',[\r\n    'lodash',\r\n    'ui/movableComponent',\r\n    'tpl!taoQtiTest/runner/plugins/tools/areaMasking/mask'\r\n], function (_, movableComponent, areaMaskingTpl) {\r\n    'use strict';\r\n\r\n    var defaultConfig = {\r\n        previewDelay: 3000,\r\n        stackingScope: 'test-runner'\r\n    };\r\n\r\n    /**\r\n     * Creates a new masking component\r\n     * @returns {maskComponent} the component (uninitialized)\r\n     */\r\n    function maskingComponentFactory () {\r\n\r\n        /**\r\n         * @typedef {Object} maskComponent\r\n         */\r\n        var maskComponent = movableComponent({\r\n            /**\r\n             * Preview the content under the masked area\r\n             * @returns {maskComponent} chains\r\n             *\r\n             * @fires maskComponent#preview\r\n             */\r\n            preview : function preview(){\r\n                var self   = this;\r\n                var delay  = this.config.previewDelay || 1000;\r\n                if( this.is('rendered') && !this.is('disabled') && !this.is('previewing') ){\r\n                    this.setState('previewing', true)\r\n                        .trigger('preview');\r\n                    _.delay(function(){\r\n                        self.setState('previewing', false);\r\n                    }, delay);\r\n                }\r\n                return this;\r\n            }\r\n        }, defaultConfig);\r\n\r\n\r\n        maskComponent\r\n            .setTemplate(areaMaskingTpl)\r\n            .on('render', function(){\r\n                var self     = this;\r\n                var $element = this.getElement();\r\n\r\n                $element\r\n                    .on('click touchstart', '.view', function(e){\r\n                        e.preventDefault();\r\n                        self.preview();\r\n                    })\r\n                    .on('click touchstart', '.close', function(e){\r\n                        e.preventDefault();\r\n                        self.destroy();\r\n                    });\r\n            });\r\n\r\n        return maskComponent;\r\n    }\r\n\r\n    return maskingComponentFactory;\r\n});\r\n\n","\r\n/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA;\r\n */\r\n\r\n/**\r\n * Area Masking Plugin\r\n *\r\n * @author Bertrand Chevrier <bertrand@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/areaMasking/areaMasking',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoTests/runner/plugin',\r\n    'taoQtiTest/runner/plugins/tools/areaMasking/mask'\r\n], function ($, _, __, hider, shortcut, namespaceHelper, pluginFactory, maskComponent){\r\n    'use strict';\r\n\r\n    /**\r\n     * The public name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'area-masking';\r\n\r\n    /**\r\n     * The prefix of actions triggered through the event loop\r\n     * @type {String}\r\n     */\r\n    var actionPrefix = 'tool-' + pluginName + '-';\r\n\r\n    /**\r\n     * Some default options for the plugin\r\n     * @type {Object}\r\n     */\r\n    var defaultConfig = {\r\n        max : 5,\r\n        foo : true\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: pluginName,\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner();\r\n            var $container = testRunner.getAreaBroker().getContentArea().parent();\r\n            var testConfig = testRunner.getTestData().config || {};\r\n            var config     = _.defaults(_.clone((testConfig.plugins || {})[pluginName]) || {}, defaultConfig);\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[pluginName] || {};\r\n\r\n            function addMask() {\r\n                maskComponent()\r\n                    .on('render', function(){\r\n                        self.masks.push(this);\r\n                        self.button.turnOn();\r\n\r\n                        /**\r\n                         * @event areaMasking#maskadd\r\n                         */\r\n                        self.trigger('maskadd');\r\n                    })\r\n                    .on('destroy', function(){\r\n                        self.masks = _.without(self.masks, this);\r\n                        if(self.masks.length < config.max){\r\n                            self.enable();\r\n                        }\r\n                        if (self.masks.length === 0) {\r\n                            self.button.turnOff();\r\n                            self.trigger('close');\r\n                        }\r\n\r\n                        /**\r\n                         * @event areaMasking#maskclose\r\n                         */\r\n                        self.trigger('maskclose');\r\n                    })\r\n                    .init({\r\n                        x : self.masks.length * 10,\r\n                        y : self.masks.length * 10\r\n                    })\r\n                    .render($container);\r\n            }\r\n\r\n            //keep a ref to all masks\r\n            this.masks = [];\r\n\r\n            // register the element in the Toolbox\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                control : 'area-masking',\r\n                text : __('Masking'),\r\n                title : __('Covers parts of the item'),\r\n                icon : 'eye-slash'\r\n            });\r\n\r\n            //add a new mask each time the button is pressed\r\n            this.button.on('click', function (e){\r\n                e.preventDefault();\r\n                testRunner.trigger(actionPrefix + 'toggle');\r\n            });\r\n\r\n            // handle the plugin's shortcuts\r\n            if (testConfig.allowShortcuts) {\r\n                _.forEach(pluginShortcuts, function (command, key) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(command, pluginName, true), function () {\r\n                        // just fire the action using the event loop\r\n                        testRunner.trigger(actionPrefix + key);\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                });\r\n            }\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isEnabled() {\r\n                var context = testRunner.getTestContext(),\r\n                    options = context.options || {};\r\n                //to be activated with the special category x-tao-option-areaMasking\r\n                return !!options.areaMasking;\r\n            }\r\n\r\n            /**\r\n             * Is plugin activated ? if not, then we hide the plugin\r\n             */\r\n            function togglePlugin() {\r\n                if (isEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', togglePlugin)\r\n                .on('enabletools renderitem', function (){\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function (){\r\n                    self.disable();\r\n                    //remove all masks\r\n                    _.invoke(self.masks, 'destroy');\r\n                })\r\n                // commands that controls the plugin\r\n                .on(actionPrefix + 'toggle', function () {\r\n                    if (isEnabled()) {\r\n                        if (self.masks.length === 0) {\r\n                            self.trigger('open');\r\n                        }\r\n                        if (self.masks.length < config.max) {\r\n                            addMask();\r\n                        } else if (config.max === 1) {\r\n                            _.invoke(self.masks, 'destroy');\r\n                        }\r\n                    }\r\n                });\r\n\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy(){\r\n            shortcut.remove('.' + pluginName);\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable(){\r\n            this.button.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable(){\r\n            this.button.disable();\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show : function show(){\r\n            this.button.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide : function hide(){\r\n            this.button.hide();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Tool Plugin : Calculator\r\n *\r\n * @author Sam <sam@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/calculator',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/hider',\r\n    'ui/calculator',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoTests/runner/plugin'\r\n], function ($, _, __, hider, calculatorFactory, shortcut, namespaceHelper, pluginFactory){\r\n    'use strict';\r\n\r\n    var _default = {\r\n        height : 360,\r\n        width : 240,\r\n        top : 50,\r\n        left : 10,\r\n        stackingScope: 'test-runner'\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n        name : 'calculator',\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var areaBroker = this.getAreaBroker();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginsConfig = testConfig.plugins || {};\r\n            var config = pluginsConfig.calculator || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isEnabled() {\r\n                var context = testRunner.getTestContext() || {},\r\n                    options = context.options || {};\r\n\r\n                //to be activated with the special category x-tao-option-calculator\r\n                return !!options.calculator;\r\n            }\r\n\r\n            /**\r\n             * Is calculator activated ? if not, then we hide the plugin\r\n             */\r\n            function togglePlugin() {\r\n                if (isEnabled()) {//allow calculator\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Build the calculator component\r\n             * @param {Function} [calcTpl] - an optional alternative template for the calculator\r\n             */\r\n            function buildCalculator(calcTpl){\r\n                self.calculator = calculatorFactory(_.defaults({\r\n                    renderTo: self.$calculatorContainer,\r\n                    replace: true,\r\n                    draggableContainer: areaBroker.getContainer(),\r\n                    alternativeTemplate : calcTpl || null\r\n                }, _default)).on('show', function () {\r\n                    self.trigger('open');\r\n                    self.button.turnOn();\r\n                }).on('hide', function () {\r\n                    self.trigger('close');\r\n                    self.button.turnOff();\r\n                }).show();\r\n            }\r\n\r\n            /**\r\n             * Show/hide the calculator\r\n             */\r\n            function toggleCalculator() {\r\n                if (self.getState('enabled') !== false) {\r\n                    if (self.calculator) {\r\n                        //just show/hide the calculator widget\r\n                        if (self.calculator.is('hidden')) {\r\n                            self.calculator.show();\r\n                        } else {\r\n                            self.calculator.hide();\r\n                        }\r\n                    } else {\r\n                        //build calculator widget\r\n                        if(config.template){\r\n                            require(['tpl!' + config.template.replace(/\\.tpl$/, '')], function(calcTpl){\r\n                                buildCalculator(calcTpl);\r\n                            }, function(){\r\n                                //in case of error, display the default calculator:\r\n                                buildCalculator();\r\n                            });\r\n                        }else{\r\n                            buildCalculator();\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n\r\n            //build element (detached)\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                control : 'calculator',\r\n                title : __('Open Calculator'),\r\n                icon : 'table',\r\n                text : __('Calculator')\r\n            });\r\n            this.$calculatorContainer = $('<div class=\"widget-calculator\">');\r\n\r\n            //init calculator instance var, it will be created only necessary\r\n            this.calculator = null;\r\n\r\n            //attach behavior\r\n            this.button.on('click', function (e){\r\n                //prevent action if the click is made inside the form which is a sub part of the button\r\n                if($(e.target).closest('.widget-calculator').length){\r\n                    return;\r\n                }\r\n\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-calculator');\r\n            });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-calculator');\r\n                    }, {\r\n                        avoidInput: true,\r\n                        allowIn: '.widget-calculator'\r\n                    });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            togglePlugin();\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', togglePlugin)\r\n                .on('enabletools renderitem', function (){\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function (){\r\n                    self.disable();\r\n                    if(self.calculator){\r\n                        //destroy calculator to create a new instance of calculator each time\r\n                        self.calculator.destroy();\r\n                        self.calculator = null;\r\n                    }\r\n                })\r\n                .on('tool-calculator', function () {\r\n                    if (isEnabled()) {\r\n                        toggleCalculator();\r\n                    }\r\n                });\r\n        },\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render : function render(){\r\n            var areaBroker = this.getAreaBroker();\r\n            areaBroker.getContainer().append(this.$calculatorContainer);\r\n        },\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy(){\r\n            shortcut.remove('.' + this.getName());\r\n\r\n            this.$calculatorContainer.remove();\r\n            if(this.calculator){\r\n                this.calculator.destroy();\r\n            }\r\n        },\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable(){\r\n            this.button.enable();\r\n        },\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable(){\r\n            this.button.disable();\r\n            if(this.calculator){\r\n                this.calculator.hide();\r\n            }\r\n        },\r\n        /**\r\n         * Show the button\r\n         */\r\n        show : function show(){\r\n            this.button.show();\r\n        },\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide : function hide(){\r\n            this.button.hide();\r\n            if(this.calculator){\r\n                this.calculator.hide();\r\n            }\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/tools/comment/comment', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div data-control=\\\"qti-comment\\\" class=\\\"hidden\\\">\\r\\n    <textarea data-control=\\\"qti-comment-text\\\" placeholder=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Your comment…\", options) : helperMissing.call(depth0, \"__\", \"Your comment…\", options)))\n    + \"\\\"></textarea>\\r\\n    <button data-control=\\\"qti-comment-cancel\\\" class=\\\"btn-info small\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Cancel\", options) : helperMissing.call(depth0, \"__\", \"Cancel\", options)))\n    + \"</button>\\r\\n    <button data-control=\\\"qti-comment-send\\\" class=\\\"btn-info small\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Send\", options) : helperMissing.call(depth0, \"__\", \"Send\", options)))\n    + \"</button>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Tool Plugin : Comment form\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/comment/comment',[\r\n    'jquery',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/hider',\r\n    'ui/stacker',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'tpl!taoQtiTest/runner/plugins/tools/comment/comment'\r\n], function ($, __, pluginFactory, hider, stackerFactory, shortcut, namespaceHelper, commentTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'comment',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n            var stacker = stackerFactory('test-runner');\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isEnabled() {\r\n                var context = testRunner.getTestContext();\r\n                return !!context.options.allowComment;\r\n            }\r\n\r\n            /**\r\n             * Can we comment ? if not, then we hide the plugin\r\n             */\r\n            function togglePlugin() {\r\n                if (isEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Show/hide the comment panel\r\n             */\r\n            function toggleComment() {\r\n                if (self.getState('enabled') !== false) {\r\n                    //just show/hide the form\r\n                    hider.toggle(self.$form);\r\n                    if (!hider.isHidden(self.$form)) {\r\n                        //reset the form on each display\r\n                        self.$input.val('').focus();\r\n                        self.button.turnOn();\r\n                        stacker.bringToFront(self.$form);\r\n                    } else {\r\n                        self.button.turnOff();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // register button in toolbox\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                control: 'comment',\r\n                title: __('Leave a comment'),\r\n                icon: 'tag',\r\n                text: __('Comment')\r\n            });\r\n\r\n            //get access to controls\r\n            this.button.on('render', function() {\r\n                self.$button = self.button.getElement();\r\n                self.$form = $(commentTpl()).appendTo(self.$button);\r\n                self.$input = self.$button.find('[data-control=\"qti-comment-text\"]');\r\n                self.$cancel = self.$button.find('[data-control=\"qti-comment-cancel\"]');\r\n                self.$submit = self.$button.find('[data-control=\"qti-comment-send\"]');\r\n\r\n                stacker.autoBringToFront(self.$form);\r\n\r\n                //hide the form without submit\r\n                self.$cancel.on('click', function () {\r\n                    hider.hide(self.$form);\r\n                    self.button.turnOff();\r\n                });\r\n\r\n                //submit the comment, then hide the form\r\n                self.$submit.on('click', function () {\r\n                    var comment = self.$input.val();\r\n\r\n                    if (comment) {\r\n                        self.disable();\r\n                        self.button.turnOff();\r\n\r\n                        testRunner.getProxy()\r\n                            .callTestAction('comment', {\r\n                                comment: comment\r\n                            })\r\n                            .then(function () {\r\n                                hider.hide(self.$form);\r\n                                self.enable();\r\n                            })\r\n                            .catch(function () {\r\n                                hider.hide(self.$form);\r\n                                self.enable();\r\n                            });\r\n                    }\r\n                });\r\n            });\r\n\r\n\r\n            //attach behavior\r\n            this.button.on('click', function (e) {\r\n                //prevent action if the click is made inside the form which is a sub part of the button\r\n                if ($(e.target).closest('[data-control=\"qti-comment\"]').length) {\r\n                    return;\r\n                }\r\n\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-comment');\r\n            });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-comment');\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            togglePlugin();\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', togglePlugin)\r\n                .on('renderitem enabletools', function () {\r\n                    self.enable();\r\n                })\r\n                .on('unloaditem disabletools', function () {\r\n                    self.disable();\r\n                })\r\n                .on('tool-comment', function () {\r\n                    if (isEnabled()) {\r\n                        toggleComment();\r\n                    }\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + this.getName());\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable: function enable() {\r\n            this.button.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable: function disable() {\r\n            if (this.$form) {\r\n                hider.hide(this.$form);\r\n            }\r\n            this.button.disable();\r\n            this.button.turnOff();\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show() {\r\n            this.button.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide() {\r\n            if (this.$form) {\r\n                hider.hide(this.$form);\r\n            }\r\n            this.button.hide();\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/tools/documentViewer/panel', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"document-viewer-plugin hidden\\\">\\r\\n    <div class=\\\"viewer-overlay\\\"></div>\\r\\n    <div class=\\\"viewer-panel\\\">\\r\\n        <div class=\\\"viewer-header\\\">\\r\\n            <span class=\\\"viewer-title\\\">\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\r\\n            <span class=\\\"icon icon-close\\\"></span>\\r\\n        </div>\\r\\n        <div class=\\\"viewer-content\\\">\";\n  if (helper = helpers.content) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.content); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</div>\\r\\n        <div class=\\\"viewer-footer\\\"></div>\\r\\n    </div>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Tool Plugin : View a document\r\n *\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/documentViewer/documentViewer',[\r\n    'jquery',\r\n    'lodash',\r\n    'ui/hider',\r\n    'ui/documentViewer',\r\n    'ui/documentViewer/providers/pdfViewer',\r\n    'taoTests/runner/plugin',\r\n    'tpl!taoQtiTest/runner/plugins/tools/documentViewer/panel'\r\n], function ($, _, hider, viewerFactory, pdfViewer, pluginFactory, panelTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'documentViewer';\r\n\r\n    /**\r\n     * Shows the panel, trigger the `panelshow` event\r\n     *\r\n     * @param plugin\r\n     */\r\n    function showPanel(plugin) {\r\n        hider.show(plugin.controls.$panel);\r\n        plugin.trigger('panelshow');\r\n        $(window).on('resize.' + plugin.getName(), _.debounce(_.partial(resizeViewer, plugin), 50));\r\n    }\r\n\r\n    /**\r\n     * Hides the panel, trigger the `panelhide` event\r\n     *\r\n     * @param plugin\r\n     */\r\n    function hidePanel(plugin) {\r\n        hider.hide(plugin.controls.$panel);\r\n        plugin.trigger('panelhide');\r\n        $(window).off('resize.' + plugin.getName());\r\n    }\r\n\r\n    /**\r\n     * Hides the panel if it is visible\r\n     *\r\n     * @param plugin\r\n     * @returns {Boolean} Returns `true` if the panel was visible and has been hidden\r\n     */\r\n    function hideIfVisible(plugin) {\r\n        var isVisible = !hider.isHidden(plugin.controls.$panel, true);\r\n        if (isVisible) {\r\n            hidePanel(plugin);\r\n        }\r\n        return isVisible;\r\n    }\r\n\r\n    /**\r\n     * Initializes the event handlers for the panel container\r\n     *\r\n     * @param plugin\r\n     */\r\n    function initPanelEvents(plugin) {\r\n        var namespace = '.' + plugin.getName();\r\n        var stopEvents = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchend', 'keyup', 'keydow', 'keypress', 'scroll', 'drop'].join(namespace + ' ') + namespace;\r\n        var hideViewer = _.partial(hidePanel, plugin);\r\n\r\n        function stopPropagation(e) {\r\n            e.stopImmediatePropagation();\r\n            e.stopPropagation();\r\n        }\r\n\r\n        plugin.controls.$overlay\r\n            .off(namespace)\r\n            .on('click' + namespace, hideViewer)\r\n            .on(stopEvents, stopPropagation);\r\n\r\n        plugin.controls.$panel\r\n            .off(namespace)\r\n            .on('click' + namespace, '.icon-close', hideViewer)\r\n            .on(stopEvents, stopPropagation);\r\n    }\r\n\r\n    /**\r\n     * Resizes the viewer to fit the panel content area\r\n     * @param plugin\r\n     */\r\n    function resizeViewer(plugin) {\r\n        var $content = plugin.controls.$content;\r\n        plugin.viewer.setSize($content.width(), $content.height());\r\n    }\r\n\r\n    // all document viewers need to be registered\r\n    viewerFactory.registerProvider('pdf', pdfViewer);\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: pluginName,\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var $panel = $(panelTpl());\r\n\r\n            /**\r\n             * @param {Object} data\r\n             * @param {String} data.label - document title\r\n             * @param {String} data.document - document url\r\n             */\r\n            function displayViewer(data) {\r\n                if (self.getState('enabled') !== false) {\r\n                    showPanel(self);\r\n                    self.controls.$title.text(data.label);\r\n                    resizeViewer(self);\r\n                    self.viewer.load(data.document, 'pdf');\r\n                }\r\n            }\r\n\r\n            this.controls = {\r\n                $panel: $panel,\r\n                $overlay: $panel.find('.viewer-overlay'),\r\n                $title: $panel.find('.viewer-title'),\r\n                $content: $panel.find('.viewer-content')\r\n            };\r\n\r\n            this.viewer = viewerFactory({\r\n                renderTo: this.controls.$content,\r\n                replace: true,\r\n                fitToWidth: true,\r\n                allowSearch: true\r\n            });\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('renderitem enabletools', function () {\r\n                    self.enable();\r\n                })\r\n                .on('renderitem', function () {\r\n                    self.getAreaBroker().getContentArea()\r\n                        .append(self.controls.$panel)\r\n                        .off('.' + self.getName())\r\n                        .on('viewDocument.' + self.getName(), function (event) {\r\n                            var data = event.originalEvent.detail;\r\n                            displayViewer(data);\r\n                        });\r\n                    initPanelEvents(self);\r\n                })\r\n                .on('move', function () {\r\n                    hideIfVisible(self);\r\n                })\r\n                .on('skip', function () {\r\n                    hideIfVisible(self);\r\n                })\r\n                .on('unloaditem disabletools', function () {\r\n                    self.disable();\r\n                })\r\n                .on('tool-documentViewer', function(data) {\r\n                    displayViewer(data);\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's render phase\r\n         */\r\n        render: function render() {\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            this.getAreaBroker().getContentArea().off('.' + this.getName());\r\n\r\n            if (this.viewer) {\r\n                this.viewer.destroy();\r\n            }\r\n\r\n            if (this.controls.$panel) {\r\n                this.controls.$panel.remove();\r\n            }\r\n\r\n            this.viewer = null;\r\n            this.controls = {};\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable: function enable() {\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable: function disable() {\r\n            hideIfVisible(this);\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show() {\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide() {\r\n            hideIfVisible(this);\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA;\r\n */\r\n/**\r\n * This plugin allows the test taker to select text inside an item.\r\n * Highlight is preserved when navigating between items\r\n *\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/highlighter/highlighter',[\r\n    'lodash',\r\n    'jquery',\r\n    'ui/highlighter'\r\n], function (\r\n    _,\r\n    $,\r\n    highlighterFactory\r\n) {\r\n    'use strict';\r\n    var selection;\r\n\r\n    if (!window.getSelection) throw new Error('Browser does not support getSelection()');\r\n\r\n    selection = window.getSelection();\r\n\r\n    /**\r\n     * Returns an array of active ranges.\r\n     * If browser doesn't support multiple Ranges, returns only the first range\r\n     * see note on https://w3c.github.io/selection-api/#methods\r\n     *\r\n     * @returns {Range[]}\r\n     */\r\n    function getAllRanges() {\r\n        var i, allRanges = [];\r\n\r\n        for (i = 0; i < selection.rangeCount; i++) {\r\n            allRanges.push(selection.getRangeAt(i));\r\n        }\r\n        return allRanges;\r\n    }\r\n\r\n    /**\r\n     * The highlighter Factory\r\n     */\r\n    return function(testRunner) {\r\n\r\n        /**\r\n         * Are we in highlight mode, meaning that each new selection is automatically highlighted\r\n         * without having to press any button\r\n         * @type {boolean}\r\n         */\r\n        var isHighlighting = false;\r\n\r\n        /**\r\n         * Store, for each item, an array containing the its highlight index\r\n         * @type {Object}\r\n         */\r\n        var itemsHighlights = {};\r\n\r\n        /**\r\n         * The helper that does the highlight magic\r\n         */\r\n        var highlightHelper = highlighterFactory({\r\n            className: 'txt-user-highlight',\r\n            containerSelector: '.qti-itemBody'\r\n        });\r\n\r\n        // add event to automatically highlight the recently made selection if needed\r\n        $(document).on('mouseup.highlighter', function() {\r\n            if (isHighlighting && !selection.isCollapsed) {\r\n                highlightHelper.highlightRanges(getAllRanges());\r\n                selection.removeAllRanges();\r\n            }\r\n        });\r\n\r\n        /**\r\n         * The highlighter instance\r\n         */\r\n        return {\r\n            /**\r\n             * toggle highlighting mode on and off\r\n             * @param {Boolean} bool - wanted state\r\n             */\r\n            toggleHighlighting: function toggleHighlighting(bool) {\r\n                isHighlighting = bool;\r\n                if (isHighlighting) {\r\n                    testRunner.trigger('plugin-start.highlighter');\r\n                } else {\r\n                    testRunner.trigger('plugin-end.highlighter');\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Either highlight the current or selection, or toggle highlighting mode\r\n             */\r\n            trigger: function trigger() {\r\n                if (!isHighlighting) {\r\n                    if (!selection.isCollapsed) {\r\n                        testRunner.trigger('plugin-start.highlighter');\r\n                        highlightHelper.highlightRanges(getAllRanges());\r\n                        testRunner.trigger('plugin-end.highlighter');\r\n                        selection.removeAllRanges();\r\n                    } else {\r\n                        this.toggleHighlighting(true);\r\n                    }\r\n                } else {\r\n                    this.toggleHighlighting(false);\r\n                }\r\n            },\r\n\r\n            /**\r\n             * save the highlight index for the current item\r\n             * @param itemId\r\n             */\r\n            saveHighlight: function saveHighlight(itemId) {\r\n                var index = highlightHelper.getHighlightIndex();\r\n                if (index && index.length > 0) {\r\n                    itemsHighlights[itemId] = index;\r\n                }\r\n            },\r\n\r\n\r\n            /**\r\n             * restore the highlight index on the current item\r\n             * @param itemId\r\n             */\r\n            restoreHighlight: function restoreHighlight(itemId) {\r\n                var index = itemsHighlights[itemId];\r\n                if (index && index.length > 0) {\r\n                    highlightHelper.highlightFromIndex(index);\r\n                }\r\n            },\r\n\r\n            /**\r\n             * remove all highlights\r\n             */\r\n            clearHighlights: function clearHighlights() {\r\n                highlightHelper.clearHighlights();\r\n                selection.removeAllRanges();\r\n            }\r\n        };\r\n    };\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Tool Plugin : Text Highlighter\r\n *\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/highlighter/plugin',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoQtiTest/runner/plugins/tools/highlighter/highlighter'\r\n], function ($, _, __, pluginFactory, hider, shortcut, namespaceHelper, highlighterFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'highlighter',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n\r\n            var highlighter = highlighterFactory(testRunner);\r\n\r\n            // create buttons\r\n            this.buttonMain = this.getAreaBroker().getToolbox().createEntry({\r\n                title: __('Highlight Text'),\r\n                icon: 'text-marker',\r\n                control: 'highlight-trigger',\r\n                text: __('Highlight')\r\n            });\r\n\r\n            this.buttonRemove = this.getAreaBroker().getToolbox().createEntry({\r\n                title: __('Clear all active highlights'),\r\n                control: 'highlight-clear',\r\n                text: __('Clear Highlights')\r\n            });\r\n\r\n            // attach user events\r\n            this.buttonMain\r\n                .on('mousedown', function(e) { // using 'mousedown' instead of 'click' to avoid losing current selection\r\n                    e.preventDefault();\r\n                    testRunner.trigger('tool-highlight');\r\n                });\r\n\r\n            this.buttonRemove\r\n                .on('click', function(e) {\r\n                    e.preventDefault();\r\n                    testRunner.trigger('tool-highlight-remove');\r\n                });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-highlight');\r\n                    }, { avoidInput: true, prevent: true });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isEnabled() {\r\n                var context = testRunner.getTestContext() || {},\r\n                    options = context.options || {};\r\n                //to be activated with the special category x-tao-option-highlighter\r\n                return !!options.highlighter;\r\n            }\r\n\r\n            /**\r\n             * Is plugin activated ? if not, then we hide the plugin\r\n             */\r\n            function togglePlugin() {\r\n                if (isEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', togglePlugin)\r\n                .on('enabletools renderitem', function () {\r\n                    self.enable();\r\n                })\r\n                .on('renderitem', function() {\r\n                    var testContext = testRunner.getTestContext();\r\n                    highlighter.restoreHighlight(testContext.itemIdentifier);\r\n                })\r\n                .on('beforeunloaditem', function() {\r\n                    var testContext = testRunner.getTestContext();\r\n                    highlighter.saveHighlight(testContext.itemIdentifier);\r\n                })\r\n                .on('disabletools unloaditem', function () {\r\n                    self.disable();\r\n                    highlighter.toggleHighlighting(false);\r\n                })\r\n                .on('tool-highlight', function () {\r\n                    if (isEnabled()) {\r\n                        highlighter.trigger();\r\n                    }\r\n                })\r\n                .on('tool-highlight-remove', function () {\r\n                    highlighter.clearHighlights();\r\n                })\r\n                .on('plugin-start.highlighter', function() {\r\n                    self.buttonMain.turnOn();\r\n                })\r\n                .on('plugin-end.highlighter', function() {\r\n                    self.buttonMain.turnOff();\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + this.getName());\r\n            $(document).off('.highlighter');\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable: function enable() {\r\n            this.buttonMain.enable();\r\n            this.buttonRemove.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable: function disable() {\r\n            this.buttonMain.disable();\r\n            this.buttonRemove.disable();\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show() {\r\n            this.buttonMain.show();\r\n            this.buttonRemove.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide() {\r\n            this.buttonMain.hide();\r\n            this.buttonRemove.hide();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Tool Plugin : item Theme Switcher\r\n *\r\n * @author\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/hider',\r\n    'ui/themes',\r\n    'util/shortcut',\r\n    'util/namespace'\r\n], function ($, _, __, pluginFactory, hider, themeHandler, shortcut, namespaceHelper) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: 'itemThemeSwitcher',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n            var themesConfig = themeHandler.get('items') || {};\r\n            var state = {\r\n                availableThemes: [],\r\n                defaultTheme: '',\r\n                selectedTheme: ''\r\n            };\r\n\r\n            /**\r\n             * Load the selected theme\r\n             * @param themeId\r\n             */\r\n            function changeTheme(themeId) {\r\n                var $qtiItem = $('.qti-item');\r\n                state.selectedTheme = themeId;\r\n\r\n                if ($qtiItem) {\r\n                    _.defer(function(){\r\n                        $qtiItem.trigger('themechange', [state.selectedTheme]);\r\n                    });\r\n                }\r\n            }\r\n\r\n            //init plugin state\r\n            if (themesConfig) {\r\n                if (themesConfig.default) {\r\n                    state.defaultTheme = themesConfig.default;\r\n                    state.selectedTheme = themesConfig.default;\r\n                }\r\n                if (themesConfig.available) {\r\n                    _.forEach(themesConfig.available, function (theme) {\r\n                        state.availableThemes.push({\r\n                            id: theme.id,\r\n                            label: theme.name\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n\r\n            // register toolbox button\r\n            this.menuButton = this.getAreaBroker().getToolbox().createMenu({\r\n                control: 'color-contrast',\r\n                title: __('Change the current color preset'),\r\n                icon: 'contrast',\r\n                text: __('Contrast')\r\n            });\r\n\r\n            this.menuButton.on('click', function (e) {\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-themeswitcher-toggle');\r\n            });\r\n\r\n\r\n            // register menu entries\r\n            state.availableThemes.forEach(function (theme) {\r\n                var themeEntry = self.getAreaBroker().getToolbox().createEntry({\r\n                    control: theme.id,\r\n                    title: theme.label,\r\n                    icon: 'preview',\r\n                    text: theme.label\r\n                });\r\n\r\n                themeEntry.setMenuId('color-contrast');\r\n\r\n                themeEntry.on('click', function(e) {\r\n                    var themeId = this.config.control;\r\n                    e.preventDefault();\r\n\r\n                    self.menuButton.turnOffAll();\r\n                    this.turnOn();\r\n\r\n                    changeTheme(themeId);\r\n                });\r\n\r\n                if (state.defaultTheme === theme.id) {\r\n                    themeEntry.on('render', function() {\r\n                        this.turnOn();\r\n                    });\r\n                }\r\n            });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-themeswitcher-toggle');\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', function() {\r\n                    self.show();\r\n                })\r\n                .on('renderitem', function () {\r\n                    self.enable();\r\n                    changeTheme(state.selectedTheme);\r\n                })\r\n                .on('enabletools', function() {\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function () {\r\n                    self.disable();\r\n                })\r\n                .on('tool-themeswitcher-toggle', function () {\r\n                    if (self.getState('enabled') !== false) {\r\n                        self.menuButton.toggleMenu();\r\n                    }\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + this.getName());\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable: function enable() {\r\n            this.menuButton.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable: function disable() {\r\n            this.menuButton.disable();\r\n\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show() {\r\n            this.menuButton.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide() {\r\n            this.menuButton.hide();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\r\n */\r\n/**\r\n * A compound mask is a mask built with multiple ui/components that interacts with each other.\r\n * The compound mask itself is not a ui/component but mimic most of its API.\r\n *\r\n * Most mask transformations (resize, drag) are achieved by updating a very simple transform model (position, dimensions)\r\n * which is latter applied to the actual individual components at a proper time\r\n *\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/lineReader/compoundMask',[\r\n    'jquery',\r\n    'lodash',\r\n    'core/statifier',\r\n    'core/eventifier',\r\n    'ui/component',\r\n    'ui/component/placeable',\r\n    'ui/component/draggable',\r\n    'ui/component/resizable',\r\n    'ui/component/stackable'\r\n], function(\r\n    $,\r\n    _,\r\n    statifier,\r\n    eventifier,\r\n    componentFactory,\r\n    makePlaceable,\r\n    makeDraggable,\r\n    makeResizable,\r\n    makeStackable\r\n) {\r\n    'use strict';\r\n\r\n    var defaultDimensions = {\r\n        outerWidth:  600,\r\n        outerHeight: 400,\r\n        innerWidth:  500,\r\n        innerHeight: 20\r\n    };\r\n    var defaultPosition = {\r\n        outerX: 0,\r\n        outerY: 0,\r\n        innerX: 50,\r\n        innerY: 50\r\n    };\r\n    var defaultOptions = {\r\n        dragMinWidth: 10,\r\n        dragMinHeight: 10,\r\n        resizeHandleSize: 10,\r\n        innerDragHeight: 20\r\n    };\r\n    var stackingOptions = {\r\n        stackingScope: 'test-runner'\r\n    };\r\n    var constrains;\r\n\r\n    /**\r\n     * @param {Object} options\r\n     * @param {Number} options.resizeHandleSize - size of the resize handlers on each resizable edge\r\n     * @param {Number} options.dragMinWidth - minimal width for the draggable area of each component.\r\n     * @param {Number} options.dragMinHeight - minimal height for the draggable area of each component.\r\n     * @param {Number} options.innerDragHeight - height of the inner window drag handle\r\n     * @param {Object} dimensions\r\n     * @param {Number} dimensions.outerWidth - overall mask width\r\n     * @param {Number} dimensions.outerHeight - overall mask height\r\n     * @param {Number} dimensions.innerWidth - inner window width\r\n     * @param {Number} dimensions.innerHeight - inner window height\r\n     * @param {Number} position\r\n     * @param {Number} position.outerX - overall mask x\r\n     * @param {Number} position.outerY - overall mask y\r\n     * @param {Number} position.innerX - inner window mask x\r\n     * @param {Number} position.innerY - inner window mask y\r\n     */\r\n    return function compoundMaskFactory(options, dimensions, position) {\r\n        var compoundMask,\r\n            allParts = {},\r\n            innerDrag,\r\n            closer,\r\n            visualGuides = {};\r\n\r\n        /**\r\n         * ============================================\r\n         * Definition of Mask & Overlay component types\r\n         * ============================================\r\n         */\r\n\r\n        /**\r\n         * Create a mask component. They are used for masking (obviously) but also resizing the compound mask\r\n         * @param {Object} maskConfig\r\n         * @param {String} maskConfig.id\r\n         * @param {Function} maskConfig.place - size and position the mask according to the transform model\r\n         * @param {Function} maskConfig.placeOverlay - size and position the overlay according to the transform model\r\n         * @param {Function} maskConfig.beforeResize - used to set the resize limit depending on which edge the resizing occurs\r\n         * @param {Function} maskConfig.onResize - how the resize affect the transform model\r\n         * @param {Object} maskConfig.edges - Interact configuration to specify which edges can be used for resizing\r\n         * @param {Number} maskConfig.minWidth\r\n         * @param {Number} maskConfig.minHeight\r\n         */\r\n        function createMask(maskConfig) {\r\n            var mask,\r\n                maskAPI = {\r\n                    place: maskConfig.place,\r\n                    placeOverlay: maskConfig.placeOverlay,\r\n\r\n                    styleResizableEdges: function styleResizableEdges() {\r\n                        var $element = this.getElement();\r\n                        _.forOwn(this.config.edges, function (isResizable, edgeId) {\r\n                            if (isResizable) {\r\n                                $element.addClass('border-' + edgeId);\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n\r\n            mask = componentFactory(maskAPI, maskConfig);\r\n            makeResizable(mask);\r\n            makeStackable(mask, stackingOptions);\r\n\r\n            return mask\r\n                .on('render', function() {\r\n                    var $element = this.getElement();\r\n\r\n                    this.styleResizableEdges();\r\n\r\n                    $element\r\n                        .addClass('line-reader-mask ' + maskConfig.id)\r\n                        .on('mousedown', function() {\r\n                            bringAllToFront();\r\n                        });\r\n\r\n                    // uncomment this to see what's going on with masks:\r\n                    // $element.css({ border: '1px solid olive'});\r\n                })\r\n                .on('resizestart', function () {\r\n                    innerDrag.hide();\r\n                    closer.hide();\r\n                    invokeOnOverlays('hide');\r\n                    invokeOnMasks('setState', ['resizing', true]);\r\n                })\r\n                .on('beforeresize', maskConfig.beforeResize || _.noop)\r\n                .on('resize', maskConfig.onResize || _.noop)\r\n                .on('resizeend', function () {\r\n                    applyTransformsToOverlays();\r\n                    applyTransformsToInnerDrag();\r\n                    applyTransformsToCloser();\r\n\r\n                    invokeOnMasks('setState', ['resizing', false]);\r\n                    invokeOnOverlays('show');\r\n                    innerDrag.show();\r\n                    closer.show();\r\n                })\r\n                .init();\r\n        }\r\n\r\n\r\n        /**\r\n         * Create a overlay component. Overlay are invisible and are used for dragging.\r\n         * When clicked, the whole mask is hidden and only the overlay is displayed, after being resized to fit the whole mask surface\r\n         * this allows for performance improvement as well as giving the dragged element proper dragging boundaries.\r\n         * Also, visual guides are added, like a fake inner window, during the drag\r\n         * @param {Object} overlayConfig\r\n         * @param {String} overlayConfig.id\r\n         */\r\n        function createOverlay(overlayConfig) {\r\n            var overlay,\r\n                overlayAPI = {\r\n                    transformOverlay: function transformOverlay() {\r\n                        var $element = this.getElement();\r\n\r\n                        this._sizeBackup = this.getSize();\r\n                        this._posBackup = this.getPosition();\r\n\r\n                        this.setSize(dimensions.outerWidth, dimensions.outerHeight)\r\n                            .moveTo(position.outerX, position.outerY);\r\n                        $element.addClass('moving');\r\n\r\n                        this.setState('transformed', true);\r\n                    },\r\n\r\n                    restoreOverlay: function restoreOverlay() {\r\n                        var $element = this.getElement();\r\n\r\n                        if (this.is('transformed')) {\r\n\r\n                            this.setSize(this._sizeBackup.width, this._sizeBackup.height)\r\n                                .moveTo(this._posBackup.x, this._posBackup.y);\r\n                            $element.removeClass('moving');\r\n\r\n                            this._sizeBackup = null;\r\n                            this._posBackup = null;\r\n\r\n                            this.setState('transformed', false);\r\n                        }\r\n                    },\r\n\r\n                    appendVisualGuides: function appendVisualGuides() {\r\n                        var $element = this.getElement(),\r\n                            borderWidth = 1, // this mirror the $lrBorderWidth css variable\r\n                            borderOffset = borderWidth * 2;\r\n\r\n                        $element.append(visualGuides.$maskBg);\r\n                        $element.append(visualGuides.$innerWindow);\r\n\r\n                        visualGuides.$maskBg.css({\r\n                            width:  dimensions.outerWidth - borderOffset,\r\n                            height: dimensions.outerHeight - borderOffset,\r\n                            'border-top-width':     dimensions.topHeight - borderOffset,\r\n                            'border-right-width':   dimensions.rightWidth - borderOffset,\r\n                            'border-bottom-width':  dimensions.bottomHeight - borderOffset,\r\n                            'border-left-width':    dimensions.leftWidth - borderOffset\r\n                        });\r\n\r\n                        visualGuides.$innerWindow.css({\r\n                            width:  dimensions.innerWidth,\r\n                            height: dimensions.innerHeight,\r\n                            left:   dimensions.leftWidth - borderOffset,\r\n                            top:    dimensions.topHeight - borderOffset\r\n                        });\r\n                    },\r\n\r\n                    removeVisualGuides: function removeVisualGuides() {\r\n                        visualGuides.$maskBg.remove();\r\n                        visualGuides.$innerWindow.remove();\r\n                    }\r\n                };\r\n\r\n            overlay = componentFactory(overlayAPI, overlayConfig);\r\n            makeDraggable(overlay);\r\n            makeStackable(overlay, stackingOptions);\r\n\r\n            return overlay\r\n                .on('render', function() {\r\n                    var self = this,\r\n                        $element = this.getElement();\r\n\r\n                    $element\r\n                        .addClass('line-reader-overlay ' + overlayConfig.id)\r\n                        .on('mousedown', function() {\r\n                            bringAllToFront();\r\n                            self.transformOverlay();\r\n                        })\r\n                        .on('mouseup', function() {\r\n                            self.restoreOverlay();\r\n                        });\r\n\r\n                    // uncomment this to see what's going on with overlays:\r\n                    // $element.css({ opacity: 0.5, 'background-color': 'yellow', border: '1px solid brown '});\r\n                })\r\n                .on('dragstart', function() {\r\n                    innerDrag.hide();\r\n                    closer.hide();\r\n                    invokeOnMasks('hide');\r\n                    this.appendVisualGuides();\r\n                })\r\n                .on('dragmove', function moveAllPartsTogether(xOffsetRelative, yOffsetRelative) {\r\n                    // update the transform model\r\n                    position.outerX += xOffsetRelative;\r\n                    position.outerY += yOffsetRelative;\r\n                    position.innerX += xOffsetRelative;\r\n                    position.innerY += yOffsetRelative;\r\n                })\r\n                .on('dragend', function() {\r\n                    this.removeVisualGuides();\r\n                    // although they are already display, calling show() again on the overlays\r\n                    // will force their z-Index at the top of the stack\r\n                    invokeOnAll('show');\r\n                    innerDrag.show();\r\n                    closer.show();\r\n\r\n                    // apply the new transform model\r\n                    applyTransforms();\r\n                })\r\n                .init();\r\n        }\r\n\r\n\r\n        /**\r\n         * ==========================\r\n         * Inner Drag Handle & Closer\r\n         * ==========================\r\n         */\r\n\r\n        /**\r\n         * This handle allows to drag the inner window\r\n         */\r\n        function createInnerDragHandle() {\r\n            // uncomment this (and a few lines below) if debugging is needed:\r\n            // var $boundingBox = $('<div>').css({ position: 'fixed', 'box-sizing': 'border-box', border: '1px solid red' });\r\n\r\n            innerDrag = componentFactory();\r\n\r\n            makeStackable(innerDrag, stackingOptions);\r\n            makeDraggable(innerDrag, {\r\n                dragRestriction: function dragRestriction() {\r\n                    var fixedXY = allParts.nw.mask.getElement().offset(),\r\n                        rect;\r\n\r\n                    rect = {\r\n                        x: fixedXY.left + constrains.minWidth,\r\n                        y: fixedXY.top + (constrains.minHeight + dimensions.innerHeight + options.resizeHandleSize),\r\n                        width: dimensions.outerWidth - (constrains.minWidth * 2 ),\r\n                        height: dimensions.outerHeight -\r\n                            (dimensions.innerHeight + constrains.minHeight + constrains.minBottomHeight - options.innerDragHeight)\r\n                    };\r\n\r\n                    // uncomment to see what's going on:\r\n                    // allParts.ne.mask.getContainer().append($boundingBox);\r\n                    // $boundingBox.css({ width: rect.width, height: rect.height, top: rect.y, left: rect.x });\r\n\r\n                    return rect;\r\n                }\r\n            })\r\n                .on('render', function() {\r\n                    var $element = this.getElement(),\r\n                        $dragIcon = $('<div>', {\r\n                            'class': 'icon icon-move'\r\n                        });\r\n\r\n                    $element.addClass('line-reader-inner-drag');\r\n                    $element.append($dragIcon);\r\n                    $element.on('mousedown', function(e) {\r\n                        e.stopPropagation();\r\n                        bringAllToFront();\r\n                    });\r\n                })\r\n                .on('dragstart', function() {\r\n                    closer.hide();\r\n                    invokeOnOverlays('hide');\r\n                    invokeOnMasks('setState', ['resizing', true]);\r\n                })\r\n                .on('dragmove', function(xOffsetRelative, yOffsetRelative) {\r\n                    position.innerX += xOffsetRelative;\r\n                    position.innerY += yOffsetRelative;\r\n\r\n                    dimensions.leftWidth += xOffsetRelative;\r\n                    dimensions.topHeight += yOffsetRelative;\r\n\r\n                    dimensions.rightWidth   -= xOffsetRelative;\r\n                    dimensions.bottomHeight -= yOffsetRelative;\r\n\r\n                    applyTransformsToMasks();\r\n                })\r\n                .on('dragend', function() {\r\n                    invokeOnOverlays('show');\r\n                    innerDrag.bringToFront();\r\n                    closer.show();\r\n                    invokeOnMasks('setState', ['resizing', false]);\r\n\r\n                    applyTransformsToOverlays();\r\n                })\r\n                .init();\r\n        }\r\n\r\n        /**\r\n         * Close button for the compound mask\r\n         */\r\n        function createCloser() {\r\n            closer = componentFactory();\r\n\r\n            makeStackable(closer, stackingOptions);\r\n            makePlaceable(closer)\r\n                .on('render', function() {\r\n                    var self = this,\r\n                        $element = this.getElement(),\r\n                        $closeIcon = $('<div>', {\r\n                            'class': 'icon icon-result-nok'\r\n                        });\r\n\r\n                    $element.append($closeIcon);\r\n                    $element.addClass('line-reader-closer');\r\n\r\n                    $element.on('mousedown', function() {\r\n                        bringAllToFront();\r\n                    });\r\n\r\n                    $element.on('click', function(e) {\r\n                        e.stopPropagation();\r\n                        self.trigger('click');\r\n                    });\r\n                })\r\n                .init();\r\n        }\r\n\r\n        /**\r\n         * =================\r\n         * Utility functions\r\n         * =================\r\n         */\r\n        function bringAllToFront() {\r\n            invokeOnAll('bringToFront');\r\n            innerDrag.bringToFront();\r\n            closer.bringToFront();\r\n        }\r\n\r\n        function invokeOnAll(fn, args) {\r\n            invokeOnMasks(fn, args);\r\n            invokeOnOverlays(fn, args);\r\n        }\r\n\r\n        function invokeOnMasks(fn, args) {\r\n            invokeOn('mask', fn, args);\r\n        }\r\n\r\n        function invokeOnOverlays(fn, args) {\r\n            invokeOn('overlay', fn, args);\r\n        }\r\n\r\n        /**\r\n         * Invoke a method on all compound mask parts, whether mask or overlays\r\n         * @param {String} target - mask | overlay\r\n         * @param {String} fn - the name of the method to invoke\r\n         * @param {*[]} args - arguments passed on invoke\r\n         */\r\n        function invokeOn(target, fn, args) {\r\n            _.forOwn(allParts, function(part) {\r\n                if (_.isObject(part[target]) && _.isFunction(part[target][fn])) {\r\n                    part[target][fn].apply(part[target], args);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * =================================\r\n         * Transform model related functions\r\n         * =================================\r\n         */\r\n\r\n        function applyTransforms() {\r\n            applyTransformsToMasks();\r\n            applyTransformsToOverlays();\r\n            applyTransformsToInnerDrag();\r\n            applyTransformsToCloser();\r\n        }\r\n\r\n        function applyTransformsToMasks() {\r\n            invokeOnMasks('place');\r\n        }\r\n\r\n        function applyTransformsToOverlays() {\r\n            _.forOwn(allParts, function(part) {\r\n                part.mask.placeOverlay(part.overlay);\r\n            });\r\n        }\r\n\r\n        function applyTransformsToInnerDrag() {\r\n            if (innerDrag) {\r\n                innerDrag\r\n                    .setSize(dimensions.innerWidth, options.innerDragHeight)\r\n                    .moveTo(\r\n                        position.innerX,\r\n                        position.innerY + dimensions.innerHeight + options.resizeHandleSize\r\n                    );\r\n            }\r\n        }\r\n\r\n        function applyTransformsToCloser() {\r\n            if (closer) {\r\n                closer\r\n                    .setSize(\r\n                        constrains.minWidth - options.resizeHandleSize,\r\n                        constrains.minHeight - options.resizeHandleSize\r\n                    )\r\n                    .moveTo(\r\n                        position.outerX + dimensions.outerWidth - constrains.minWidth + 3, // manual adjustment so it looks better\r\n                        position.outerY + options.resizeHandleSize\r\n                    );\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Check that the given transform model respect the current constrains.\r\n         * If not, correct them\r\n         */\r\n        function correctTransforms() {\r\n            if (dimensions.topHeight < constrains.minHeight) {\r\n                dimensions.topHeight = constrains.minHeight;\r\n                position.innerY = position.outerY + constrains.minHeight;\r\n            }\r\n            if (dimensions.innerHeight < constrains.minHeight) {\r\n                dimensions.innerHeight = constrains.minHeight;\r\n            }\r\n            if (dimensions.bottomHeight < constrains.minBottomHeight) {\r\n                dimensions.bottomHeight = constrains.minBottomHeight;\r\n            }\r\n            dimensions.outerHeight = dimensions.topHeight + dimensions.innerHeight + dimensions.bottomHeight;\r\n\r\n            if (dimensions.leftWidth < constrains.minWidth) {\r\n                dimensions.leftWidth = constrains.minWidth;\r\n                position.innerX = position.outerX + constrains.minWidth;\r\n            }\r\n            if (dimensions.innerWidth < constrains.minWidth) {\r\n                dimensions.innerWidth = constrains.minWidth;\r\n            }\r\n            if (dimensions.rightWidth < constrains.minWidth) {\r\n                dimensions.rightWidth = constrains.minWidth;\r\n            }\r\n            dimensions.outerWidth = dimensions.leftWidth + dimensions.innerWidth + dimensions.rightWidth;\r\n        }\r\n\r\n        /**\r\n         * Update the transform model during a resize affecting the top height\r\n         * @param {Number} newHeight\r\n         * @param {Number} newY\r\n         * @param {Boolean} fromTop - if the resize occurs from the top\r\n         */\r\n        function setTopHeight(newHeight, newY, fromTop) {\r\n            dimensions.topHeight = newHeight;\r\n\r\n            if (fromTop) {\r\n                dimensions.outerHeight = newHeight + dimensions.innerHeight + dimensions.bottomHeight;\r\n                position.outerY = newY;\r\n            } else {\r\n                dimensions.innerHeight = dimensions.outerHeight - newHeight - dimensions.bottomHeight;\r\n                position.innerY = position.outerY + newHeight;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Update the transform model during a resize affecting the right width\r\n         * @param {Number} newWidth\r\n         * @param {Number} newX\r\n         * @param {Boolean} fromLeft - if the resize occurs from the left\r\n         */\r\n        function setRightWidth(newWidth, newX, fromLeft) {\r\n            dimensions.rightWidth = newWidth;\r\n\r\n            if (fromLeft) {\r\n                dimensions.innerWidth = newX - position.innerX;\r\n            } else {\r\n                dimensions.outerWidth = dimensions.leftWidth + dimensions.innerWidth + newWidth;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Update the transform model during a resize affecting the bottom height\r\n         * @param {Number} newHeight\r\n         * @param {Number} newY\r\n         * @param {Boolean} fromTop - if the resize occurs from the top\r\n         */\r\n        function setBottomHeight(newHeight, newY, fromTop) {\r\n            dimensions.bottomHeight = newHeight;\r\n\r\n            if (fromTop) {\r\n                dimensions.innerHeight = newY - position.innerY;\r\n                dimensions.bottomHeight = newHeight;\r\n            } else {\r\n                dimensions.outerHeight = dimensions.topHeight + dimensions.innerHeight + newHeight;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Update the transform model during a resize affecting the left width\r\n         * @param {Number} newWidth\r\n         * @param {Number} newX\r\n         * @param {Boolean} fromLeft - if the resize occurs from the left\r\n         */\r\n        function setLeftWidth(newWidth, newX, fromLeft) {\r\n            dimensions.leftWidth = newWidth;\r\n\r\n            if (fromLeft) {\r\n                dimensions.outerWidth = newWidth + dimensions.innerWidth + dimensions.rightWidth;\r\n                position.outerX = newX;\r\n            } else {\r\n                dimensions.innerWidth = dimensions.outerWidth - newWidth - dimensions.rightWidth;\r\n                position.innerX = position.outerX + newWidth;\r\n            }\r\n        }\r\n\r\n\r\n        /**\r\n         * ======================================\r\n         * Mask parts and other elements creation\r\n         * ======================================\r\n         */\r\n\r\n        function createCompoundMask() {\r\n\r\n            // North\r\n            createPart({\r\n                id: 'n',\r\n                edges: { top: true, right: false, bottom: true, left: false },\r\n\r\n                // move and dimension the mask\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.innerX,\r\n                        position.outerY\r\n                    ).setSize(\r\n                        dimensions.innerWidth,\r\n                        dimensions.topHeight\r\n                    );\r\n                },\r\n\r\n                // move and dimension the overlay\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x,\r\n                        pos.y + options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width,\r\n                        size.height - (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                // set a resize limit whenever resize happens on an inner edge (here, the top inner edge, eg. the bottom of the mask),\r\n                // so the min/max width/height limit for \"inner component\" is respected\r\n                beforeResize: function beforeResize(width, height, fromLeft, fromTop) {\r\n                    this.config.maxHeight = (fromTop)\r\n                        ? null\r\n                        : dimensions.topHeight + (dimensions.innerHeight - constrains.minHeight);\r\n                },\r\n\r\n                // set the new transform values (dimension and position) resulting from the current mask resize, and apply them\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x, y) {\r\n                    setTopHeight(height, y, fromTop);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // North-east\r\n            createPart({\r\n                id: 'ne',\r\n                edges: { top: true, right: true, bottom: false, left: false },\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.innerX + dimensions.innerWidth,\r\n                        position.outerY\r\n                    ).setSize(\r\n                        dimensions.rightWidth,\r\n                        dimensions.topHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x,\r\n                        pos.y + options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width - options.resizeHandleSize,\r\n                        size.height - (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x, y) {\r\n                    setTopHeight(height, y, fromTop);\r\n                    setRightWidth(width, x, fromLeft);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // East\r\n            createPart({\r\n                id: 'e',\r\n                edges: { top: false, right: true, bottom: false, left: true },\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.innerX + dimensions.innerWidth,\r\n                        position.innerY\r\n                    ).setSize(\r\n                        dimensions.rightWidth,\r\n                        dimensions.innerHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x + options.resizeHandleSize,\r\n                        pos.y - options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width - (options.resizeHandleSize * 2),\r\n                        size.height + (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                beforeResize: function beforeResize(width, height, fromLeft) {\r\n                    this.config.maxWidth = (fromLeft)\r\n                        ? dimensions.rightWidth + (dimensions.innerWidth - constrains.minWidth)\r\n                        : null;\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x) {\r\n                    setRightWidth(width, x, fromLeft);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // South east\r\n            createPart({\r\n                id: 'se',\r\n                edges: { top: false, right: true, bottom: true, left: false },\r\n                minHeight: constrains.minBottomHeight,\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.innerX + dimensions.innerWidth,\r\n                        position.innerY + dimensions.innerHeight\r\n                    ).setSize(\r\n                        dimensions.rightWidth,\r\n                        dimensions.bottomHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x,\r\n                        pos.y + options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width - options.resizeHandleSize,\r\n                        size.height - (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x, y) {\r\n                    setRightWidth(width, x, fromLeft);\r\n                    setBottomHeight(height, y, fromTop);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // South\r\n            createPart({\r\n                id: 's',\r\n                edges: { top: true, right: false, bottom: true, left: false },\r\n                minHeight: constrains.minBottomHeight,\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.innerX ,\r\n                        position.innerY + dimensions.innerHeight\r\n                    ).setSize(\r\n                        dimensions.innerWidth,\r\n                        dimensions.bottomHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x,\r\n                        pos.y + options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width,\r\n                        size.height - (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                beforeResize: function beforeResize(width, height, fromLeft, fromTop) {\r\n                    this.config.maxHeight = (fromTop)\r\n                        ? dimensions.bottomHeight + (dimensions.innerHeight - constrains.minHeight)\r\n                        : null;\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x, y) {\r\n                    setBottomHeight(height, y, fromTop);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // South-west\r\n            createPart({\r\n                id: 'sw',\r\n                edges: { top: false, right: false, bottom: true, left: true },\r\n                minHeight: constrains.minBottomHeight,\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.outerX,\r\n                        position.innerY + dimensions.innerHeight\r\n                    ).setSize(\r\n                        dimensions.leftWidth,\r\n                        dimensions.bottomHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x + options.resizeHandleSize,\r\n                        pos.y + options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width - options.resizeHandleSize,\r\n                        size.height - (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x, y) {\r\n                    setBottomHeight(height, y, fromTop);\r\n                    setLeftWidth(width, x, fromLeft);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // West\r\n            createPart({\r\n                id: 'w',\r\n                edges: { top: false, right: true, bottom: false, left: true },\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.outerX,\r\n                        position.innerY\r\n                    ).setSize(\r\n                        dimensions.leftWidth,\r\n                        dimensions.innerHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x + options.resizeHandleSize,\r\n                        pos.y - options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width - (options.resizeHandleSize * 2),\r\n                        size.height + (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                beforeResize: function beforeResize(width, height, fromLeft) {\r\n                    this.config.maxWidth = (fromLeft)\r\n                        ? null\r\n                        : dimensions.leftWidth + (dimensions.innerWidth - constrains.minWidth);\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x) {\r\n                    setLeftWidth(width, x, fromLeft);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n\r\n            // North-west\r\n            createPart({\r\n                id: 'nw',\r\n                edges: { top: true, right: false, bottom: false, left: true },\r\n\r\n                place: function place() {\r\n                    this.moveTo(\r\n                        position.outerX,\r\n                        position.outerY\r\n                    ).setSize(\r\n                        dimensions.leftWidth,\r\n                        dimensions.topHeight\r\n                    );\r\n                },\r\n\r\n                placeOverlay: function placeOverlay(overlay) {\r\n                    var pos = this.getPosition(),\r\n                        size = this.getSize();\r\n                    overlay.moveTo(\r\n                        pos.x + options.resizeHandleSize,\r\n                        pos.y + options.resizeHandleSize\r\n                    ).setSize(\r\n                        size.width - options.resizeHandleSize,\r\n                        size.height - (options.resizeHandleSize * 2)\r\n                    );\r\n                },\r\n\r\n                onResize: function onResize(width, height, fromLeft, fromTop, x, y) {\r\n                    setTopHeight(height, y, fromTop);\r\n                    setLeftWidth(width, x, fromLeft);\r\n                    applyTransformsToMasks();\r\n                }\r\n            });\r\n        }\r\n\r\n        function createPart(partConfig) {\r\n            allParts[partConfig.id] = {\r\n                mask: createMask(_.assign({}, constrains, partConfig)),\r\n                overlay: createOverlay(partConfig)\r\n            };\r\n        }\r\n\r\n\r\n        function createVisualGuides() {\r\n            visualGuides.$maskBg = $('<div>', {\r\n                'class': 'mask-bg'\r\n            });\r\n            visualGuides.$innerWindow = $('<div>', {\r\n                'class': 'inner-window'\r\n            });\r\n        }\r\n\r\n\r\n        /**\r\n         * =========================\r\n         * The compoundMask instance\r\n         * =========================\r\n         */\r\n\r\n        dimensions  = _.defaults(dimensions || {}, defaultDimensions);\r\n        position    = _.defaults(position   || {}, defaultPosition);\r\n        options     = _.defaults(options    || {}, defaultOptions);\r\n\r\n        constrains = {\r\n            minWidth:           (options.resizeHandleSize * 2) + options.dragMinWidth,\r\n            minHeight:          (options.resizeHandleSize * 2) + options.dragMinHeight,\r\n            minBottomHeight:    (options.resizeHandleSize * 2) + options.innerDragHeight\r\n        };\r\n\r\n        compoundMask = {\r\n            init: function init() {\r\n                var self = this;\r\n\r\n                this.setTransforms(dimensions, position);\r\n\r\n                createCompoundMask();\r\n                createVisualGuides();\r\n                createInnerDragHandle();\r\n                createCloser();\r\n\r\n                closer.on('click', function() {\r\n                    self.hide();\r\n                    self.trigger('close');\r\n                });\r\n\r\n                return this;\r\n            },\r\n\r\n            render: function render($container) {\r\n                invokeOnAll('render', [$container]);\r\n                innerDrag.render($container);\r\n                closer.render($container);\r\n                applyTransforms();\r\n                return this;\r\n            },\r\n\r\n            destroy: function destroy() {\r\n                invokeOnAll('destroy');\r\n                visualGuides = null;\r\n                innerDrag = null;\r\n                closer = null;\r\n                return this;\r\n            },\r\n\r\n            show: function show() {\r\n                invokeOnAll('show');\r\n                innerDrag.show();\r\n                closer.show();\r\n                this.setState('hidden', false);\r\n                return this;\r\n            },\r\n\r\n            hide: function hide() {\r\n                invokeOnAll('hide');\r\n                innerDrag.hide();\r\n                closer.hide();\r\n                this.setState('hidden', true);\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Allow updating the transform model\r\n             * @param {Object} dim\r\n             * @param {Number} dim.outerWidth - overall mask width\r\n             * @param {Number} dim.outerHeight - overall mask height\r\n             * @param {Number} dim.innerWidth - inner window width\r\n             * @param {Number} dim.innerHeight - inner window height\r\n             * @param {Number} pos\r\n             * @param {Number} pos.outerX - overall mask x\r\n             * @param {Number} pos.outerY - overall mask y\r\n             * @param {Number} pos.innerX - inner window x\r\n             * @param {Number} pos.innerY - inner window y\r\n             */\r\n            setTransforms: function setTransforms(dim, pos) {\r\n                dimensions  = _.defaults(dim || {}, dimensions);\r\n                position    = _.defaults(pos || {}, position);\r\n\r\n                // automatically complete the dimensions\r\n                dimensions.topHeight    = pos.innerY - pos.outerY;\r\n                dimensions.rightWidth   = dim.outerWidth - (pos.innerX - pos.outerX) - dim.innerWidth;\r\n                dimensions.bottomHeight = dim.outerHeight - (pos.innerY - pos.outerY) - dim.innerHeight;\r\n                dimensions.leftWidth    = pos.innerX - pos.outerX;\r\n\r\n                correctTransforms();\r\n                applyTransforms();\r\n            },\r\n\r\n            getDimensions: function getDimensions() {\r\n                return dimensions;\r\n            },\r\n\r\n            getPosition: function getPosition() {\r\n                return position;\r\n            },\r\n\r\n            getParts: function getParts() {\r\n                return allParts;\r\n            }\r\n        };\r\n\r\n        statifier(compoundMask);\r\n        eventifier(compoundMask);\r\n\r\n        return compoundMask;\r\n    };\r\n});\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n\r\n/**\r\n * Test Runner Tool Plugin : Line Reader\r\n *\r\n * @author Christophe Noël <christophe@taotesting.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/lineReader/plugin',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoQtiTest/runner/plugins/tools/lineReader/compoundMask'\r\n], function ($, _, __, pluginFactory, hider, shortcut, namespaceHelper, compoundMaskFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The public name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'line-reader';\r\n\r\n    /**\r\n     * The prefix of actions triggered through the event loop\r\n     * @type {String}\r\n     */\r\n    var actionPrefix = 'tool-' + pluginName + '-';\r\n\r\n    /**\r\n     * Options for the compoundMask factory\r\n     * @type {Object}\r\n     */\r\n    var maskOptions = {\r\n        dragMinWidth: 7,\r\n        dragMinHeight: 7,\r\n        resizeHandleSize: 7,\r\n        innerDragHeight: 20\r\n    };\r\n\r\n    var dimensions,\r\n        position;\r\n\r\n    /**\r\n     * These functions are a first effort to place the mask on the first line on the item\r\n     * They make a lot of assumptions:\r\n     * - the item starts with a text\r\n     * - the padding is set on the .qti-item container\r\n     * - the padding is consistent with the minWidth/minHeight configuration of the mask\r\n     * - and some other...\r\n     * @param {jQuery} $container - where the mask is appended\r\n     */\r\n    function getDimensions($container) {\r\n        var $qtiContent = $container.find('#qti-content'),\r\n            $qtiItem = $qtiContent.find('.qti-item'),\r\n\r\n            lineHeight = Math.ceil(parseFloat($qtiContent.css('line-height'))) || 20; // reasonable default line height\r\n\r\n        return {\r\n            outerWidth:     $qtiItem.width() + (maskOptions.resizeHandleSize * 4) + (maskOptions.dragMinWidth * 2),\r\n            outerHeight:    175, // reasonable default height\r\n            innerWidth:     $qtiItem.width(),\r\n            innerHeight:    lineHeight\r\n        };\r\n    }\r\n    function getPosition($container) {\r\n        var $qtiContent = $container.find('#qti-content'),\r\n            $qtiItem = $qtiContent.find('.qti-item'),\r\n\r\n            itemPosition = $qtiItem.position() || {},\r\n\r\n            paddingLeft = parseInt($qtiItem.css('padding-left'), 10),\r\n            paddingTop = parseInt($qtiItem.css('padding-top'), 10),\r\n\r\n            textPadding = 3, // this is to let the text breathe a bit\r\n\r\n            innerX = parseInt(itemPosition.left, 10) + paddingLeft - textPadding,\r\n            innerY = parseInt(itemPosition.top, 10) + paddingTop - textPadding;\r\n\r\n        return {\r\n            outerX: innerX - (maskOptions.resizeHandleSize * 2) - maskOptions.dragMinWidth,\r\n            outerY: 0,\r\n            innerX: innerX,\r\n            innerY: innerY\r\n        };\r\n    }\r\n\r\n    function containerWidthHasChanged($container) {\r\n        var newDimensions = getDimensions($container);\r\n        return newDimensions.outerWidth !== dimensions.outerWidth;\r\n    }\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: pluginName,\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this,\r\n\r\n                testRunner = this.getTestRunner(),\r\n                testData = testRunner.getTestData() || {},\r\n                testConfig = testData.config || {},\r\n                pluginShortcuts = (testConfig.shortcuts || {})[pluginName] || {},\r\n                $container = testRunner.getAreaBroker().getContentArea().parent();\r\n\r\n            this.compoundMask = compoundMaskFactory(maskOptions)\r\n                .init()\r\n                .render($container)\r\n                .on('close', function() {\r\n                    closeMask();\r\n                })\r\n                .hide();\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isEnabled() {\r\n                var context = testRunner.getTestContext() || {},\r\n                    options = context.options || {};\r\n                //to be activated with the special category x-tao-option-lineReader\r\n                return !!options.lineReader;\r\n            }\r\n\r\n            function toggleButton() {\r\n                if (isEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            function toggleMask() {\r\n                if (self.compoundMask.getState('hidden')) {\r\n                    if (containerWidthHasChanged($container)) {\r\n                        transformMask($container);\r\n                    }\r\n                    openMask();\r\n                } else {\r\n                    closeMask();\r\n                }\r\n            }\r\n\r\n            function openMask() {\r\n                self.compoundMask.show();\r\n                self.trigger('start');\r\n                self.button.turnOn();\r\n            }\r\n\r\n            function closeMask() {\r\n                if (! self.compoundMask.getState('hidden')) {\r\n                    self.compoundMask.hide();\r\n                }\r\n                self.trigger('end');\r\n                self.button.turnOff();\r\n            }\r\n\r\n            function transformMask($maskContainer) {\r\n                dimensions = getDimensions($maskContainer);\r\n                position = getPosition($maskContainer);\r\n                self.compoundMask.setTransforms(\r\n                    _.clone(dimensions),\r\n                    _.clone(position)\r\n                );\r\n            }\r\n\r\n            // create button\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                title: __('Line Reader'),\r\n                icon: 'insert-horizontal-line',\r\n                control: 'line-reader',\r\n                text: __('Line Reader')\r\n            });\r\n\r\n            // attach user events\r\n            this.button\r\n                .on('click', function(e) {\r\n                    e.preventDefault();\r\n                    testRunner.trigger(actionPrefix + 'toggle');\r\n                });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.toggle) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle, this.getName(), true), function () {\r\n                        testRunner.trigger(actionPrefix + 'toggle');\r\n                    }, { avoidInput: true, prevent: true });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', toggleButton)\r\n                .on('renderitem', function() {\r\n                    transformMask($container);\r\n                })\r\n                .on('enabletools renderitem', function () {\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function () {\r\n                    self.disable();\r\n                    closeMask();\r\n                })\r\n                .on(actionPrefix + 'toggle', function () {\r\n                    if (isEnabled()) {\r\n                        toggleMask();\r\n                    }\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            this.compoundMask.destroy();\r\n            shortcut.remove('.' + this.getName());\r\n        },\r\n\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable: function enable() {\r\n            this.button.enable();\r\n        },\r\n\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable: function disable() {\r\n            this.button.disable();\r\n        },\r\n\r\n        /**\r\n         * Show the button\r\n         */\r\n        show: function show() {\r\n            this.button.show();\r\n        },\r\n\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide: function hide() {\r\n            this.button.hide();\r\n        }\r\n    });\r\n});\r\n\n","\ndefine('tpl!taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<div class=\\\"magnifier\\\">\\r\\n    <div class=\\\"level\\\">\";\n  if (helper = helpers.level) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.level); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\r\\n    <div class=\\\"overlay\\\"></div>\\r\\n    <div class=\\\"inner\\\"></div>\\r\\n    <div class=\\\"controls close\\\">\\r\\n        <a href=\\\"#\\\" class=\\\"closeMagnifier\\\" data-control=\\\"closeMagnifier\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close Magnifier\", options) : helperMissing.call(depth0, \"__\", \"Close Magnifier\", options)))\n    + \"\\\"><span class=\\\"icon-result-nok\\\"></span></a>\\r\\n    </div>\\r\\n    <div class=\\\"controls zoom\\\">\\r\\n        <a href=\\\"#\\\" class=\\\"control\\\"  data-control=\\\"zoomOut\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Magnify less\", options) : helperMissing.call(depth0, \"__\", \"Magnify less\", options)))\n    + \"\\\"><span class=\\\"icon-remove\\\"></span></a>\\r\\n        <a href=\\\"#\\\" class=\\\"control\\\" data-control=\\\"zoomIn\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Magnify more\", options) : helperMissing.call(depth0, \"__\", \"Magnify more\", options)))\n    + \"\\\"><span class=\\\"icon-add\\\"></span></a>\\r\\n    </div>\\r\\n</div>\\r\\n\";\n  return buffer;\n  });\n});\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel',[\r\n    'jquery',\r\n    'lodash',\r\n    'ui/movableComponent',\r\n    'tpl!taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel'\r\n], function ($, _, movableComponent, magnifierPanelTpl) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The screen pixel ratio\r\n     * @type {Number}\r\n     */\r\n    var screenRatio = window.screen.width / window.screen.height;\r\n\r\n    /**\r\n     * Standard debounce delay for heavy process\r\n     * @type {Number}\r\n     */\r\n    var debounceDelay = 50;\r\n\r\n    /**\r\n     * Standard scrolling throttling for the scrolling\r\n     * It can be lower than the debounce delay as it is lighter in process and it improves the user experience\r\n     * @type {Number}\r\n     */\r\n    var scrollingDelay = 20;\r\n\r\n    /**\r\n     * The default base size\r\n     * @type {Number}\r\n     */\r\n    var defaultBaseSize = 116;\r\n\r\n    /**\r\n     * The minimum zoom level\r\n     * @type {Number}\r\n     */\r\n    var defaultLevelMin = 2;\r\n\r\n    /**\r\n     * The maximum zoom level\r\n     * @type {Number}\r\n     */\r\n    var defaultLevelMax = 8;\r\n\r\n    /**\r\n     * The default zoom level\r\n     * @type {Number}\r\n     */\r\n    var defaultLevel = defaultLevelMin;\r\n\r\n    /**\r\n     * Some default values\r\n     * @type {Object}\r\n     */\r\n    var defaultConfig = {\r\n        level: defaultLevel,\r\n        levelMin: defaultLevelMin,\r\n        levelMax: defaultLevelMax,\r\n        levelStep: .5,\r\n        baseSize: defaultBaseSize,\r\n        width: defaultBaseSize * defaultLevel,\r\n        height: defaultBaseSize * defaultLevel / screenRatio,\r\n        minWidth: defaultBaseSize * defaultLevelMin,\r\n        minHeight: defaultBaseSize * defaultLevelMin / screenRatio,\r\n        maxRatio: .5,\r\n        stackingScope: 'test-runner'\r\n    };\r\n\r\n    /**\r\n     * Creates a magnifier panel component\r\n     * @param {Object} config\r\n     * @param {Number} [config.level] - The default zoom level\r\n     * @param {Number} [config.levelMin] - The minimum allowed zoom level\r\n     * @param {Number} [config.levelMax] - The maximum allowed zoom level\r\n     * @param {Number} [config.levelStep] - The level increment applied when using the controls + and -\r\n     * @param {Number} [config.baseSize] - The base size used to assign the width and the height according to the zoom level\r\n     * @param {Number} [config.maxRatio] - The ratio for the maximum size regarding the size of the window\r\n     * @returns {magnifierPanel} the component (initialized)\r\n     */\r\n    function magnifierPanelFactory(config) {\r\n        var initConfig = _.defaults(config || {}, defaultConfig);\r\n        var zoomLevelMin = parseFloat(initConfig.levelMin);\r\n        var zoomLevelMax = parseFloat(initConfig.levelMax);\r\n        var zoomLevelStep = parseFloat(initConfig.levelStep);\r\n        var zoomLevel = adjustZoomLevel(initConfig.level);\r\n        var maxRatio = parseFloat(initConfig.maxRatio);\r\n        var baseSize = parseInt(initConfig.baseSize, 10);\r\n        var zoomSize = baseSize * zoomLevel;\r\n        var $initTarget = null;\r\n        var controls = null;\r\n        var observer = null;\r\n        var targetWidth, targetHeight, dx, dy;\r\n        var scrolling = [];\r\n\r\n        /**\r\n         * @typedef {Object} magnifierPanel\r\n         */\r\n        var magnifierPanel = movableComponent({\r\n            /**\r\n             * Gets the current zoom level\r\n             * @returns {Number}\r\n             */\r\n            getZoomLevel: function getZoomLevel() {\r\n                return zoomLevel;\r\n            },\r\n\r\n            /**\r\n             * Gets the targeted content the magnifier will zoom\r\n             * @returns {jQuery}\r\n             */\r\n            getTarget: function getTarget() {\r\n                return controls && controls.$target;\r\n            },\r\n\r\n            /**\r\n             * Sets the targeted content the magnifier will zoom\r\n             * @param {jQuery} $newTarget\r\n             * @returns {magnifierPanel}\r\n             * @fires targetchange\r\n             * @fires update\r\n             */\r\n            setTarget: function setTarget($newTarget) {\r\n                if (controls) {\r\n                    controls.$target = $newTarget;\r\n                    controls.$viewTarget = null;\r\n\r\n                    setScrollingListener();\r\n\r\n                    /**\r\n                     * @event magnifierPanel#targetchange\r\n                     * @param {jQuery} $target\r\n                     */\r\n                    this.trigger('targetchange', controls.$target);\r\n\r\n                    this.update();\r\n                } else {\r\n                    $initTarget = $newTarget;\r\n                }\r\n\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Sets the zoom level of the magnifier\r\n             * @param {Number} level\r\n             * @returns {magnifierPanel}\r\n             * @fires zoom\r\n             */\r\n            zoomTo: function zoomTo(level) {\r\n                if (level && _.isFinite(level)) {\r\n                    zoomLevel = adjustZoomLevel(level);\r\n                }\r\n\r\n                applyZoomLevel();\r\n                showZoomLevel();\r\n                updateMaxSize();\r\n                updateZoom();\r\n\r\n                /**\r\n                 * @event magnifierPanel#zoom\r\n                 * @param {Number} zoomLevel\r\n                 */\r\n                this.trigger('zoom', zoomLevel);\r\n\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Increments the zoom level of the magnifier\r\n             * @param {Number} step\r\n             * @returns {magnifierPanel}\r\n             * @fires zoom\r\n             */\r\n            zoomBy: function zoomBy(step) {\r\n                if (step && _.isFinite(step)) {\r\n                    this.zoomTo(zoomLevel + parseFloat(step));\r\n                }\r\n                return this;\r\n            },\r\n\r\n            /**\r\n             * Zoom-in using the configured level step\r\n             * @returns {magnifierPanel}\r\n             * @fires zoom\r\n             */\r\n            zoomIn: function zoomIn() {\r\n                return this.zoomBy(zoomLevelStep);\r\n            },\r\n\r\n            /**\r\n             * Zoom-out using the configured level step\r\n             * @returns {magnifierPanel}\r\n             * @fires zoom\r\n             */\r\n            zoomOut: function zoomOut() {\r\n                return this.zoomBy(-zoomLevelStep);\r\n            },\r\n\r\n            /**\r\n             * Places the magnifier sight at a particular position on the target content\r\n             * @param {Number} x\r\n             * @param {Number} y\r\n             * @returns {magnifierPanel}\r\n             */\r\n            zoomAt: function zoomAt(x, y) {\r\n                var position;\r\n                if (controls) {\r\n                    position = this.translate(x, y);\r\n                    controls.$inner.css({\r\n                        top: -position.top,\r\n                        left: -position.left\r\n                    });\r\n                }\r\n            },\r\n\r\n            /**\r\n             * Translates screen coordinates to zoom coordinates\r\n             * @param {Number} x\r\n             * @param {Number} y\r\n             * @returns {Object}\r\n             */\r\n            translate: function translate(x, y) {\r\n                return {\r\n                    top: translateMagnifier(y, targetHeight, this.config.height),\r\n                    left: translateMagnifier(x, targetWidth, this.config.width)\r\n                };\r\n            },\r\n\r\n            /**\r\n             * Updates the magnifier with the target content\r\n             * @returns {magnifierPanel}\r\n             * @fires update\r\n             */\r\n            update: function update() {\r\n                if (controls && controls.$target) {\r\n                    controls.$clone = controls.$target.clone().removeAttr('id');\r\n                    controls.$clone.find('iframe').remove();\r\n                    controls.$clone.find('[name],[id],[data-serial]').removeAttr('name id data-serial');\r\n                    controls.$inner.empty().append(controls.$clone);\r\n\r\n                    applySize();\r\n                    applyZoomLevel();\r\n                    updateZoom();\r\n                    updateMaxSize();\r\n                    applyScrolling();\r\n\r\n                    /**\r\n                     * @event magnifierPanel#update\r\n                     */\r\n                    this.trigger('update');\r\n                }\r\n\r\n                return this;\r\n            }\r\n        }, defaultConfig);\r\n\r\n        /**\r\n         * Will update the magnifier content with the actual content\r\n         * @type {Function}\r\n         */\r\n        var updateMagnifier = _.debounce(_.bind(magnifierPanel.update, magnifierPanel), debounceDelay);\r\n\r\n        /**\r\n         * Will update the magnifier content with the scrolling position\r\n         * @type {Function}\r\n         */\r\n        var scrollingListenerCallback = _.throttle(function (event) {\r\n\r\n            var $target = $(event.target);\r\n            var scrollingTop = event.target.scrollTop;\r\n            var scrollLeft = event.target.scrollLeft;\r\n            var scrollId, scrollData;\r\n\r\n            //check if the element is already known as a scrollable element\r\n            if (controls && controls.$clone && $target.data('magnifier-scroll')) {\r\n\r\n                scrollId = $target.data('magnifier-scroll');\r\n                scrollData = _.find(scrolling, {id: scrollId});\r\n                scrollData.scrollTop = scrollingTop;\r\n                scrollData.scrollLeft = scrollLeft;\r\n\r\n                //if in clone, scroll it\r\n                scrollInClone(scrollData);\r\n\r\n            } else {\r\n                //if the element is not yet identified as a scrollable element, tag it and register its id\r\n                scrollId = _.uniqueId('scrolling_');\r\n                $target.attr('data-magnifier-scroll', scrollId);\r\n                scrolling.push({\r\n                    id: scrollId,\r\n                    scrollTop: scrollingTop,\r\n                    scrollLeft: scrollLeft\r\n                });\r\n\r\n                //update all\r\n                magnifierPanel.update();\r\n            }\r\n\r\n        }, scrollingDelay);\r\n\r\n        /**\r\n         * Scroll an element in the clone\r\n         *\r\n         * @param {Object} scrollData\r\n         * @param {String} scrollData.id\r\n         * @param {Number} [scrollData.scrollTop]\r\n         * @param {Number} [scrollData.scrollLeft]\r\n         */\r\n        function scrollInClone(scrollData) {\r\n            var $clonedTarget;\r\n            if (controls && controls.$clone && scrollData && scrollData.id) {\r\n                $clonedTarget = controls.$clone.find('[data-magnifier-scroll=' + scrollData.id + ']');\r\n                if ($clonedTarget.length) {\r\n                    if (_.isNumber(scrollData.scrollTop)) {\r\n                        $clonedTarget[0].scrollTop = scrollData.scrollTop;\r\n                    }\r\n                    if (_.isNumber(scrollData.scrollLeft)) {\r\n                        $clonedTarget[0].scrollLeft = scrollData.scrollLeft;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Initializes the listener for scrolling event and transfer the scrolling\r\n         */\r\n        function setScrollingListener() {\r\n            window.addEventListener('scroll', scrollingListenerCallback, true);\r\n        }\r\n\r\n        /**\r\n         * Stops the listener for scrolling event\r\n         */\r\n        function removeScrollingListener() {\r\n            window.removeEventListener('scroll', scrollingListenerCallback, true);\r\n        }\r\n\r\n        /**\r\n         * Applies scrolling programmatically from the recorded list of elements to be scrolled\r\n         */\r\n        function applyScrolling() {\r\n            _.forEach(scrolling, scrollInClone);\r\n        }\r\n\r\n        /**\r\n         * Adjusts a provided zoom level to fit the constraints\r\n         * @param {Number|String} level\r\n         * @returns {Number}\r\n         */\r\n        function adjustZoomLevel(level) {\r\n            return Math.max(zoomLevelMin, Math.min(parseFloat(level), zoomLevelMax));\r\n        }\r\n\r\n        /**\r\n         * Applies the zoom level to the content\r\n         */\r\n        function applyZoomLevel() {\r\n            if (controls) {\r\n                controls.$inner.css({\r\n                    transform: 'scale(' + zoomLevel + ')'\r\n                });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Shows the zoom level using a CSS animation\r\n         */\r\n        function showZoomLevel() {\r\n            var $newZoomLevel;\r\n            if (controls) {\r\n                $newZoomLevel = controls.$zoomLevel.clone(true).html(zoomLevel);\r\n                controls.$zoomLevel.before($newZoomLevel).remove();\r\n                controls.$zoomLevel = $newZoomLevel;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Updates the max size according to the window's size\r\n         */\r\n        function updateMaxSize() {\r\n            var $window = $(window);\r\n            magnifierPanel.config.maxWidth = $window.width() * maxRatio;\r\n            magnifierPanel.config.maxHeight = $window.height() * maxRatio;\r\n        }\r\n\r\n        /**\r\n         * Forwards the size of the target to the cloned content\r\n         */\r\n        function applySize() {\r\n            if (controls && controls.$clone) {\r\n                targetWidth = controls.$target.width();\r\n                targetHeight = controls.$target.height();\r\n\r\n                controls.$clone\r\n                    .width(targetWidth)\r\n                    .height(targetHeight);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Place the zoom sight at the right place inside the magnifier\r\n         */\r\n        function updateZoom() {\r\n            var position;\r\n            if (controls && controls.$target) {\r\n                position = magnifierPanel.getPosition();\r\n\r\n                position.x += dx + controls.$target.scrollLeft();\r\n                position.y += dy + controls.$target.scrollTop();\r\n\r\n                magnifierPanel.zoomAt(position.x, position.y);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Creates the observer that will react to DOM changes to update the magnifier\r\n         */\r\n        function createObserver() {\r\n            observer = new window.MutationObserver(updateMagnifier);\r\n        }\r\n\r\n        /**\r\n         * Starts to observe the DOM of the magnifier target\r\n         */\r\n        function startObserver() {\r\n            if (controls && controls.$target) {\r\n                observer.observe(controls.$target.get(0), {\r\n                    childList: true,        // Set to true if additions and removals of the target node's child elements (including text nodes) are to be observed.\r\n                    attributes: true,       // Set to true if mutations to target's attributes are to be observed.\r\n                    characterData: true,    // Set to true if mutations to target's data are to be observed.\r\n                    subtree: true           // Set to true if mutations to target and target's descendants are to be observed.\r\n                });\r\n            }\r\n            setScrollingListener();\r\n        }\r\n\r\n        /**\r\n         * Stops to observe the DOM of the magnifier target\r\n         */\r\n        function stopObserver() {\r\n            observer.disconnect();\r\n            removeScrollingListener();\r\n        }\r\n\r\n        /**\r\n         * Translates a screen coordinate into the magnifier\r\n         * @param {Number} coordinate\r\n         * @param {Number} actualSize\r\n         * @param {Number} magnifierSize\r\n         * @returns {Number}\r\n         */\r\n        function translateMagnifier(coordinate, actualSize, magnifierSize) {\r\n            var delta = 0;\r\n            var ratio = zoomLevel;\r\n\r\n            if (actualSize) {\r\n                delta = ((actualSize * (zoomLevel - 1)) / 2);\r\n                ratio = (actualSize * zoomLevel - magnifierSize) / (actualSize - magnifierSize);\r\n            }\r\n\r\n            return coordinate * ratio - delta;\r\n        }\r\n\r\n        /**\r\n         * Gets the top element from a particular absolute point.\r\n         * @param {Number} x - the page X-coordinate of the point\r\n         * @param {Number} y - the page Y-coordinate of the point\r\n         * @returns {HTMLElement}\r\n         */\r\n        function getElementFromPoint(x, y) {\r\n            var el;\r\n\r\n            if (controls) {\r\n                controls.$overlay.addClass('hidden');\r\n            }\r\n\r\n            el = document.elementFromPoint(x, y);\r\n\r\n            if (controls) {\r\n                controls.$overlay.removeClass('hidden');\r\n            }\r\n\r\n            return el;\r\n        }\r\n\r\n        /**\r\n         * Find the related node in the target. The both trees must have the same content.\r\n         * @param {jQuery|HTMLElement} node - the node for which find a relation\r\n         * @param {jQuery|HTMLElement} root - the root of the tree that contains the actual node\r\n         * @param {jQuery|HTMLElement} target - the root of the tree that could contains the related node\r\n         * @returns {jQuery}\r\n         */\r\n        function findSourceNode(node, root, target) {\r\n            var $node = $(node);\r\n            var $root = $(root);\r\n            var $target = $(target);\r\n            var indexes = [$node.index()];\r\n\r\n            // compute map of node's parents indexes\r\n            $node.parents().each(function () {\r\n                var $this = $(this);\r\n                if (!$this.is($root)) {\r\n                    indexes.push($this.index());\r\n                } else {\r\n                    return false;\r\n                }\r\n            });\r\n\r\n            // the last index is related to the root, so ignore it\r\n            indexes.pop();\r\n\r\n            // now try to find the same node using the path provided by the indexes map\r\n            if (indexes.length) {\r\n                $node = $target;\r\n                _.forEachRight(indexes, function (index) {\r\n                    $node = $node.children().eq(index);\r\n                    if (!$node.length) {\r\n                        return false;\r\n                    }\r\n                });\r\n            } else {\r\n                // nothing to search for...\r\n                $node = $();\r\n            }\r\n            return $node;\r\n        }\r\n\r\n        initConfig.width = zoomSize;\r\n        initConfig.height = zoomSize / screenRatio;\r\n        initConfig.minWidth = baseSize * zoomLevelMin;\r\n        initConfig.minHeight = baseSize * zoomLevelMin / screenRatio;\r\n\r\n        magnifierPanel\r\n            .setTemplate(magnifierPanelTpl)\r\n            .on('render', function () {\r\n                var self = this;\r\n                var $component = this.getElement();\r\n\r\n                this.setState('hidden', true);\r\n\r\n                // compute the padding of the magnifier content\r\n                dx = ($component.outerWidth() - $component.width()) / 2;\r\n                dy = ($component.outerHeight() - $component.height()) / 2;\r\n\r\n                controls = {\r\n                    $target: $initTarget,\r\n                    $inner: $('.inner', $component),\r\n                    $zoomLevel: $('.level', $component),\r\n                    $overlay: $('.overlay', $component)\r\n                };\r\n                $initTarget = null;\r\n\r\n                // click on zoom-in or zoom-out controls\r\n                $component.on('click touchstart', '.zoom', function (event) {\r\n                    var $button = $(event.target).closest('.control');\r\n                    var action = $button.data('control');\r\n\r\n                    event.preventDefault();\r\n                    if (action && self[action]) {\r\n                        self[action]();\r\n                    }\r\n                });\r\n\r\n                // click on close controls\r\n                $component.on('click touchstart', '.closeMagnifier', function (event) {\r\n                    event.preventDefault();\r\n                    self.hide();\r\n                    self.trigger('close');\r\n                });\r\n\r\n                // interact through the magnifier glass with the zoomed content\r\n                $component.on('click touchstart', '.overlay', function (event) {\r\n                    if (!self.is('noclick')) {\r\n                        findSourceNode(\r\n                            getElementFromPoint(event.pageX, event.pageY),\r\n                            controls.$inner,\r\n                            controls.$target\r\n                        ).click().focus();\r\n                    } else {\r\n                        // was a 'dragend' click, just ignore\r\n                        self.setState('noclick', false);\r\n                    }\r\n                });\r\n\r\n                createObserver();\r\n                updateMaxSize();\r\n                applyZoomLevel();\r\n            })\r\n            .on('dragstart resizestart', function () {\r\n                // prevent the 'dragend' click to be understood as an actual click\r\n                this.setState('noclick', true);\r\n            })\r\n            .on('move resize', function () {\r\n                updateZoom();\r\n            })\r\n            .on('show', function () {\r\n                updateMagnifier();\r\n                startObserver();\r\n            })\r\n            .on('hide', function () {\r\n                stopObserver();\r\n            })\r\n            .on('resize', function () {\r\n                updateMaxSize();\r\n            })\r\n            .on('destroy', function () {\r\n                stopObserver();\r\n                $initTarget = null;\r\n                controls = null;\r\n                observer = null;\r\n            })\r\n            .init(initConfig);\r\n\r\n        return magnifierPanel;\r\n    }\r\n\r\n    return magnifierPanelFactory;\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\r\n */\r\n/**\r\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\r\n */\r\ndefine('taoQtiTest/runner/plugins/tools/magnifier/magnifier',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'taoTests/runner/plugin',\r\n    'ui/hider',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel'\r\n], function ($, _, __, pluginFactory, hider, shortcut, namespaceHelper, magnifierPanelFactory) {\r\n    'use strict';\r\n\r\n    /**\r\n     * The public name of the plugin\r\n     * @type {String}\r\n     */\r\n    var pluginName = 'magnifier';\r\n\r\n    /**\r\n     * The prefix of actions triggered through the event loop\r\n     * @type {String}\r\n     */\r\n    var actionPrefix = 'tool-' + pluginName + '-';\r\n\r\n    /**\r\n     * Some default options for the plugin\r\n     * @type {Object}\r\n     */\r\n    var defaultOptions = {\r\n        zoomMin: 2,    // Smallest magnification factor\r\n        zoomMax: 8,    // Biggest magnification factor\r\n        zoomStep: .5   // Increment between min an max\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name: pluginName,\r\n\r\n        /**\r\n         * Initializes the plugin (called during runner's init)\r\n         */\r\n        init: function init() {\r\n            var self = this;\r\n\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginConfig = _.defaults((testConfig.plugins || {})[pluginName] || {}, defaultOptions);\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[pluginName] || {};\r\n            var magnifierPanel = null;\r\n\r\n            /**\r\n             * Creates the magnifier panel on demand\r\n             * @returns {magnifierPanel}\r\n             * @fires plugin-magnifier-create.magnifier\r\n             */\r\n            function getMagnifierPanel() {\r\n                var $container;\r\n\r\n                if (!magnifierPanel) {\r\n                    $container = testRunner.getAreaBroker().getContainer();\r\n\r\n                    magnifierPanel = magnifierPanelFactory({\r\n                        levelMin: pluginConfig.zoomMin,\r\n                        levelMax: pluginConfig.zoomMax,\r\n                        levelStep: pluginConfig.zoomStep\r\n                    })\r\n                        .on('show', function () {\r\n                            /**\r\n                             * @event plugin-magnifier-show.magnifier\r\n                             */\r\n                            self.trigger('magnifier-show');\r\n                        })\r\n                        .on('hide', function () {\r\n                            /**\r\n                             * @event plugin-magnifier-hide.magnifier\r\n                             */\r\n                            self.trigger('magnifier-hide');\r\n                        })\r\n                        .on('zoom', function (level) {\r\n                            /**\r\n                             * @event plugin-magnifier-zoom.magnifier\r\n                             * @param {Number} zoomLevel\r\n                             */\r\n                            self.trigger('magnifier-zoom', level);\r\n                        })\r\n                        .on('close', function () {\r\n                            hideMagnifier();\r\n                        })\r\n                        .setTarget($container)\r\n                        .render($container.parent());\r\n\r\n                    /**\r\n                     * @event plugin-magnifier-create.magnifier\r\n                     */\r\n                    self.trigger('magnifier-create');\r\n                }\r\n                return magnifierPanel;\r\n            }\r\n\r\n            /**\r\n             * Checks if the plugin is currently available\r\n             * @returns {Boolean}\r\n             */\r\n            function isEnabled() {\r\n                var context = testRunner.getTestContext() || {},\r\n                    options = context.options || {};\r\n                //to be activated with the special category x-tao-option-magnifier\r\n                return !!options.magnifier;\r\n            }\r\n\r\n            /**\r\n             * Shows/hides the plugin GUI according to context\r\n             */\r\n            function togglePlugin() {\r\n                if (isEnabled()) {\r\n                    self.show();\r\n                } else {\r\n                    self.hide();\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Shows/hides the magnifier\r\n             */\r\n            function toggleMagnifier() {\r\n                if (self.getState('enabled')) {\r\n                    if (self.getState('active')) {\r\n                        hideMagnifier();\r\n                    } else {\r\n                        showMagnifier();\r\n                    }\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Opens the magnifier panel\r\n             * @fires plugin-magnifier-show.magnifier\r\n             */\r\n            function showMagnifier() {\r\n                getMagnifierPanel();\r\n\r\n                if (magnifierPanel.is('hidden')) {\r\n                    magnifierPanel.show();\r\n                }\r\n                self.button.turnOn();\r\n                testRunner.trigger('plugin-open.' + pluginName);\r\n\r\n                self.setState('active', true);\r\n            }\r\n\r\n            /**\r\n             * Closes the magnifier panel\r\n             * @fires plugin-magnifier-hide.magnifier\r\n             */\r\n            function hideMagnifier() {\r\n                self.setState('active', false);\r\n\r\n                self.button.turnOff();\r\n                testRunner.trigger('plugin-close.' + pluginName);\r\n\r\n                if (magnifierPanel && !magnifierPanel.is('hidden')) {\r\n                    magnifierPanel.hide();\r\n                }\r\n            }\r\n\r\n            // build element\r\n            this.button = this.getAreaBroker().getToolbox().createEntry({\r\n                control: 'magnify',\r\n                title: __('Displays a customisable magnifier'),\r\n                text: __('Magnifying Glass'),\r\n                icon: 'find'\r\n            });\r\n\r\n            // attach behavior\r\n            this.button.on('click', function (event) {\r\n                event.preventDefault();\r\n                testRunner.trigger(actionPrefix + 'toggle');\r\n            });\r\n\r\n\r\n            // handle the plugin's shortcuts\r\n            if (testConfig.allowShortcuts) {\r\n                _.forEach(pluginShortcuts, function (command, key) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(command, pluginName, true), function () {\r\n                        // just fire the action using the event loop\r\n                        testRunner.trigger(actionPrefix + key);\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                });\r\n            }\r\n\r\n            //start disabled\r\n            togglePlugin();\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n            // runner life cycle\r\n                .on('loaditem', function () {\r\n                    togglePlugin();\r\n                    self.disable();\r\n                })\r\n                .on('renderitem', function () {\r\n                    if (magnifierPanel) {\r\n                        magnifierPanel\r\n                            .update()\r\n                            .zoomTo(pluginConfig.zoomMin);\r\n                    }\r\n                })\r\n                .on('enabletools renderitem', function () {\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function () {\r\n                    if (self.getState('active')) {\r\n                        hideMagnifier();\r\n                    }\r\n                    self.disable();\r\n                })\r\n                .on('destroy', function () {\r\n                    if (magnifierPanel) {\r\n                        magnifierPanel.destroy();\r\n                    }\r\n                    magnifierPanel = null;\r\n                })\r\n\r\n                // commands that controls the magnifier\r\n                .on(actionPrefix + 'toggle', function () {\r\n                    if (isEnabled()) {\r\n                        toggleMagnifier();\r\n                    }\r\n                })\r\n                .on(actionPrefix + 'in', function () {\r\n                    if (isEnabled() && self.getState('enabled') && self.getState('active')) {\r\n                        getMagnifierPanel().zoomIn();\r\n                    }\r\n                })\r\n                .on(actionPrefix + 'out', function () {\r\n                    if (isEnabled() && self.getState('enabled') && self.getState('active')) {\r\n                        getMagnifierPanel().zoomOut();\r\n                    }\r\n                })\r\n                .on(actionPrefix + 'close', function () {\r\n                    if (self.getState('active')) {\r\n                        hideMagnifier();\r\n                    }\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy: function destroy() {\r\n            shortcut.remove('.' + pluginName);\r\n        },\r\n\r\n        /**\r\n         * Enables the button\r\n         */\r\n        enable: function enable() {\r\n            this.button.enable();\r\n        },\r\n\r\n        /**\r\n         * Disables the button\r\n         */\r\n        disable: function disable() {\r\n            this.button.disable();\r\n        },\r\n\r\n        /**\r\n         * Shows the button\r\n         */\r\n        show: function show() {\r\n            this.button.show();\r\n        },\r\n\r\n        /**\r\n         * Hides the button\r\n         */\r\n        hide: function hide() {\r\n            this.button.hide();\r\n        }\r\n    });\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2016  (original work) Open Assessment Technologies SA;\r\n *\r\n * @author dieter <dieter@taotesting.com>\r\n * @author Alexander Zagovorichev <zagovorichev@1pt.com>\r\n */\r\n\r\ndefine('taoQtiTest/runner/plugins/tools/zoom',[\r\n    'jquery',\r\n    'i18n',\r\n    'ui/hider',\r\n    'ui/transformer',\r\n    'util/shortcut',\r\n    'util/namespace',\r\n    'taoTests/runner/plugin'\r\n], function ($, __, hider, transformer, shortcut, namespaceHelper, pluginFactory){\r\n    'use strict';\r\n\r\n    /**\r\n     * The standard zoom level, in percentage\r\n     * @type {Number}\r\n     */\r\n    var standard = 100;\r\n\r\n    /**\r\n     * Zoom-In/Zoom-Out steps\r\n     * @type {Number}\r\n     */\r\n    var increment = 10;\r\n\r\n    /**\r\n     * The zoom boundaries, in percentage\r\n     * @type {Object}\r\n     */\r\n    var threshold = {\r\n        lower: 10,\r\n        upper: 200\r\n    };\r\n\r\n    /**\r\n     * Sets the zoom level\r\n     * @param {jQuery} $target\r\n     * @param {Number} level - Zoom percentage\r\n     */\r\n    var setZoomLevel = function($target, level) {\r\n        transformer.setTransformOrigin($target, '0 0');\r\n        transformer.scale($target, level / 100);\r\n    };\r\n\r\n    /**\r\n     * Restores the standard zoom level\r\n     * @param {jQuery} $target\r\n     */\r\n    var resetZoom = function($target) {\r\n        transformer.reset($target);\r\n    };\r\n\r\n    /**\r\n     * Forces a browser repaint\r\n     * Solution from http://stackoverflow.com/questions/3485365/how-can-i-force-webkit-to-redraw-repaint-to-propagate-style-changes?answertab=votes#tab-top\r\n     * @param {jQuery} $target\r\n     */\r\n    var forceRepaint = function($target) {\r\n        var sel = $target[0];\r\n        if (sel) {\r\n            sel.style.display = 'none';\r\n            sel.offsetHeight; // no need to store this anywhere, the reference is enough\r\n            sel.style.display = '';\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns the configured plugin\r\n     */\r\n    return pluginFactory({\r\n\r\n        name : 'zoom',\r\n\r\n        /**\r\n         * Initialize the plugin (called during runner's init)\r\n         */\r\n        init : function init(){\r\n            var self = this;\r\n            var testRunner = this.getTestRunner();\r\n            var testData = testRunner.getTestData() || {};\r\n            var testConfig = testData.config || {};\r\n            var pluginShortcuts = (testConfig.shortcuts || {})[this.getName()] || {};\r\n\r\n            function zoomAction(dir) {\r\n\r\n                var inc = increment * dir;\r\n                var el, sx, sy, before, after, margin;\r\n\r\n                if (self.$zoomTarget) {\r\n                    el = self.$zoomTarget[0];\r\n\r\n                    before = el.getBoundingClientRect();\r\n\r\n                    sx = self.$container.scrollLeft();\r\n                    sy = self.$container.scrollTop();\r\n\r\n                    self.zoom = Math.max(threshold.lower, Math.min(threshold.upper, self.zoom + inc));\r\n\r\n                    if (self.zoom === standard) {\r\n                        resetZoom(self.$zoomTarget);\r\n                    } else {\r\n                        setZoomLevel(self.$zoomTarget, self.zoom);\r\n                    }\r\n\r\n                    // force a browser repaint to fix a scrollbar issue with WebKit\r\n                    forceRepaint(self.$zoomTarget);\r\n\r\n                    after = el.getBoundingClientRect();\r\n\r\n                    sx = Math.max(0, sx + (after.width - before.width) / 2);\r\n                    sy = Math.max(0, sy + (after.height - before.height) / 2);\r\n\r\n                    self.$container.scrollLeft(sx).scrollTop(sy);\r\n                }\r\n            }\r\n\r\n            function zoomIn() {\r\n                if (self.getState('enabled') !== false) {\r\n                    zoomAction(1);\r\n                }\r\n            }\r\n\r\n            function zoomOut() {\r\n                if (self.getState('enabled') !== false) {\r\n                    zoomAction(-1);\r\n                }\r\n            }\r\n\r\n            //build element (detached)\r\n            this.buttonZoomOut = this.getAreaBroker().getToolbox().createEntry({\r\n                control : 'zoomOut',\r\n                title : __('Zoom out'),\r\n                icon : 'remove'\r\n            });\r\n\r\n            this.buttonZoomIn = this.getAreaBroker().getToolbox().createEntry({\r\n                control : 'zoomIn',\r\n                title : __('Zoom in'),\r\n                icon : 'add'\r\n            });\r\n\r\n            //attach behavior\r\n            this.buttonZoomIn.on('click', function (e){\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-zoomin');\r\n            });\r\n\r\n            //attach behavior\r\n            this.buttonZoomOut.on('click', function (e){\r\n                e.preventDefault();\r\n                testRunner.trigger('tool-zoomout');\r\n            });\r\n\r\n            if (testConfig.allowShortcuts) {\r\n                if (pluginShortcuts.in) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.in, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-zoomin');\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                }\r\n\r\n                if (pluginShortcuts.out) {\r\n                    shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.out, this.getName(), true), function () {\r\n                        testRunner.trigger('tool-zoomout');\r\n                    }, {\r\n                        avoidInput: true\r\n                    });\r\n                }\r\n            }\r\n\r\n            //start disabled\r\n            this.show();\r\n            this.disable();\r\n\r\n            //update plugin state based on changes\r\n            testRunner\r\n                .on('loaditem', function (){\r\n                    self.zoom = standard;\r\n\r\n                    self.show();\r\n                    self.disable();\r\n                })\r\n                .on('renderitem', function (){\r\n                    self.$container = $('#qti-content');\r\n                    self.$zoomTarget = $('.qti-item');\r\n\r\n                    self.enable();\r\n                })\r\n                .on('enabletools', function() {\r\n                    self.enable();\r\n                })\r\n                .on('disabletools unloaditem', function (){\r\n                    self.disable();\r\n                })\r\n                .on('tool-zoomin', zoomIn)\r\n                .on('tool-zoomout', zoomOut);\r\n        },\r\n        /**\r\n         * Called during the runner's destroy phase\r\n         */\r\n        destroy : function destroy(){\r\n            shortcut.remove('.' + this.getName());\r\n        },\r\n        /**\r\n         * Enable the button\r\n         */\r\n        enable : function enable(){\r\n            this.buttonZoomIn.enable();\r\n            this.buttonZoomOut.enable();\r\n        },\r\n        /**\r\n         * Disable the button\r\n         */\r\n        disable : function disable(){\r\n            this.buttonZoomIn.disable();\r\n            this.buttonZoomOut.disable();\r\n        },\r\n        /**\r\n         * Show the button\r\n         */\r\n        show : function show(){\r\n            this.buttonZoomIn.show();\r\n            this.buttonZoomOut.show();\r\n        },\r\n        /**\r\n         * Hide the button\r\n         */\r\n        hide : function hide(){\r\n            this.buttonZoomIn.hide();\r\n            this.buttonZoomOut.hide();\r\n        }\r\n    });\r\n});\r\n\n","\n(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('.test-runner-scope .content-wrapper p.key-navigation-group,.test-runner-scope .content-wrapper div.key-navigation-group{padding:5px !important}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction){border-width:1px !important;border-style:solid;border-color:transparent}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction).focusin{border-color:#0e5d91 !important;outline:none}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction).qti-interaction .qti-choice.key-navigation-highlight{background:#e7eff4 !important}.test-runner-scope .content-wrapper span.key-navigation-group{border:none !important}.test-runner-scope .content-wrapper span.key-navigation-group.focusin{outline:solid #0e5d91 1px !important;outline-offset:1px}.test-runner-scope .test-sidebar .key-navigation-group.focusin{background:#e7eff4}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight .qti-navigator-tab{border-width:2px}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight:focus{outline:none}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight:focus .qti-navigator-tab{border-top-color:#222 !important;border-left-color:#222 !important;border-right-color:#222 !important}.test-runner-scope .test-sidebar .key-navigation-group li.qti-navigator-item.key-navigation-highlight{padding-left:8px;border-left:solid 2px #222}.test-runner-scope .test-sidebar .key-navigation-group li.qti-navigator-item.key-navigation-highlight .key-navigation-highlight:focus{outline:none}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group.focusin{-webkit-box-shadow:0 0 6px 2px #3e7da7;-moz-box-shadow:0 0 6px 2px #3e7da7;-ms-box-shadow:0 0 6px 2px #3e7da7;-o-box-shadow:0 0 6px 2px #3e7da7;box-shadow:0 0 6px 2px #3e7da7}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus{margin-bottom:0;border-bottom-color:#e7eff4 !important;outline:none}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus.active{border-bottom-color:transparent !important;background:#e7eff4 !important}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus:not(.active) .li-inner{color:#e7eff4}header .settings-menu .key-navigation-group{padding-right:5px}header .settings-menu .key-navigation-group.focusin{background-color:rgba(14,93,145,0.5);padding-bottom:10px}header .settings-menu .key-navigation-highlight:focus{height:54px;color:white !important;border-bottom:solid 2px white !important}\\r\\n/*# sourceMappingURL=key-navigation.css.map */\\r\\n');\n"]}